<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ë“œ ì‚½ì… (Code Injection) - ì‹¤ìŠµ ì‹œë®¬ë ˆì´í„°</title>
    <!-- Prism.js for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” (ì œê³µí•´ì£¼ì‹  ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ ì ìš©) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(135deg, #1c92d2 0%, #f2fcfe 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        
        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            background: white; padding: 30px; border-radius: 15px; margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; border-bottom: 5px solid #d9534f; /* ë¶‰ì€ ê³„ì—´ë¡œ ë³€ê²½ (ìœ„í—˜ ê°•ì¡°) */
        }
        .header h1 { color: #d9534f; font-size: 32px; margin-bottom: 10px; }
        .header p { color: #666; font-size: 16px; }

        /* íƒ­ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .mode-tabs { display: flex; gap: 15px; margin-bottom: 20px; }
        .mode-tab {
            flex: 1; padding: 20px; background: rgba(255, 255, 255, 0.9); border: none;
            border-radius: 12px; cursor: pointer; transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: left; position: relative; overflow: hidden;
        }
        .mode-tab:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .mode-tab.active { background: linear-gradient(135deg, #d9534f 0%, #a94442 100%); color: white; }
        .mode-icon { font-size: 32px; margin-bottom: 10px; }
        .mode-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .mode-desc { font-size: 13px; opacity: 0.8; }

        /* ì½˜í…ì¸  ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .content-wrapper { display: none; }
        .content-wrapper.active { display: block; }

        /* ì§„í–‰ ìƒíƒœ í‘œì‹œì¤„ */
        .progress-indicator {
            background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .progress-title { font-size: 16px; font-weight: bold; margin-bottom: 15px; color: #2c3e50; }
        .checklist { list-style: none; padding: 0; display: flex; gap: 15px; flex-wrap: wrap; }
        .checklist-item {
            padding: 8px 15px; background: #f8f9fa; border-radius: 20px; display: flex;
            align-items: center; gap: 8px; font-size: 14px; border: 1px solid #e9ecef; transition: all 0.3s;
        }
        .checklist-item.completed {
            background: #d4edda; border-color: #c3e6cb; color: #155724; font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* ë©”ì¸ ì½˜í…ì¸  ë ˆì´ì•„ì›ƒ */
        .main-content { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; margin-bottom: 20px; }
        .panel {
            background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex; flex-direction: column; height: 100%;
        }
        .panel-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
            padding-bottom: 15px; border-bottom: 3px solid #f0f0f0;
        }
        .panel-title { font-size: 20px; font-weight: bold; color: #2c3e50; display: flex; align-items: center; gap: 10px; }
        .status-badge { padding: 6px 16px; border-radius: 20px; font-size: 13px; font-weight: bold; }
        .status-vulnerable { background: #dc3545; color: white; }
        .status-secure { background: #28a745; color: white; }
        .status-editing { background: #ffc107; color: #000; }

        /* ì½”ë“œ ì—ë””í„° ìŠ¤íƒ€ì¼ */
        .code-editor {
            background: #1e1e1e; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column;
            flex-grow: 1; min-height: 500px;
        }
        .editor-toolbar {
            background: #2d2d2d; padding: 10px 15px; display: flex; justify-content: space-between;
            align-items: center; border-bottom: 1px solid #3e3e3e;
        }
        .toolbar-title { color: #d4d4d4; font-size: 13px; font-weight: bold; }
        .toolbar-hint { color: #ffc107; font-size: 12px; margin-left: 15px; flex: 1; }
        .edit-toggle-btn {
            background: #007acc; color: white; border: none; padding: 6px 12px; border-radius: 4px;
            cursor: pointer; font-size: 12px; font-weight: bold; transition: all 0.3s;
        }
        .edit-toggle-btn.editing { background: #28a745; }
        .code-display { background: #1e1e1e; padding: 15px; overflow: auto; flex-grow: 1; }
        .code-display pre { margin: 0; font-family: 'Consolas', monospace; font-size: 14px; line-height: 1.6; }
        .code-textarea {
            width: 100%; height: 100%; background: #1e1e1e; color: #d4d4d4; border: none; padding: 15px;
            font-family: 'Consolas', monospace; font-size: 14px; line-height: 1.6; resize: none;
            outline: none; flex-grow: 1;
        }
        .code-textarea:focus { outline: 2px solid #007acc; outline-offset: -2px; }

        /* ë²„íŠ¼ ë° íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .control-panel { display: flex; gap: 15px; margin-top: 20px; }
        .btn {
            flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;
            transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .btn-analyze { background: #d9534f; color: white; }
        .btn-validate { background: #28a745; color: white; }
        .btn-hint { background: #ffc107; color: #000; }
        .btn-reset { background: #6c757d; color: white; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        .feedback { margin-top: 20px; }
        .feedback-item { padding: 15px; margin-bottom: 10px; border-radius: 8px; animation: slideIn 0.3s ease-out; }
        .feedback-error { background: #fff5f5; border-left: 4px solid #dc3545; }
        .feedback-success { background: #d4edda; border-left: 4px solid #28a745; }
        .feedback-warning { background: #fff3cd; border-left: 4px solid #ffc107; }

        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }

        .hint-panel {
            background: #fff8dc; border: 2px solid #ffc107; border-radius: 10px; padding: 20px;
            margin-top: 20px; display: none;
        }
        .hint-panel.active { display: block; animation: slideIn 0.3s ease-out; }
        .hint-step { background: white; padding: 12px; margin-bottom: 10px; border-radius: 6px; border-left: 3px solid #ffc107; }
        .hint-code { background: #1e1e1e; color: #d4d4d4; padding: 8px; border-radius: 4px; font-family: 'Consolas', monospace; font-size: 13px; margin-top: 5px; }

        .info-section { margin-bottom: 20px; }
        .info-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #d9534f; display: flex; align-items: center; gap: 8px; }
        .info-content { color: #555; line-height: 1.6; }

        @media (max-width: 1200px) { .main-content { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’‰ ì½”ë“œ ì‚½ì… (Code Injection) - ì‹¤ìŠµ ì‹œë®¬ë ˆì´í„°</h1>
            <p>CWE-94: Improper Control of Generation of Code ('Code Injection')</p>
        </div>

        <div class="mode-tabs">
            <button class="mode-tab active" onclick="switchMode('java')">
                <div class="mode-icon">â˜•</div>
                <div class="mode-title">Java ì‹œíì–´ ì½”ë”©</div>
                <div class="mode-desc">ScriptEngine.eval() ì·¨ì•½ì </div>
            </button>
            <button class="mode-tab" onclick="switchMode('python')">
                <div class="mode-icon">ğŸ</div>
                <div class="mode-title">Python ì‹œíì–´ ì½”ë”©</div>
                <div class="mode-desc">eval() í•¨ìˆ˜ ì·¨ì•½ì </div>
            </button>
        </div>

        <!-- Java ëª¨ë“œ -->
        <div id="java-mode" class="content-wrapper active">
            <div class="progress-indicator">
                <div class="progress-title">âœ… í•™ìŠµ ì§„í–‰ë„</div>
                <ul class="checklist" id="progressChecklistJava">
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> ì§„ë‹¨ ì‹œì‘</li>
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> ì·¨ì•½í•œ eval ì¸ì§€</li>
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> ì •ê·œì‹(matches) ê²€ì¦ ì ìš©</li>
                </ul>
            </div>

            <div class="main-content">
                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">âœï¸ Java ì½”ë“œ ì—ë””í„°</span>
                        <span class="status-badge status-vulnerable" id="codeStatusJava">ì·¨ì•½í•œ ì½”ë“œ</span>
                    </div>

                    <div class="code-editor">
                        <div class="editor-toolbar">
                            <span class="toolbar-title">CodeInjectionController.java</span>
                            <span class="toolbar-hint">ğŸ’¡ ì •ê·œì‹ì„ ì´ìš©í•´ íŠ¹ìˆ˜ë¬¸ì ì…ë ¥ ì‹œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ì„¸ìš”</span>
                            <button class="edit-toggle-btn" id="editBtnJava" onclick="toggleEditModeJava()">âœï¸ í¸ì§‘</button>
                        </div>
                        <div class="code-display" id="codeDisplayContainerJava">
                            <pre><code class="language-java" id="codeDisplayJava">import javax.script.*;
import org.springframework.web.bind.annotation.*;

public class CodeInjectionController {
    @RequestMapping(value = "/execute", method = RequestMethod.GET)
    public String execute(@RequestParam("src") String src) throws ScriptException {
        ScriptEngineManager scriptEngineManager = new ScriptEngineManager();
        ScriptEngine scriptEngine = scriptEngineManager.getEngineByName("javascript");
        
        // [ì·¨ì•½ì ] ì™¸ë¶€ ì…ë ¥ê°’ì¸ srcë¥¼ javascript eval í•¨ìˆ˜ë¡œ ì‹¤í–‰í•˜ê³  ìˆì–´ ì•ˆì „í•˜ì§€ ì•Šë‹¤.
        String retValue = (String)scriptEngine.eval(src);
        return retValue;
    }
}</code></pre>
                        </div>
                        <textarea class="code-textarea" id="codeEditorJava" style="display: none;" spellcheck="false">import javax.script.*;
import org.springframework.web.bind.annotation.*;

public class CodeInjectionController {
    @RequestMapping(value = "/execute", method = RequestMethod.GET)
    public String execute(@RequestParam("src") String src) throws ScriptException {
        ScriptEngineManager scriptEngineManager = new ScriptEngineManager();
        ScriptEngine scriptEngine = scriptEngineManager.getEngineByName("javascript");
        
        // [ì·¨ì•½ì ] ì™¸ë¶€ ì…ë ¥ê°’ì¸ srcë¥¼ javascript eval í•¨ìˆ˜ë¡œ ì‹¤í–‰í•˜ê³  ìˆì–´ ì•ˆì „í•˜ì§€ ì•Šë‹¤.
        String retValue = (String)scriptEngine.eval(src);
        return retValue;
    }
}</textarea>
                    </div>

                    <div class="control-panel">
                        <button class="btn btn-analyze" onclick="analyzeCodeJava()">ğŸ” ì§„ë‹¨í•˜ê¸°</button>
                        <button class="btn btn-validate" onclick="validateCodeJava()" id="validateBtnJava" disabled>âœ… ê²€ì¦í•˜ê¸°</button>
                        <button class="btn btn-hint" onclick="toggleHint('java')">ğŸ’¡ íŒíŠ¸</button>
                        <button class="btn btn-reset" onclick="resetCoding('java')">ğŸ”„ ì´ˆê¸°í™”</button>
                    </div>

                    <div class="feedback" id="feedbackJava"></div>

                    <div class="hint-panel" id="hintPanelJava">
                        <div class="info-title">ğŸ’¡ ìˆ˜ì • ê°€ì´ë“œ (ì •ê·œì‹ í•„í„°ë§)</div>
                        <div class="hint-step">
                            <strong>1. ì •ê·œì‹ì„ ì´ìš©í•œ íŠ¹ìˆ˜ë¬¸ì ê²€ì¦</strong>
                            <p>ì…ë ¥ ê°’ì˜ í˜•íƒœì— ë”°ë¼ ì •ê·œ í‘œí˜„ì‹ì„ ì ìš©í•˜ì—¬ ê²€ì¦í•©ë‹ˆë‹¤.</p>
                            <div class="hint-code">
// ì •ê·œì‹ì„ ì´ìš©í•˜ì—¬ íŠ¹ìˆ˜ë¬¸ì ì…ë ¥ì‹œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.
if (src.matches("[\\w]*") == false) {
    throw new IllegalArgumentException();
}
                            </div>
                        </div>
                        <div class="info-title" style="margin-top: 15px;">ğŸ’¡ ìˆ˜ì • ê°€ì´ë“œ (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸)</div>
                        <div class="hint-step">
                            <strong>2. ìœ íš¨í•œ ë¬¸ìë§Œ í—ˆìš© (WhiteList)</strong>
                            <p>í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ë°©ì‹ì„ ì ìš©í•˜ì—¬ ìœ íš¨í•œ ë¬¸ìì¸ ê²½ìš°ì—ë§Œ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
                            <div class="hint-code">
// ìœ íš¨í•œ ë¬¸ì "_" ì¼ ê²½ìš° ì‹¤í–‰í•  ë©”ì†Œë“œ í˜¸ì¶œí•œë‹¤.
if (src.matches("UNDER_BAR") == true) {
    // ...
// ìœ íš¨í•œ ë¬¸ì "$" ì¼ ê²½ìš° ì‹¤í–‰í•  ë©”ì†Œë“œ í˜¸ì¶œí•œë‹¤.
} else if (src.matches("DOLLAR") == true) {
    // ...
// ìœ íš¨í•˜ì§€ ì•Šì€ íŠ¹ìˆ˜ë¬¸ì ì…ë ¥ì‹œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.
} else {
    throw new IllegalArgumentException();
}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">ğŸ“Š ë¶„ì„ ê²°ê³¼ ë° ì„¤ëª…</span>
                    </div>
                    <div id="rightPanelJava">
                        <div class="info-section">
                            <div class="info-title">ğŸ¯ ëª©í‘œ</div>
                            <div class="info-content">
                                <p>ì‚¬ìš©ìì˜ ì…ë ¥ì„ <code>ScriptEngineManager</code>ë¡œ ì‹¤í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê³µê²©ìëŠ” ì¡°ì‘ëœ ì¸ìˆ˜ë¥¼ ì´ìš©í•´ ì‹œìŠ¤í…œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜ íŒŒì¼ì„ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì…ë ¥ ê°’ì„ í•„í„°ë§í•˜ì—¬ ì‚¬ì „ì— ê²€ì¦í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</p>
                            </div>
                        </div>
                        <div class="info-section">
                            <div class="info-title">âš ï¸ í˜„ì¬ ì·¨ì•½ì </div>
                            <div class="info-content">
                                <p style="color: #dc3545; font-weight: bold;">Dynamic Code Execution</p>
                                <p>ì™¸ë¶€ ì…ë ¥ê°’ì¸ <code>src</code>ë¥¼ ê²€ì¦ ì—†ì´ <code>scriptEngine.eval(src)</code>ë¡œ ì‹¤í–‰í•˜ê³  ìˆì–´ ì•ˆì „í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Python ëª¨ë“œ -->
        <div id="python-mode" class="content-wrapper">
            <div class="progress-indicator">
                <div class="progress-title">âœ… í•™ìŠµ ì§„í–‰ë„</div>
                <ul class="checklist" id="progressChecklistPython">
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> ì§„ë‹¨ ì‹œì‘</li>
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> eval() ìœ„í—˜ì„± íŒŒì•…</li>
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> isalnum() ê²€ì¦ ì¶”ê°€</li>
                </ul>
            </div>

            <div class="main-content">
                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">ğŸ Python ì½”ë“œ ì—ë””í„°</span>
                        <span class="status-badge status-vulnerable" id="codeStatusPython">ì·¨ì•½í•œ ì½”ë“œ</span>
                    </div>

                    <div class="code-editor">
                        <div class="editor-toolbar">
                            <span class="toolbar-title">views.py</span>
                            <span class="toolbar-hint">ğŸ’¡ ì…ë ¥ê°’ì´ ì˜ë¬¸/ìˆ«ìì¸ì§€ í™•ì¸í•˜ëŠ” isalnum()ì„ ì‚¬ìš©í•˜ì„¸ìš”</span>
                            <button class="edit-toggle-btn" id="editBtnPython" onclick="toggleEditModePython()">âœï¸ í¸ì§‘</button>
                        </div>
                        <div class="code-display" id="codeDisplayContainerPython">
                            <pre><code class="language-python" id="codeDisplayPython">from django.shortcuts import render

def route(request):
    # ì™¸ë¶€ì—ì„œ ì…ë ¥ë°›ì€ ê°’ì„ ê²€ì¦ ì—†ì´ ì‚¬ìš©í•˜ë©´ ì•ˆì „í•˜ì§€ ì•Šë‹¤
    message = request.POST.get('message', '')
    
    # ì™¸ë¶€ ì…ë ¥ê°’ì„ ê²€ì¦ ì—†ì´ eval í•¨ìˆ˜ì— ì „ë‹¬í•  ê²½ìš° ì˜ë„í•˜ì§€ ì•Šì€ ì½”ë“œê°€
    # ì‹¤í–‰ë  ìˆ˜ ìˆì–´ ìœ„í—˜í•˜ë‹¤
    ret = eval(message)
    
    return render(request, '/success.html', {'data':ret})</code></pre>
                        </div>
                        <textarea class="code-textarea" id="codeEditorPython" style="display: none;" spellcheck="false">from django.shortcuts import render

def route(request):
    # ì™¸ë¶€ì—ì„œ ì…ë ¥ë°›ì€ ê°’ì„ ê²€ì¦ ì—†ì´ ì‚¬ìš©í•˜ë©´ ì•ˆì „í•˜ì§€ ì•Šë‹¤
    message = request.POST.get('message', '')
    
    # ì™¸ë¶€ ì…ë ¥ê°’ì„ ê²€ì¦ ì—†ì´ eval í•¨ìˆ˜ì— ì „ë‹¬í•  ê²½ìš° ì˜ë„í•˜ì§€ ì•Šì€ ì½”ë“œê°€
    # ì‹¤í–‰ë  ìˆ˜ ìˆì–´ ìœ„í—˜í•˜ë‹¤
    ret = eval(message)
    
    return render(request, '/success.html', {'data':ret})</textarea>
                    </div>

                    <div class="control-panel">
                        <button class="btn btn-analyze" onclick="analyzeCodePython()">ğŸ” ì§„ë‹¨í•˜ê¸°</button>
                        <button class="btn btn-validate" onclick="validateCodePython()" id="validateBtnPython" disabled>âœ… ê²€ì¦í•˜ê¸°</button>
                        <button class="btn btn-hint" onclick="toggleHint('python')">ğŸ’¡ íŒíŠ¸</button>
                        <button class="btn btn-reset" onclick="resetCoding('python')">ğŸ”„ ì´ˆê¸°í™”</button>
                    </div>

                    <div class="feedback" id="feedbackPython"></div>

                    <div class="hint-panel" id="hintPanelPython">
                        <div class="info-title">ğŸ’¡ ìˆ˜ì • ê°€ì´ë“œ</div>
                        <div class="hint-step">
                            <strong>1. ì…ë ¥ê°’ ê²€ì¦ (isalnum)</strong>
                            <p>ì‚¬ìš©ì ì…ë ¥ì„ ì˜ë¬¸, ìˆ«ìë¡œ ì œí•œí•˜ì—¬ íŠ¹ìˆ˜ë¬¸ìê°€ í¬í•¨ëœ ê²½ìš° ì—ëŸ¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.</p>
                            <div class="hint-code">
if message.isalnum():
    ret = eval(message)
    return render(request, '/success.html', {'data':ret})
return render(request, '/error.html')
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">ğŸ“Š ë¶„ì„ ê²°ê³¼ ë° ì„¤ëª…</span>
                    </div>
                    <div id="rightPanelPython">
                        <div class="info-section">
                            <div class="info-title">ğŸ¯ ëª©í‘œ</div>
                            <div class="info-content">
                                <p>ì™¸ë¶€ ì…ë ¥ê°’ì„ ê²€ì¦ ì—†ì´ <code>eval()</code>ì— ì‚¬ìš©í•˜ë©´ íŒŒì´ì¬ ì½”ë“œë¥¼ í†µí•œ ì•…ì„± ê¸°ëŠ¥ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì˜ˆ: <code>compile('import time; time.sleep(20)', ...)</code> ë“±ì„ í†µí•œ ì„œë¹„ìŠ¤ ê±°ë¶€ ê³µê²©.</p>
                            </div>
                        </div>
                        <div class="info-section">
                            <div class="info-title">âš ï¸ í˜„ì¬ ì·¨ì•½ì </div>
                            <div class="info-content">
                                <p style="color: #dc3545; font-weight: bold;">Code Injection (CWE-94)</p>
                                <p>ì…ë ¥ê°’ <code>message</code>ë¥¼ ê²€ì¦ ì—†ì´ <code>eval()</code>ë¡œ ì‹¤í–‰í•˜ê³  ìˆì–´ ê³µê²©ìê°€ ì‹œìŠ¤í…œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    
    <script>
        // === ê³µí†µ ë¡œì§ ===
        function switchMode(mode) {
            document.querySelectorAll('.mode-tab').forEach(tab => tab.classList.remove('active'));
            event.target.closest('.mode-tab').classList.add('active');
            
            document.querySelectorAll('.content-wrapper').forEach(w => w.classList.remove('active'));
            document.getElementById(mode + '-mode').classList.add('active');
        }

        function toggleHint(mode) {
            const panel = document.getElementById(mode === 'java' ? 'hintPanelJava' : 'hintPanelPython');
            panel.classList.toggle('active');
        }

        function updateChecklist(listId, index, status) {
            const list = document.getElementById(listId);
            const items = list.getElementsByTagName('li');
            if (items[index]) {
                const icon = items[index].querySelector('.checklist-icon');
                if (status) {
                    items[index].classList.add('completed');
                    icon.textContent = 'âœ…';
                } else {
                    items[index].classList.remove('completed');
                    icon.textContent = 'â¬œ';
                }
            }
        }

        // === Java ë¡œì§ ===
        let isEditingJava = false;

        function toggleEditModeJava() {
            const displayDiv = document.getElementById('codeDisplayContainerJava');
            const editor = document.getElementById('codeEditorJava');
            const btn = document.getElementById('editBtnJava');
            const preCode = document.getElementById('codeDisplayJava');

            isEditingJava = !isEditingJava;

            if (isEditingJava) {
                displayDiv.style.display = 'none';
                editor.style.display = 'block';
                editor.value = preCode.textContent;
                editor.focus();
                btn.textContent = 'ğŸ’¾ ì €ì¥';
                btn.classList.add('editing');
            } else {
                displayDiv.style.display = 'block';
                editor.style.display = 'none';
                preCode.textContent = editor.value;
                if(window.Prism) Prism.highlightElement(preCode);
                btn.textContent = 'âœï¸ í¸ì§‘';
                btn.classList.remove('editing');
            }
        }

        function analyzeCodeJava() {
            updateChecklist('progressChecklistJava', 0, true);
            updateChecklist('progressChecklistJava', 1, true);
            const feedback = document.getElementById('feedbackJava');
            
            feedback.innerHTML = `
                <div class="feedback-item feedback-error">
                    <strong>ğŸš¨ ë³´ì•ˆ ì·¨ì•½ì  ë°œê²¬</strong>
                    <p><code>CodeInjectionController</code>ì—ì„œ ì‚¬ìš©ì ì…ë ¥ <code>src</code>ë¥¼ ê²€ì¦ ì—†ì´ <code>eval()</code>ë¡œ ì‹¤í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ê³µê²©ìê°€ ì„ì˜ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ íŒŒì¼ì„ ì¡°ì‘í•˜ê±°ë‚˜ ì‹œìŠ¤í…œì„ ì¥ì•…í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.</p>
                </div>
            `;
            
            document.getElementById('validateBtnJava').disabled = false;
            document.getElementById('codeStatusJava').textContent = 'ìˆ˜ì • ì¤‘';
            document.getElementById('codeStatusJava').className = 'status-badge status-editing';
        }

        function validateCodeJava() {
            const code = document.getElementById('codeEditorJava').value;
            const feedback = document.getElementById('feedbackJava');
            const rightPanel = document.getElementById('rightPanelJava');
            
            let passed = false;
            let messages = [];

            const hasMatches = code.includes('.matches');
            const hasException = code.includes('throw new IllegalArgumentException');
            
            if (hasMatches && hasException) {
                passed = true;
                updateChecklist('progressChecklistJava', 2, true);
                messages.push("âœ… ì •ê·œí‘œí˜„ì‹(matches)ì„ ì´ìš©í•œ ì…ë ¥ê°’ ê²€ì¦ê³¼ ì˜ˆì™¸ ì²˜ë¦¬ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                updateChecklist('progressChecklistJava', 2, false);
                messages.push("âŒ <code>matches()</code> ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì…ë ¥ê°’ì„ ê²€ì¦í•˜ê³ , ìœ íš¨í•˜ì§€ ì•Šì„ ê²½ìš° <code>IllegalArgumentException</code>ì„ ë°œìƒì‹œì¼œì•¼ í•©ë‹ˆë‹¤.");
            }

            if (passed) {
                feedback.innerHTML = `
                    <div class="feedback-item feedback-success">
                        <strong>ğŸ‰ ê²€ì¦ ì„±ê³µ!</strong>
                        <p>ì•ˆì „í•©ë‹ˆë‹¤! ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ ì…ë ¥ê°’ì„ ì‚¬ì „ì— ê²€ì¦í•˜ì—¬ ì½”ë“œ ì‚½ì… ìœ„í˜‘ì„ ì™„í™”í–ˆìŠµë‹ˆë‹¤.</p>
                        <br>${messages.join('<br>')}
                    </div>
                `;
                document.getElementById('codeStatusJava').textContent = 'ì•ˆì „í•œ ì½”ë“œ';
                document.getElementById('codeStatusJava').className = 'status-badge status-secure';
                
                rightPanel.innerHTML = `
                    <div class="info-section">
                        <div class="info-title">âœ… ì•ˆì „í•œ ìƒíƒœ</div>
                        <div class="info-content">
                            <p style="color: #28a745"><strong>Secure Coding ì ìš© ì™„ë£Œ</strong></p>
                            <p>ì…ë ¥ ê°’ì˜ í˜•íƒœì— ë”°ë¼ ì •ê·œ í‘œí˜„ì‹ì„ ì ìš©í•˜ê±°ë‚˜, í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ìœ íš¨í•œ ë¬¸ìì¸ ê²½ìš°ì—ë§Œ ì‹¤í–‰ë˜ë„ë¡ ì¡°ì¹˜í–ˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                `;
            } else {
                feedback.innerHTML = `
                    <div class="feedback-item feedback-warning">
                        <strong>âš ï¸ ë³´ì™„ í•„ìš”</strong>
                        <br>${messages.join('<br>')}
                    </div>
                `;
            }
        }

        function resetCoding(mode) {
            if (mode === 'java') {
                const initialJava = `import javax.script.*;
import org.springframework.web.bind.annotation.*;

public class CodeInjectionController {
    @RequestMapping(value = "/execute", method = RequestMethod.GET)
    public String execute(@RequestParam("src") String src) throws ScriptException {
        ScriptEngineManager scriptEngineManager = new ScriptEngineManager();
        ScriptEngine scriptEngine = scriptEngineManager.getEngineByName("javascript");
        
        // [ì·¨ì•½ì ] ì™¸ë¶€ ì…ë ¥ê°’ì¸ srcë¥¼ javascript eval í•¨ìˆ˜ë¡œ ì‹¤í–‰í•˜ê³  ìˆì–´ ì•ˆì „í•˜ì§€ ì•Šë‹¤.
        String retValue = (String)scriptEngine.eval(src);
        return retValue;
    }
}`;
                document.getElementById('codeEditorJava').value = initialJava;
                document.getElementById('codeDisplayJava').textContent = initialJava;
                if(window.Prism) Prism.highlightElement(document.getElementById('codeDisplayJava'));
                document.getElementById('feedbackJava').innerHTML = '';
                document.getElementById('validateBtnJava').disabled = true;
                document.getElementById('codeStatusJava').className = 'status-badge status-vulnerable';
                document.getElementById('codeStatusJava').textContent = 'ì·¨ì•½í•œ ì½”ë“œ';
                
                for(let i=0; i<3; i++) updateChecklist('progressChecklistJava', i, false);
            } else {
                resetCodingPython();
            }
        }

        // === Python ë¡œì§ ===
        let isEditingPython = false;

        function toggleEditModePython() {
            const displayDiv = document.getElementById('codeDisplayContainerPython');
            const editor = document.getElementById('codeEditorPython');
            const btn = document.getElementById('editBtnPython');
            const preCode = document.getElementById('codeDisplayPython');

            isEditingPython = !isEditingPython;

            if (isEditingPython) {
                displayDiv.style.display = 'none';
                editor.style.display = 'block';
                editor.value = preCode.textContent;
                editor.focus();
                btn.textContent = 'ğŸ’¾ ì €ì¥';
                btn.classList.add('editing');
            } else {
                displayDiv.style.display = 'block';
                editor.style.display = 'none';
                preCode.textContent = editor.value;
                if(window.Prism) Prism.highlightElement(preCode);
                btn.textContent = 'âœï¸ í¸ì§‘';
                btn.classList.remove('editing');
            }
        }

        function analyzeCodePython() {
            updateChecklist('progressChecklistPython', 0, true);
            updateChecklist('progressChecklistPython', 1, true);
            const feedback = document.getElementById('feedbackPython');
            
            feedback.innerHTML = `
                <div class="feedback-item feedback-error">
                    <strong>ğŸš¨ ë³´ì•ˆ ì·¨ì•½ì  ë°œê²¬</strong>
                    <p>ì…ë ¥ê°’ì„ <code>eval(message)</code>ì— ì§ì ‘ ì‚¬ìš©í•˜ê³  ìˆì–´, ê³µê²©ìê°€ <code>compile()</code> ë“±ì„ í†µí•´ ì•…ì„± ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            `;
            
            document.getElementById('validateBtnPython').disabled = false;
            document.getElementById('codeStatusPython').textContent = 'ìˆ˜ì • ì¤‘';
            document.getElementById('codeStatusPython').className = 'status-badge status-editing';
        }

        function validateCodePython() {
            const code = document.getElementById('codeEditorPython').value;
            const feedback = document.getElementById('feedbackPython');
            const rightPanel = document.getElementById('rightPanelPython');
            
            let passed = false;
            let messages = [];

            // ê²€ì¦ ë¡œì§: isalnum() ì‚¬ìš© ì—¬ë¶€ í™•ì¸
            if (code.includes('isalnum()')) {
                passed = true;
                updateChecklist('progressChecklistPython', 2, true);
                messages.push("âœ… isalnum()ì„ ì´ìš©í•œ ì…ë ¥ê°’ ê²€ì¦ ì½”ë“œê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                updateChecklist('progressChecklistPython', 2, false);
                messages.push("âŒ <code>isalnum()</code> ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì…ë ¥ê°’ì´ ì˜ë¬¸/ìˆ«ìì¸ì§€ ê²€ì¦í•´ì•¼ í•©ë‹ˆë‹¤.");
            }

            if (passed) {
                feedback.innerHTML = `
                    <div class="feedback-item feedback-success">
                        <strong>ğŸ‰ ê²€ì¦ ì„±ê³µ!</strong>
                        <p>í›Œë¥­í•©ë‹ˆë‹¤! ì…ë ¥ê°’ì´ ì˜ë¬¸ê³¼ ìˆ«ìë¡œë§Œ êµ¬ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì—¬ ì•…ì„± íŠ¹ìˆ˜ë¬¸ìë‚˜ ì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë§‰ì•˜ìŠµë‹ˆë‹¤.</p>
                        <br>${messages.join('<br>')}
                    </div>
                `;
                document.getElementById('codeStatusPython').textContent = 'ì•ˆì „í•œ ì½”ë“œ';
                document.getElementById('codeStatusPython').className = 'status-badge status-secure';

                rightPanel.innerHTML = `
                    <div class="info-section">
                        <div class="info-title">âœ… ì•ˆì „í•œ ìƒíƒœ</div>
                        <div class="info-content">
                            <p style="color: #28a745"><strong>Secure Coding ì ìš© ì™„ë£Œ</strong></p>
                            <p>ì‚¬ìš©ì ì…ë ¥ì„ ì˜ë¬¸, ìˆ«ìë¡œ ì—„ê²©í•˜ê²Œ ì œí•œí•˜ì—¬ ì½”ë“œ ì‚½ì… ê³µê²© ìœ„í—˜ì„ ì™„í™”í–ˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                `;
            } else {
                feedback.innerHTML = `
                    <div class="feedback-item feedback-warning">
                        <strong>âš ï¸ ë³´ì™„ í•„ìš”</strong>
                        <br>${messages.join('<br>')}
                    </div>
                `;
            }
        }

        function resetCodingPython() {
            const initialPython = `from django.shortcuts import render

def route(request):
    # ì™¸ë¶€ì—ì„œ ì…ë ¥ë°›ì€ ê°’ì„ ê²€ì¦ ì—†ì´ ì‚¬ìš©í•˜ë©´ ì•ˆì „í•˜ì§€ ì•Šë‹¤
    message = request.POST.get('message', '')
    
    # ì™¸ë¶€ ì…ë ¥ê°’ì„ ê²€ì¦ ì—†ì´ eval í•¨ìˆ˜ì— ì „ë‹¬í•  ê²½ìš° ì˜ë„í•˜ì§€ ì•Šì€ ì½”ë“œê°€
    # ì‹¤í–‰ë  ìˆ˜ ìˆì–´ ìœ„í—˜í•˜ë‹¤
    ret = eval(message)
    
    return render(request, '/success.html', {'data':ret})`;

            document.getElementById('codeEditorPython').value = initialPython;
            document.getElementById('codeDisplayPython').textContent = initialPython;
            if(window.Prism) Prism.highlightElement(document.getElementById('codeDisplayPython'));
            document.getElementById('feedbackPython').innerHTML = '';
            document.getElementById('validateBtnPython').disabled = true;
            document.getElementById('codeStatusPython').className = 'status-badge status-vulnerable';
            document.getElementById('codeStatusPython').textContent = 'ì·¨ì•½í•œ ì½”ë“œ';

            for(let i=0; i<3; i++) updateChecklist('progressChecklistPython', i, false);
        }
    </script>
</body>
</html>