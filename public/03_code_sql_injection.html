<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL ì‚½ì… (SQL Injection) - ì‹¤ìŠµ ì‹œë®¬ë ˆì´í„°</title>
    <!-- Prism.js for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(135deg, #1c92d2 0%, #f2fcfe 100%); /* ë°ì´í„°ë² ì´ìŠ¤ ëŠë‚Œì˜ ì²­ë¡ìƒ‰ í…Œë§ˆ */
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            border-bottom: 5px solid #005c97;
        }

        .header h1 {
            color: #005c97;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        /* íƒ­ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .mode-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .mode-tab {
            flex: 1;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .mode-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .mode-tab.active {
            background: linear-gradient(135deg, #005c97 0%, #363795 100%);
            color: white;
        }

        .mode-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .mode-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mode-desc {
            font-size: 13px;
            opacity: 0.8;
        }

        /* ì½˜í…ì¸  ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .content-wrapper {
            display: none;
        }

        .content-wrapper.active {
            display: block;
        }

        /* ì§„í–‰ ìƒíƒœ í‘œì‹œì¤„ */
        .progress-indicator {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .progress-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .checklist {
            list-style: none;
            padding: 0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .checklist-item {
            padding: 8px 15px;
            background: #f8f9fa;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            border: 1px solid #e9ecef;
            transition: all 0.3s;
        }

        .checklist-item.completed {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* ë©”ì¸ ì½˜í…ì¸  ë ˆì´ì•„ì›ƒ */
        .main-content {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #f0f0f0;
        }

        .panel-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
        }

        .status-vulnerable { background: #dc3545; color: white; }
        .status-secure { background: #28a745; color: white; }
        .status-editing { background: #ffc107; color: #000; }

        /* ì½”ë“œ ì—ë””í„° ìŠ¤íƒ€ì¼ */
        .code-editor {
            background: #1e1e1e;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            min-height: 500px;
        }

        .editor-toolbar {
            background: #2d2d2d;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #3e3e3e;
        }

        .toolbar-title { color: #d4d4d4; font-size: 13px; font-weight: bold; }
        .toolbar-hint { color: #ffc107; font-size: 12px; margin-left: 15px; flex: 1; }

        .edit-toggle-btn {
            background: #007acc;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .edit-toggle-btn.editing { background: #28a745; }

        .code-display {
            background: #1e1e1e;
            padding: 15px;
            overflow: auto;
            flex-grow: 1;
        }

        .code-display pre {
            margin: 0;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.6;
        }

        .code-textarea {
            width: 100%;
            height: 100%;
            background: #1e1e1e;
            color: #d4d4d4;
            border: none;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
            flex-grow: 1;
        }

        .code-textarea:focus { outline: 2px solid #007acc; outline-offset: -2px; }

        /* ë²„íŠ¼ ë° íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .control-panel {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-analyze { background: #005c97; color: white; }
        .btn-validate { background: #28a745; color: white; }
        .btn-hint { background: #ffc107; color: #000; }
        .btn-reset { background: #6c757d; color: white; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        .feedback { margin-top: 20px; }

        .feedback-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            animation: slideIn 0.3s ease-out;
        }

        .feedback-error { background: #fff5f5; border-left: 4px solid #dc3545; }
        .feedback-success { background: #d4edda; border-left: 4px solid #28a745; }
        .feedback-warning { background: #fff3cd; border-left: 4px solid #ffc107; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .hint-panel {
            background: #fff8dc;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .hint-panel.active { display: block; animation: slideIn 0.3s ease-out; }

        .hint-step {
            background: white;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 3px solid #ffc107;
        }

        .hint-code {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 8px;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            margin-top: 5px;
        }

        .info-section { margin-bottom: 20px; }
        .info-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #005c97; display: flex; align-items: center; gap: 8px; }
        .info-content { color: #555; line-height: 1.6; }
        .code-highlight { color: #e83e8c; background: #f8f9fa; padding: 2px 4px; border-radius: 3px; font-family: monospace; }

        @media (max-width: 1200px) {
            .main-content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’‰ SQL ì‚½ì… (SQL Injection) - ì‹¤ìŠµ ì‹œë®¬ë ˆì´í„°</h1>
            <p>CWE-89: Improper Neutralization of Special Elements used in an SQL Command</p>
        </div>

        <div class="mode-tabs">
            <button class="mode-tab active" onclick="switchMode('java')">
                <div class="mode-icon">â˜•</div>
                <div class="mode-title">Java ì‹œíì–´ ì½”ë”©</div>
                <div class="mode-desc">PreparedStatement ì‚¬ìš©</div>
            </button>
            <button class="mode-tab" onclick="switchMode('python')">
                <div class="mode-icon">ğŸ</div>
                <div class="mode-title">Python ì‹œíì–´ ì½”ë”©</div>
                <div class="mode-desc">Parameterized Query ì‚¬ìš©</div>
            </button>
        </div>

        <!-- Java ëª¨ë“œ -->
        <div id="java-mode" class="content-wrapper active">
            <div class="progress-indicator">
                <div class="progress-title">âœ… í•™ìŠµ ì§„í–‰ë„</div>
                <ul class="checklist" id="progressChecklistJava">
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> ì§„ë‹¨ ì‹œì‘</li>
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> Statement ì œê±°</li>
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> PreparedStatement ì ìš©</li>
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> ë°”ì¸ë”© ë³€ìˆ˜(?) ì‚¬ìš©</li>
                </ul>
            </div>

            <div class="main-content">
                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">âœï¸ Java ì½”ë“œ ì—ë””í„°</span>
                        <span class="status-badge status-vulnerable" id="codeStatusJava">ì·¨ì•½í•œ ì½”ë“œ</span>
                    </div>

                    <div class="code-editor">
                        <div class="editor-toolbar">
                            <span class="toolbar-title">UserDao.java</span>
                            <span class="toolbar-hint">ğŸ’¡ PreparedStatementë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ë¥¼ ì•ˆì „í•˜ê²Œ ë§Œë“œì„¸ìš”</span>
                            <button class="edit-toggle-btn" id="editBtnJava" onclick="toggleEditModeJava()">âœï¸ í¸ì§‘</button>
                        </div>
                        <div class="code-display" id="codeDisplayContainerJava">
                            <pre><code class="language-java" id="codeDisplayJava">import java.sql.*;

public class UserDao {
    public void getUser(Connection conn, String userId) throws SQLException {
        Statement stmt = null;
        ResultSet rs = null;
        
        try {
            // [ì·¨ì•½ì ] ì™¸ë¶€ ì…ë ¥ê°’(userId)ì´ ì¿¼ë¦¬ ë¬¸ìì—´ì— ê·¸ëŒ€ë¡œ ì—°ê²°ë¨
            // ê³µê²©ìê°€ ' OR '1'='1 ì…ë ¥ì„ ì£¼ë©´ ëª¨ë“  ì‚¬ìš©ì ì •ë³´ê°€ ìœ ì¶œë¨
            String query = "SELECT * FROM users WHERE id = '" + userId + "'";
            
            stmt = conn.createStatement();
            rs = stmt.executeQuery(query);
            
            while(rs.next()) {
                System.out.println("User: " + rs.getString("username"));
            }
        } finally {
            if (rs != null) rs.close();
            if (stmt != null) stmt.close();
        }
    }
}</code></pre>
                        </div>
                        <textarea class="code-textarea" id="codeEditorJava" style="display: none;" spellcheck="false">import java.sql.*;

public class UserDao {
    public void getUser(Connection conn, String userId) throws SQLException {
        Statement stmt = null;
        ResultSet rs = null;
        
        try {
            // [ì·¨ì•½ì ] ì™¸ë¶€ ì…ë ¥ê°’(userId)ì´ ì¿¼ë¦¬ ë¬¸ìì—´ì— ê·¸ëŒ€ë¡œ ì—°ê²°ë¨
            // ê³µê²©ìê°€ ' OR '1'='1 ì…ë ¥ì„ ì£¼ë©´ ëª¨ë“  ì‚¬ìš©ì ì •ë³´ê°€ ìœ ì¶œë¨
            String query = "SELECT * FROM users WHERE id = '" + userId + "'";
            
            stmt = conn.createStatement();
            rs = stmt.executeQuery(query);
            
            while(rs.next()) {
                System.out.println("User: " + rs.getString("username"));
            }
        } finally {
            if (rs != null) rs.close();
            if (stmt != null) stmt.close();
        }
    }
}</textarea>
                    </div>

                    <div class="control-panel">
                        <button class="btn btn-analyze" onclick="analyzeCodeJava()">ğŸ” ì§„ë‹¨í•˜ê¸°</button>
                        <button class="btn btn-validate" onclick="validateCodeJava()" id="validateBtnJava" disabled>âœ… ê²€ì¦í•˜ê¸°</button>
                        <button class="btn btn-hint" onclick="toggleHint('java')">ğŸ’¡ íŒíŠ¸</button>
                        <button class="btn btn-reset" onclick="resetCoding('java')">ğŸ”„ ì´ˆê¸°í™”</button>
                    </div>

                    <div class="feedback" id="feedbackJava"></div>

                    <div class="hint-panel" id="hintPanelJava">
                        <div class="info-title">ğŸ’¡ ìˆ˜ì • ê°€ì´ë“œ</div>
                        <div class="hint-step">
                            <strong>1. ì¿¼ë¦¬ ë¬¸ìì—´ ìˆ˜ì •</strong>
                            <p>ì…ë ¥ê°’ì„ ì—°ê²°í•˜ëŠ” ëŒ€ì‹  ë¬¼ìŒí‘œ(?)ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</p>
                            <div class="hint-code">String query = "SELECT * FROM users WHERE id = ?";</div>
                        </div>
                        <div class="hint-step">
                            <strong>2. PreparedStatement ê°ì²´ ì‚¬ìš©</strong>
                            <p>createStatement() ëŒ€ì‹  prepareStatement(query)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
                            <div class="hint-code">PreparedStatement pstmt = conn.prepareStatement(query);</div>
                        </div>
                        <div class="hint-step">
                            <strong>3. ê°’ ë°”ì¸ë”©</strong>
                            <p>ë¬¼ìŒí‘œ ìœ„ì¹˜ì— ì‹¤ì œ ê°’ì„ í• ë‹¹í•©ë‹ˆë‹¤.</p>
                            <div class="hint-code">pstmt.setString(1, userId);</div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">ğŸ“Š ë¶„ì„ ê²°ê³¼ ë° ì„¤ëª…</span>
                    </div>
                    <div id="rightPanelJava">
                        <div class="info-section">
                            <div class="info-title">ğŸ¯ ëª©í‘œ</div>
                            <div class="info-content">
                                <p>í˜„ì¬ ì½”ë“œëŠ” ë¬¸ìì—´ ê²°í•©ì„ í†µí•´ SQL ì¿¼ë¦¬ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŠ” <strong>SQL Injection</strong> ê³µê²©ì— ë§¤ìš° ì·¨ì•½í•©ë‹ˆë‹¤. <code>PreparedStatement</code>ì™€ <code>?</code> ë°”ì¸ë”© ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ì˜ êµ¬ì¡°ì™€ ë°ì´í„°ë¥¼ ë¶„ë¦¬í•˜ì„¸ìš”.</p>
                            </div>
                        </div>
                        <div class="info-section">
                            <div class="info-title">âš ï¸ í˜„ì¬ ì·¨ì•½ì </div>
                            <div class="info-content">
                                <p style="color: #dc3545; font-weight: bold;">Dynamic SQL Generation</p>
                                <p>ì…ë ¥ê°’ <code>userId</code>ê°€ ê²€ì¦ ì—†ì´ ì¿¼ë¦¬ì— í¬í•¨ë©ë‹ˆë‹¤. ë§Œì•½ ì…ë ¥ê°’ì´ <code>admin' --</code>ë¼ë©´, ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ì—†ì´ ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Python ëª¨ë“œ -->
        <div id="python-mode" class="content-wrapper">
            <div class="progress-indicator">
                <div class="progress-title">âœ… í•™ìŠµ ì§„í–‰ë„</div>
                <ul class="checklist" id="progressChecklistPython">
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> ì§„ë‹¨ ì‹œì‘</li>
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> ë¬¸ìì—´ í¬ë§·íŒ… ì œê±°</li>
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë¶„ë¦¬</li>
                    <li class="checklist-item"><span class="checklist-icon">â¬œ</span> íŠœí”Œ í˜•íƒœë¡œ ì „ë‹¬</li>
                </ul>
            </div>

            <div class="main-content">
                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">ğŸ Python ì½”ë“œ ì—ë””í„°</span>
                        <span class="status-badge status-vulnerable" id="codeStatusPython">ì·¨ì•½í•œ ì½”ë“œ</span>
                    </div>

                    <div class="code-editor">
                        <div class="editor-toolbar">
                            <span class="toolbar-title">db_access.py</span>
                            <span class="toolbar-hint">ğŸ’¡ %s í¬ë§· ìŠ¤íŠ¸ë§ê³¼ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì„ ì‚¬ìš©í•˜ì„¸ìš”</span>
                            <button class="edit-toggle-btn" id="editBtnPython" onclick="toggleEditModePython()">âœï¸ í¸ì§‘</button>
                        </div>
                        <div class="code-display" id="codeDisplayContainerPython">
                            <pre><code class="language-python" id="codeDisplayPython">import sqlite3

def get_user_info(user_id):
    conn = sqlite3.connect('example.db')
    cursor = conn.cursor()
    
    # [ì·¨ì•½ì ] Pythonì˜ f-stringì´ë‚˜ % ì—°ì‚°ìë¡œ ì¿¼ë¦¬ ì¡°ì‘
    # ì…ë ¥ê°’ì´ ê·¸ëŒ€ë¡œ ì¿¼ë¦¬ì˜ ì¼ë¶€ê°€ ë˜ì–´ ì‹¤í–‰ë¨
    query = f"SELECT * FROM users WHERE id = '{user_id}'"
    
    try:
        # ì¿¼ë¦¬ ë¬¸ìì—´ í•˜ë‚˜ë§Œ ì „ë‹¬í•˜ê³  ìˆìŒ
        cursor.execute(query)
        result = cursor.fetchone()
        return result
    finally:
        conn.close()</code></pre>
                        </div>
                        <textarea class="code-textarea" id="codeEditorPython" style="display: none;" spellcheck="false">import sqlite3

def get_user_info(user_id):
    conn = sqlite3.connect('example.db')
    cursor = conn.cursor()
    
    # [ì·¨ì•½ì ] Pythonì˜ f-stringì´ë‚˜ % ì—°ì‚°ìë¡œ ì¿¼ë¦¬ ì¡°ì‘
    # ì…ë ¥ê°’ì´ ê·¸ëŒ€ë¡œ ì¿¼ë¦¬ì˜ ì¼ë¶€ê°€ ë˜ì–´ ì‹¤í–‰ë¨
    query = f"SELECT * FROM users WHERE id = '{user_id}'"
    
    try:
        # ì¿¼ë¦¬ ë¬¸ìì—´ í•˜ë‚˜ë§Œ ì „ë‹¬í•˜ê³  ìˆìŒ
        cursor.execute(query)
        result = cursor.fetchone()
        return result
    finally:
        conn.close()</textarea>
                    </div>

                    <div class="control-panel">
                        <button class="btn btn-analyze" onclick="analyzeCodePython()">ğŸ” ì§„ë‹¨í•˜ê¸°</button>
                        <button class="btn btn-validate" onclick="validateCodePython()" id="validateBtnPython" disabled>âœ… ê²€ì¦í•˜ê¸°</button>
                        <button class="btn btn-hint" onclick="toggleHint('python')">ğŸ’¡ íŒíŠ¸</button>
                        <button class="btn btn-reset" onclick="resetCoding('python')">ğŸ”„ ì´ˆê¸°í™”</button>
                    </div>

                    <div class="feedback" id="feedbackPython"></div>

                    <div class="hint-panel" id="hintPanelPython">
                        <div class="info-title">ğŸ’¡ ìˆ˜ì • ê°€ì´ë“œ</div>
                        <div class="hint-step">
                            <strong>1. ì¿¼ë¦¬ ë¬¸ìì—´ ë¶„ë¦¬</strong>
                            <p>ê°’ì„ ì§ì ‘ ë„£ì§€ ë§ê³ , ë°ì´í„°ë² ì´ìŠ¤ ë“œë¼ì´ë²„ê°€ ì œê³µí•˜ëŠ” í”Œë ˆì´ìŠ¤í™€ë”(? ë˜ëŠ” %s)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. (SQLiteëŠ” ? ì‚¬ìš©)</p>
                            <div class="hint-code">query = "SELECT * FROM users WHERE id = ?"</div>
                        </div>
                        <div class="hint-step">
                            <strong>2. execute ë©”ì„œë“œ ìˆ˜ì •</strong>
                            <p>ë‘ ë²ˆì§¸ ì¸ìë¡œ ë°ì´í„°ë¥¼ íŠœí”Œ í˜•íƒœë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.</p>
                            <div class="hint-code">cursor.execute(query, (user_id,))</div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <span class="panel-title">ğŸ“Š ë¶„ì„ ê²°ê³¼ ë° ì„¤ëª…</span>
                    </div>
                    <div id="rightPanelPython">
                        <div class="info-section">
                            <div class="info-title">ğŸ¯ ëª©í‘œ</div>
                            <div class="info-content">
                                <p>íŒŒì´ì¬ì˜ DB APIëŠ” <strong>Parameterized Query</strong>ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ë¬¸ìì—´ í¬ë§·íŒ…(f-string, %) ëŒ€ì‹ , ì¿¼ë¦¬ì™€ ë°ì´í„°ë¥¼ ë¶„ë¦¬í•˜ì—¬ <code>execute()</code> ë©”ì„œë“œì— ì „ë‹¬í•˜ë„ë¡ ìˆ˜ì •í•˜ì„¸ìš”.</p>
                            </div>
                        </div>
                        <div class="info-section">
                            <div class="info-title">âš ï¸ í˜„ì¬ ì·¨ì•½ì </div>
                            <div class="info-content">
                                <p style="color: #dc3545; font-weight: bold;">Improper Query Construction</p>
                                <p><code>f-string</code>ì´ë‚˜ <code>+</code> ì—°ì‚°ìë¡œ ì¿¼ë¦¬ë¥¼ ë§Œë“¤ë©´, ë°ì´í„°ë² ì´ìŠ¤ ì—”ì§„ì€ ì–´ë””ê¹Œì§€ê°€ ì½”ë“œì´ê³  ì–´ë””ê¹Œì§€ê°€ ë°ì´í„°ì¸ì§€ êµ¬ë³„í•  ìˆ˜ ì—†ê²Œ ë˜ì–´ ê³µê²©ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    
    <script>
        // === ê³µí†µ ë¡œì§ ===
        function switchMode(mode) {
            document.querySelectorAll('.mode-tab').forEach(tab => tab.classList.remove('active'));
            event.target.closest('.mode-tab').classList.add('active');
            
            document.querySelectorAll('.content-wrapper').forEach(w => w.classList.remove('active'));
            document.getElementById(mode + '-mode').classList.add('active');
        }

        function toggleHint(mode) {
            const panel = document.getElementById(mode === 'java' ? 'hintPanelJava' : 'hintPanelPython');
            panel.classList.toggle('active');
        }

        function updateChecklist(listId, index, status) {
            const list = document.getElementById(listId);
            const items = list.getElementsByTagName('li');
            if (items[index]) {
                const icon = items[index].querySelector('.checklist-icon');
                if (status) {
                    items[index].classList.add('completed');
                    icon.textContent = 'âœ…';
                } else {
                    items[index].classList.remove('completed');
                    icon.textContent = 'â¬œ';
                }
            }
        }

        // === Java ë¡œì§ ===
        let isEditingJava = false;

        function toggleEditModeJava() {
            const displayDiv = document.getElementById('codeDisplayContainerJava');
            const editor = document.getElementById('codeEditorJava');
            const btn = document.getElementById('editBtnJava');
            const preCode = document.getElementById('codeDisplayJava');

            isEditingJava = !isEditingJava;

            if (isEditingJava) {
                displayDiv.style.display = 'none';
                editor.style.display = 'block';
                editor.value = preCode.textContent;
                editor.focus();
                btn.textContent = 'ğŸ’¾ ì €ì¥';
                btn.classList.add('editing');
            } else {
                displayDiv.style.display = 'block';
                editor.style.display = 'none';
                preCode.textContent = editor.value;
                Prism.highlightElement(preCode);
                btn.textContent = 'âœï¸ í¸ì§‘';
                btn.classList.remove('editing');
            }
        }

        function analyzeCodeJava() {
            updateChecklist('progressChecklistJava', 0, true);
            const feedback = document.getElementById('feedbackJava');
            
            feedback.innerHTML = `
                <div class="feedback-item feedback-error">
                    <strong>ğŸš¨ ë³´ì•ˆ ì·¨ì•½ì  ë°œê²¬</strong>
                    <p>í˜„ì¬ ì½”ë“œëŠ” <code>Statement</code>ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©° ë¬¸ìì—´ ì—°ê²°(concatenation)ë¡œ ì¿¼ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ëŠ” ì „í˜•ì ì¸ SQL Injection íŒ¨í„´ì…ë‹ˆë‹¤.</p>
                </div>
            `;
            
            document.getElementById('validateBtnJava').disabled = false;
            document.getElementById('codeStatusJava').textContent = 'ìˆ˜ì • ì¤‘';
            document.getElementById('codeStatusJava').className = 'status-badge status-editing';
        }

        function validateCodeJava() {
            const code = document.getElementById('codeEditorJava').value;
            const feedback = document.getElementById('feedbackJava');
            const rightPanel = document.getElementById('rightPanelJava');
            
            let passed = true;
            let messages = [];

            // 1. Statement ì œê±° ë° PreparedStatement ì‚¬ìš© í™•ì¸
            if (code.includes('PreparedStatement') && !code.includes('Statement stmt =')) {
                updateChecklist('progressChecklistJava', 1, true);
                updateChecklist('progressChecklistJava', 2, true);
                messages.push("âœ… PreparedStatement ê°ì²´ê°€ ì˜¬ë°”ë¥´ê²Œ ì„ ì–¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                passed = false;
                updateChecklist('progressChecklistJava', 1, false);
                messages.push("âŒ Statement ëŒ€ì‹  PreparedStatementë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.");
            }

            // 2. ë°”ì¸ë”© ë³€ìˆ˜(?) ì‚¬ìš© í™•ì¸
            if (code.includes('id = ?') || code.includes('id=?')) {
                updateChecklist('progressChecklistJava', 3, true);
                messages.push("âœ… ì¿¼ë¦¬ì— ë°”ì¸ë”© ë³€ìˆ˜(?)ê°€ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                passed = false;
                updateChecklist('progressChecklistJava', 3, false);
                messages.push("âŒ ì¿¼ë¦¬ ì¡°ê±´ì ˆì— 'id = ?'ì™€ ê°™ì´ ë¬¼ìŒí‘œë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.");
            }

            // 3. setString ì‚¬ìš© í™•ì¸
            if (code.includes('.setString(1, userId)')) {
                messages.push("âœ… ì…ë ¥ê°’ì´ ì•ˆì „í•˜ê²Œ ë°”ì¸ë”©ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                passed = false;
                messages.push("âŒ .setString() ë©”ì„œë“œë¡œ ê°’ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.");
            }

            if (passed) {
                feedback.innerHTML = `
                    <div class="feedback-item feedback-success">
                        <strong>ğŸ‰ ê²€ì¦ ì„±ê³µ!</strong>
                        <p>í›Œë¥­í•©ë‹ˆë‹¤! PreparedStatementë¥¼ ì‚¬ìš©í•˜ì—¬ SQL Injection ê³µê²©ì„ ì™„ë²½í•˜ê²Œ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤.</p>
                        <br>
                        ${messages.join('<br>')}
                    </div>
                `;
                document.getElementById('codeStatusJava').textContent = 'ì•ˆì „í•œ ì½”ë“œ';
                document.getElementById('codeStatusJava').className = 'status-badge status-secure';
                
                rightPanel.innerHTML = `
                    <div class="info-section">
                        <div class="info-title">âœ… ì•ˆì „í•œ ìƒíƒœ</div>
                        <div class="info-content">
                            <p style="color: #28a745"><strong>Secure Coding ì ìš© ì™„ë£Œ</strong></p>
                            <p>PreparedStatementëŠ” ì¿¼ë¦¬ë¥¼ ë¯¸ë¦¬ ì»´íŒŒì¼í•˜ì—¬ êµ¬ì¡°ë¥¼ ê³ ì •í•œ ë’¤, ë°ì´í„°ë¥¼ ë‚˜ì¤‘ì— ì£¼ì…í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì…ë ¥ê°’ì— íŠ¹ìˆ˜ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆì–´ë„ ì¿¼ë¦¬ êµ¬ì¡°ê°€ ë°”ë€Œì§€ ì•Šì•„ ì•ˆì „í•©ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                `;
            } else {
                feedback.innerHTML = `
                    <div class="feedback-item feedback-warning">
                        <strong>âš ï¸ ë³´ì™„ í•„ìš”</strong>
                        <br>
                        ${messages.join('<br>')}
                    </div>
                `;
            }
        }

        function resetCoding(mode) {
            if (mode === 'java') {
                const initialJava = `import java.sql.*;

public class UserDao {
    public void getUser(Connection conn, String userId) throws SQLException {
        Statement stmt = null;
        ResultSet rs = null;
        
        try {
            // [ì·¨ì•½ì ] ì™¸ë¶€ ì…ë ¥ê°’(userId)ì´ ì¿¼ë¦¬ ë¬¸ìì—´ì— ê·¸ëŒ€ë¡œ ì—°ê²°ë¨
            // ê³µê²©ìê°€ ' OR '1'='1 ì…ë ¥ì„ ì£¼ë©´ ëª¨ë“  ì‚¬ìš©ì ì •ë³´ê°€ ìœ ì¶œë¨
            String query = "SELECT * FROM users WHERE id = '" + userId + "'";
            
            stmt = conn.createStatement();
            rs = stmt.executeQuery(query);
            
            while(rs.next()) {
                System.out.println("User: " + rs.getString("username"));
            }
        } finally {
            if (rs != null) rs.close();
            if (stmt != null) stmt.close();
        }
    }
}`;
                document.getElementById('codeEditorJava').value = initialJava;
                document.getElementById('codeDisplayJava').textContent = initialJava;
                Prism.highlightElement(document.getElementById('codeDisplayJava'));
                document.getElementById('feedbackJava').innerHTML = '';
                document.getElementById('validateBtnJava').disabled = true;
                document.getElementById('codeStatusJava').className = 'status-badge status-vulnerable';
                document.getElementById('codeStatusJava').textContent = 'ì·¨ì•½í•œ ì½”ë“œ';
                
                for(let i=0; i<4; i++) updateChecklist('progressChecklistJava', i, false);
            } else {
                resetCodingPython();
            }
        }

        // === Python ë¡œì§ ===
        let isEditingPython = false;

        function toggleEditModePython() {
            const displayDiv = document.getElementById('codeDisplayContainerPython');
            const editor = document.getElementById('codeEditorPython');
            const btn = document.getElementById('editBtnPython');
            const preCode = document.getElementById('codeDisplayPython');

            isEditingPython = !isEditingPython;

            if (isEditingPython) {
                displayDiv.style.display = 'none';
                editor.style.display = 'block';
                editor.value = preCode.textContent;
                editor.focus();
                btn.textContent = 'ğŸ’¾ ì €ì¥';
                btn.classList.add('editing');
            } else {
                displayDiv.style.display = 'block';
                editor.style.display = 'none';
                preCode.textContent = editor.value;
                Prism.highlightElement(preCode);
                btn.textContent = 'âœï¸ í¸ì§‘';
                btn.classList.remove('editing');
            }
        }

        function analyzeCodePython() {
            updateChecklist('progressChecklistPython', 0, true);
            const feedback = document.getElementById('feedbackPython');
            
            feedback.innerHTML = `
                <div class="feedback-item feedback-error">
                    <strong>ğŸš¨ ë³´ì•ˆ ì·¨ì•½ì  ë°œê²¬</strong>
                    <p>f-stringì´ë‚˜ % í¬ë§·íŒ…ì„ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ë¥¼ ë§Œë“¤ë©´ ì•ˆ ë©ë‹ˆë‹¤. ì´ëŠ” ë°ì´í„°ë¥¼ ì¿¼ë¦¬ì˜ ì¼ë¶€ë¡œ í•´ì„í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.</p>
                </div>
            `;
            
            document.getElementById('validateBtnPython').disabled = false;
            document.getElementById('codeStatusPython').textContent = 'ìˆ˜ì • ì¤‘';
            document.getElementById('codeStatusPython').className = 'status-badge status-editing';
        }

        function validateCodePython() {
            const code = document.getElementById('codeEditorPython').value;
            const feedback = document.getElementById('feedbackPython');
            const rightPanel = document.getElementById('rightPanelPython');
            
            let passed = true;
            let messages = [];

            // 1. ë¬¸ìì—´ í¬ë§·íŒ… ì œê±° í™•ì¸
            if (!code.includes('f"') && !code.includes('% user_id') && !code.includes(".format(")) {
                updateChecklist('progressChecklistPython', 1, true);
                messages.push("âœ… ë¬¸ìì—´ í¬ë§·íŒ…/ì—°ê²°ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                passed = false;
                updateChecklist('progressChecklistPython', 1, false);
                messages.push("âŒ f-string, format(), % ì—°ì‚°ì ë“±ì„ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.");
            }

            // 2. ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë¶„ë¦¬ (?)
            if (code.includes('WHERE id = ?') || code.includes('WHERE id = %s')) {
                updateChecklist('progressChecklistPython', 2, true);
                messages.push("âœ… ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°(?, %s)ê°€ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                passed = false;
                updateChecklist('progressChecklistPython', 2, false);
                messages.push("âŒ WHERE id = ? (SQLite) ë˜ëŠ” %s (MySQL/PG) í˜•íƒœì—¬ì•¼ í•©ë‹ˆë‹¤.");
            }

            // 3. íŠœí”Œ ì „ë‹¬
            if (code.includes('execute(query, (user_id,))') || code.includes('execute(query, [user_id])')) {
                updateChecklist('progressChecklistPython', 3, true);
                messages.push("âœ… ë°ì´í„°ê°€ íŠœí”Œ/ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                passed = false;
                updateChecklist('progressChecklistPython', 3, false);
                messages.push("âŒ execute ë©”ì„œë“œì˜ ë‘ ë²ˆì§¸ ì¸ìë¡œ (user_id,) í˜•íƒœì˜ íŠœí”Œì„ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.");
            }

            if (passed) {
                feedback.innerHTML = `
                    <div class="feedback-item feedback-success">
                        <strong>ğŸ‰ ê²€ì¦ ì„±ê³µ!</strong>
                        <p>ì™„ë²½í•©ë‹ˆë‹¤! DB APIì˜ Parameterized Query ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.</p>
                        <br>
                        ${messages.join('<br>')}
                    </div>
                `;
                document.getElementById('codeStatusPython').textContent = 'ì•ˆì „í•œ ì½”ë“œ';
                document.getElementById('codeStatusPython').className = 'status-badge status-secure';

                rightPanel.innerHTML = `
                    <div class="info-section">
                        <div class="info-title">âœ… ì•ˆì „í•œ ìƒíƒœ</div>
                        <div class="info-content">
                            <p style="color: #28a745"><strong>Secure Coding ì ìš© ì™„ë£Œ</strong></p>
                            <p>DB ë“œë¼ì´ë²„ê°€ ì…ë ¥ê°’ì„ ìë™ìœ¼ë¡œ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬í•˜ê±°ë‚˜ ì¿¼ë¦¬ì™€ ë°ì´í„°ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì „ì†¡í•˜ë¯€ë¡œ ì•ˆì „í•©ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                `;
            } else {
                feedback.innerHTML = `
                    <div class="feedback-item feedback-warning">
                        <strong>âš ï¸ ë³´ì™„ í•„ìš”</strong>
                        <br>
                        ${messages.join('<br>')}
                    </div>
                `;
            }
        }

        function resetCodingPython() {
            const initialPython = `import sqlite3

def get_user_info(user_id):
    conn = sqlite3.connect('example.db')
    cursor = conn.cursor()
    
    # [ì·¨ì•½ì ] Pythonì˜ f-stringì´ë‚˜ % ì—°ì‚°ìë¡œ ì¿¼ë¦¬ ì¡°ì‘
    # ì…ë ¥ê°’ì´ ê·¸ëŒ€ë¡œ ì¿¼ë¦¬ì˜ ì¼ë¶€ê°€ ë˜ì–´ ì‹¤í–‰ë¨
    query = f"SELECT * FROM users WHERE id = '{user_id}'"
    
    try:
        # ì¿¼ë¦¬ ë¬¸ìì—´ í•˜ë‚˜ë§Œ ì „ë‹¬í•˜ê³  ìˆìŒ
        cursor.execute(query)
        result = cursor.fetchone()
        return result
    finally:
        conn.close()`;

            document.getElementById('codeEditorPython').value = initialPython;
            document.getElementById('codeDisplayPython').textContent = initialPython;
            Prism.highlightElement(document.getElementById('codeDisplayPython'));
            document.getElementById('feedbackPython').innerHTML = '';
            document.getElementById('validateBtnPython').disabled = true;
            document.getElementById('codeStatusPython').className = 'status-badge status-vulnerable';
            document.getElementById('codeStatusPython').textContent = 'ì·¨ì•½í•œ ì½”ë“œ';

            for(let i=0; i<4; i++) updateChecklist('progressChecklistPython', i, false);
        }
    </script>
</body>
</html>