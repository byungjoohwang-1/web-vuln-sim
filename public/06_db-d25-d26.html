<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D-25/26 ê°ì‚¬ ë° íŒ¨ì¹˜ ê´€ë¦¬ - DB ë³´ì•ˆ ì‹œë®¬ë ˆì´í„°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', 'Malgun Gothic', sans-serif; background: #eef2f5; padding: 20px; }
        .container-fluid { max-width: 1600px; }
        
        /* Header */
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; border-bottom: 5px solid #00aaaa; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 1.5rem; font-weight: 800; margin: 0; }
        
        /* Layout */
        .content-row { display: flex; gap: 20px; height: calc(100vh - 140px); }
        .sidebar { width: 300px; background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); overflow-y: auto; }
        .main-panel { flex: 1; display: flex; flex-direction: column; gap: 20px; }
        .guide-panel { width: 420px; background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); overflow-y: auto; border-left: 4px solid #0d6efd; }

        /* Menu Items */
        .menu-item { padding: 12px 15px; margin-bottom: 8px; border-radius: 8px; cursor: pointer; transition: 0.2s; border: 1px solid transparent; font-weight: 600; color: #555; display: flex; align-items: center; }
        .menu-item:hover { background: #f8f9fa; border-color: #dee2e6; }
        .menu-item.active { background: #e3f2fd; color: #0d6efd; border-color: #0d6efd; }
        .menu-item i { width: 25px; text-align: center; margin-right: 10px; }
        .badge-risk { font-size: 0.7em; padding: 4px 8px; border-radius: 6px; margin-left: auto; background: #dc3545; color: white; }

        /* DB Tabs */
        .db-tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .db-tab { flex: 1; padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; background: #e9ecef; color: #6c757d; }
        .db-tab.active { background: #2c3e50; color: #fff; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .db-tab i { margin-right: 8px; }

        /* Terminal */
        .terminal-container { background: #1e1e1e; border-radius: 10px; flex: 1; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .terminal-header { background: #2d2d2d; padding: 8px 15px; color: #aaa; font-size: 0.85em; border-bottom: 1px solid #333; display: flex; justify-content: space-between; }
        .terminal-body { flex: 1; padding: 15px; overflow-y: auto; font-family: 'Consolas', monospace; font-size: 0.95rem; line-height: 1.5; color: #f1f1f1; }
        
        .term-line { margin-bottom: 5px; word-break: break-all; }
        .prompt-oracle { color: #00ff00; font-weight: bold; }
        .prompt-mysql { color: #ffa500; font-weight: bold; }
        .vuln { color: #ff5555; font-weight: bold; }
        .secure { color: #50fa7b; font-weight: bold; }
        .cmd { color: #f1fa8c; }
        .info { color: #8be9fd; }
        .comment { color: #6272a4; font-style: italic; }

        /* Guide Styles */
        .guide-title { font-size: 1.1rem; font-weight: 800; color: #2c3e50; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; }
        .guide-section { margin-bottom: 20px; }
        .guide-label { font-size: 0.85rem; font-weight: 700; color: #6c757d; text-transform: uppercase; margin-bottom: 8px; display: block; }
        .code-block { background: #f8f9fa; padding: 10px; border-radius: 6px; font-family: monospace; font-size: 0.85rem; border: 1px solid #e9ecef; color: #d63384; word-break: break-all; white-space: pre-wrap; }
        
        .btn-fix { width: 100%; padding: 12px; border: none; border-radius: 8px; background: linear-gradient(135deg, #198754 0%, #157347 100%); color: white; font-weight: bold; margin-top: auto; transition: 0.3s; }
        .btn-fix:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(25, 135, 84, 0.3); }
        .btn-fix:disabled { background: #6c757d; cursor: not-allowed; transform: none; box-shadow: none; }
        
        .reset-btn { background: #6c757d; border: none; color: white; padding: 5px 15px; border-radius: 6px; font-size: 0.85rem; cursor: pointer; }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="header">
        <div>
            <span class="badge bg-warning text-dark mb-1">KISA ì£¼ìš”ì •ë³´í†µì‹ ê¸°ë°˜ì‹œì„¤ ê°€ì´ë“œ (ìƒ)</span>
            <h1>ğŸ—„ï¸ ê°ì‚¬ ë° íŒ¨ì¹˜ ê´€ë¦¬ (D-25 ~ D-26)</h1>
        </div>
        <button class="reset-btn" onclick="resetAll()">ğŸ”„ ì „ì²´ ì´ˆê¸°í™”</button>
    </div>

    <div class="content-row">
        <!-- Sidebar Menu -->
        <div class="sidebar">
            <h6 class="text-muted fw-bold ps-2 mb-3">ì ê²€ í•­ëª©</h6>
            <div class="menu-item active" onclick="loadItem('d25', this)">
                <i class="fa-solid fa-eye"></i> D-25 ê°ì‚¬ ë¡œê·¸(Audit)
                <span class="badge-risk">ìƒ</span>
            </div>
            <div class="menu-item" onclick="loadItem('d26', this)">
                <i class="fa-solid fa-screwdriver-wrench"></i> D-26 ìµœì‹  ë³´ì•ˆ íŒ¨ì¹˜
                <span class="badge-risk">ìƒ</span>
            </div>
        </div>

        <!-- Main Terminal Panel -->
        <div class="main-panel">
            <div class="db-tabs">
                <button class="db-tab active" id="tab-oracle" onclick="setDB(event, 'oracle')"><i class="fa-solid fa-database"></i> Oracle Database</button>
                <button class="db-tab" id="tab-mysql" onclick="setDB(event, 'mysql')"><i class="fa-solid fa-server"></i> MySQL / MariaDB</button>
            </div>

            <div class="terminal-container">
                <div class="terminal-header">
                    <span id="term-title">Oracle SQL*Plus - Connected as SYSDBA</span>
                    <span id="term-status" class="text-warning">â— Ready</span>
                </div>
                <div class="terminal-body" id="terminal">
                    <!-- Dynamic Content -->
                </div>
            </div>
        </div>

        <!-- Right Guide Panel -->
        <div class="guide-panel">
            <div class="guide-title" id="guide-title">D-25 ê°ì‚¬ ë¡œê·¸ í™œì„±í™”</div>
            
            <div class="guide-section">
                <span class="guide-label">ğŸ” ì ê²€ ë‚´ìš©</span>
                <p class="small text-muted" id="guide-desc">
                    ë°ì´í„°ë² ì´ìŠ¤ì˜ ì£¼ìš” ì‘ì—… ì´ë ¥ì„ ê¸°ë¡í•˜ëŠ” ê°ì‚¬(Audit) ê¸°ëŠ¥ í™œì„±í™” ì—¬ë¶€ë¥¼ ì ê²€í•©ë‹ˆë‹¤.
                </p>
            </div>

            <div class="guide-section">
                <span class="guide-label">âš ï¸ ë³´ì•ˆ ìœ„í˜‘</span>
                <p class="small text-muted" id="guide-risk">
                    ì¹¨í•´ì‚¬ê³  ë°œìƒ ì‹œ ì›ì¸ ê·œëª… ë° ì±…ì„ ì¶”ì ì´ ë¶ˆê°€ëŠ¥í•˜ë©°, ë¹„ì •ìƒ í–‰ìœ„ë¥¼ íƒì§€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                </p>
            </div>

            <div class="guide-section">
                <span class="guide-label">ğŸ”§ ì¡°ì¹˜ ë°©ë²• (KISA)</span>
                <div id="guide-fix" class="code-block">
SQL> ALTER SYSTEM SET AUDIT_TRAIL=DB SCOPE=SPFILE;
SQL> SHUTDOWN IMMEDIATE;
SQL> STARTUP;
                </div>
            </div>

            <button id="btn-fix" class="btn-fix" onclick="runFix()">ğŸ›¡ï¸ ì¡°ì¹˜ ì‹¤í–‰ (Auto Fix)</button>
        </div>
    </div>
</div>

<script>
    // === Data Definition ===
    const data = {
        d25: {
            title: "D-25 ê°ì‚¬ ë¡œê·¸(Audit) í™œì„±í™”",
            desc: "ë°ì´í„°ë² ì´ìŠ¤ì˜ ì£¼ìš” ì‘ì—… ì´ë ¥ì„ ê¸°ë¡í•˜ëŠ” ê°ì‚¬(Audit) ê¸°ëŠ¥ í™œì„±í™” ì—¬ë¶€ë¥¼ ì ê²€í•©ë‹ˆë‹¤.",
            risk: "ê°ì‚¬ ë¡œê·¸ê°€ ë¹„í™œì„±í™”ëœ ê²½ìš°, ì¹¨í•´ì‚¬ê³  ë°œìƒ ì‹œ ì›ì¸ ê·œëª… ë° ì±…ì„ ì¶”ì ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.",
            oracle: {
                check: "SHOW PARAMETER audit_trail;",
                vuln: `NAME         TYPE        VALUE
-----------  ----------  -----
audit_trail  string      NONE  <-- [ì·¨ì•½]`,
                fixDesc: "init.ora ë˜ëŠ” SPFILEì—ì„œ AUDIT_TRAIL íŒŒë¼ë¯¸í„°ë¥¼ DB ë˜ëŠ” OSë¡œ ì„¤ì •",
                fixScript: [
                    "ALTER SYSTEM SET AUDIT_TRAIL=DB SCOPE=SPFILE;",
                    "-- Need Restart to apply",
                    "SHUTDOWN IMMEDIATE;",
                    "STARTUP;"
                ],
                secure: `NAME         TYPE        VALUE
-----------  ----------  -----
audit_trail  string      DB`
            },
            mysql: {
                check: "SHOW VARIABLES LIKE 'general_log%';",
                vuln: `Variable_name     Value
----------------  -----
general_log       OFF   <-- [ì·¨ì•½]
general_log_file  /var/lib/mysql/db.log`,
                fixDesc: "my.cnf íŒŒì¼ì— general_log = 1 ì„¤ì • ë˜ëŠ” ëª…ë ¹ì–´ë¡œ í™œì„±í™”",
                fixScript: [
                    "SET GLOBAL general_log = ON;"
                ],
                secure: `Variable_name     Value
----------------  -----
general_log       ON`
            }
        },
        d26: {
            title: "D-26 ìµœì‹  ë³´ì•ˆ íŒ¨ì¹˜ ì ìš©",
            desc: "ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ì‹œìŠ¤í…œì— ëŒ€í•œ ìµœì‹  ë³´ì•ˆ íŒ¨ì¹˜ ë° ë²¤ë” ê¶Œê³  íŒ¨ì¹˜ê°€ ì ìš©ë˜ì–´ ìˆëŠ”ì§€ ì ê²€í•©ë‹ˆë‹¤.",
            risk: "ìµœì‹  íŒ¨ì¹˜ê°€ ì ìš©ë˜ì§€ ì•Šì€ ê²½ìš°, ì•Œë ¤ì§„ ì·¨ì•½ì (CVE)ì„ ì´ìš©í•œ ê³µê²©ì— ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            oracle: {
                check: "opatch lsinventory",
                vuln: `Oracle Interim Patch Installer version 12.2.0.1.21
...
Lsinventory Output file location : /u01/app/oracle/cfgtoollogs/opatch/lsinv.txt
--------------------------------------------------------------------------------
No interim patches installed  <-- [ì·¨ì•½] íŒ¨ì¹˜ ë‚´ì—­ ì—†ìŒ`,
                fixDesc: "ì˜¤ë¼í´ ê¸°ìˆ ì§€ì› ì‚¬ì´íŠ¸(MOS)ë¥¼ í†µí•´ ìµœì‹  CPU(Critical Patch Update) ë˜ëŠ” PSU(Patch Set Update)ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì ìš©",
                fixScript: [
                    "-- [Simulated] Downloading Patch 35320081...",
                    "opatch apply",
                    "Patch 35320081 successfully applied."
                ],
                secure: `Patch  35320081     : applied on Mon Jan 19 10:00:00 KST 2026
Unique Patch ID:  24011935
Patch description:  "Database Release Update : 19.22.0.0.240116 (35320081)"`
            },
            mysql: {
                check: "SELECT VERSION();",
                vuln: `+-----------+
| VERSION() |
+-----------+
| 5.7.20    | <-- [ì·¨ì•½] EOL(End of Life) ë²„ì „ ë˜ëŠ” êµ¬ë²„ì „
+-----------+`,
                fixDesc: "MySQL ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ (yum update mysql-server ë“±)",
                fixScript: [
                    "-- [Simulated] yum update mysql-server",
                    "Stopping mysqld: [  OK  ]",
                    "Starting mysqld: [  OK  ]"
                ],
                secure: `+-----------+
| VERSION() |
+-----------+
| 8.0.36    |
+-----------+`
            }
        }
    };

    let currentItem = 'd25';
    let currentDB = 'oracle';
    let isFixed = { 
        d25_oracle: false, d25_mysql: false,
        d26_oracle: false, d26_mysql: false 
    };

    function init() {
        // Safe DOM Load
        setTimeout(() => {
            const firstItem = document.querySelector('.menu-item');
            if(firstItem) loadItem('d25', firstItem);
        }, 100);
    }

    function loadItem(id, el) {
        currentItem = id;
        document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
        if(el) el.classList.add('active');
        
        // Reset DB tab to currentDB but re-render UI
        setDB(null, currentDB);
    }

    function setDB(event, db) {
        currentDB = db;
        
        document.querySelectorAll('.db-tab').forEach(t => t.classList.remove('active'));
        const activeTab = document.getElementById('tab-' + db);
        if (activeTab) activeTab.classList.add('active');
        
        const titleEl = document.getElementById('term-title');
        // D-26 is OS level command for Oracle (opatch)
        if (currentItem === 'd26' && db === 'oracle') {
             if(titleEl) titleEl.innerText = 'oracle@db-server:~$ (OS Terminal)';
        } else {
             if(titleEl) titleEl.innerText = db === 'oracle' ? 'Oracle SQL*Plus' : 'MySQL Monitor';
        }

        updateUI();
        
        const term = document.getElementById('terminal');
        if(term) term.innerHTML = '';
        setTimeout(runCheck, 300);
    }

    function updateUI() {
        const d = data[currentItem];
        const dbData = d[currentDB];
        const stateKey = `${currentItem}_${currentDB}`;
        const fixed = isFixed[stateKey];
        
        document.getElementById('guide-title').innerText = d.title;
        document.getElementById('guide-desc').innerText = d.desc;
        document.getElementById('guide-risk').innerText = d.risk;
        document.getElementById('guide-fix').innerText = dbData.fixDesc;
        
        const btn = document.getElementById('btn-fix');
        btn.disabled = fixed;
        btn.innerText = fixed ? "âœ… ì¡°ì¹˜ ì™„ë£Œ (Secured)" : "ğŸ›¡ï¸ ì¡°ì¹˜ ì‹¤í–‰ (Auto Fix)";
    }

    function log(msg, type='output') {
        const term = document.getElementById('terminal');
        if(!term) return null;
        
        let prompt = currentDB === 'oracle' ? 'SQL>' : 'mysql>';
        // Exception for OS commands
        if (currentItem === 'd26' && currentDB === 'oracle') prompt = 'oracle@db:~$';
        
        const pClass = currentDB === 'oracle' ? 'prompt-oracle' : 'prompt-mysql';
        
        const div = document.createElement('div');
        div.className = 'term-line';
        
        if(type==='cmd') {
            div.innerHTML = `<span class="${pClass}">${prompt}</span> <span class="cmd">${msg}</span>`;
        } else if(type==='vuln') {
            div.className += ' vuln';
            div.style.whiteSpace = 'pre';
            div.innerText = msg;
        } else if(type==='secure') {
            div.className += ' secure';
            div.style.whiteSpace = 'pre';
            div.innerText = msg;
        } else {
            div.style.whiteSpace = 'pre';
            div.innerText = msg;
        }
        
        term.appendChild(div);
        term.scrollTop = term.scrollHeight;
        return div;
    }

    function runCheck() {
        const dbData = data[currentItem][currentDB];
        const fixed = isFixed[`${currentItem}_${currentDB}`];
        
        log(dbData.check, 'cmd');
        
        setTimeout(() => {
            if(fixed) {
                log(dbData.secure, 'secure');
                log("[System] Status: Secure", 'secure');
            } else {
                log(dbData.vuln, 'vuln');
                log("[System] Status: Vulnerable", 'vuln');
            }
            
            // Add prompt
            const line = log("", 'cmd');
            if(line) line.querySelector('.cmd').innerText = '_';
        }, 500);
    }

    function runFix() {
        const dbData = data[currentItem][currentDB];
        const term = document.getElementById('terminal');
        // Remove cursor
        if(term.lastElementChild) {
            const cmdSpan = term.lastElementChild.querySelector('.cmd');
            if(cmdSpan && cmdSpan.innerText === '_') cmdSpan.innerText = '';
        }

        let delay = 0;
        dbData.fixScript.forEach(cmd => {
            setTimeout(() => {
                log(cmd, 'cmd');
                if(cmd.includes('SHUTDOWN') || cmd.includes('STARTUP') || cmd.includes('Stopping')) {
                    setTimeout(() => log("Instance state changed.", 'info'), 300);
                }
            }, delay);
            delay += 800;
        });

        setTimeout(() => {
            log(`[System] Vulnerability Patched.`, 'secure');
            isFixed[`${currentItem}_${currentDB}`] = true;
            updateUI();
            setTimeout(runCheck, 1000);
        }, delay + 500);
    }

    function resetAll() {
        isFixed = { d25_oracle:false, d25_mysql:false, d26_oracle:false, d26_mysql:false };
        const term = document.getElementById('terminal');
        if(term) term.innerHTML = '<div class="term-line info">System reset complete.</div>';
        updateUI();
        setTimeout(runCheck, 500);
    }

    init();
</script>
</body>
</html>