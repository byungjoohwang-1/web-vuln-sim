<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DB ë³´ì•ˆ ì‹¤ìŠµ ì‹œë®¬ë ˆì´í„° (Oracle)</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'JetBrains Mono', monospace; background: #0c0c0c; color: #00ffff; height: 100vh; display: flex; flex-direction: column; }
    
    .top-bar { background: #102027; padding: 10px 20px; border-bottom: 2px solid #00aaaa; display: flex; justify-content: space-between; align-items: center; }
    .top-bar h1 { font-size: 1.2em; color: #00ffff; font-weight: bold; }
    
    .status-group { display: flex; align-items: center; gap: 15px; }
    
    .status-badge { padding: 6px 12px; border-radius: 4px; font-size: 0.85em; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
    .status-vulnerable { background: #ff0055; color: #fff; box-shadow: 0 0 10px rgba(255, 0, 85, 0.4); animation: pulse 2s infinite; }
    .status-secure { background: #00aaaa; color: #fff; box-shadow: 0 0 10px rgba(0, 170, 170, 0.4); }
    
    .reset-btn { background: transparent; border: 1px solid #ffbd2e; color: #ffbd2e; padding: 5px 15px; border-radius: 4px; cursor: pointer; font-family: 'JetBrains Mono'; font-weight: bold; transition: 0.3s; display: flex; align-items: center; gap: 5px; }
    .reset-btn:hover { background: #ffbd2e; color: #000; box-shadow: 0 0 10px rgba(255, 189, 46, 0.5); }

    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    
    .main-container { display: flex; flex: 1; overflow: hidden; }
    
    /* Checklist Panel */
    .checklist-panel { width: 360px; background: #101518; border-right: 1px solid #333; overflow-y: auto; padding: 0; }
    .checklist-header { padding: 20px; border-bottom: 1px solid #333; background: #151a1e; position: sticky; top: 0; z-index: 10; }
    .checklist-header h2 { color: #00ffff; font-size: 1.1em; margin: 0; }
    
    .checklist-item { padding: 18px 20px; border-bottom: 1px solid #222; border-left: 4px solid #444; cursor: pointer; transition: all 0.2s; position: relative; }
    .checklist-item:hover { background: #1a2024; }
    .checklist-item.active { background: #1f262b; border-left-color: #00ffff; }
    .checklist-item.vulnerable { border-left-color: #ff0055; }
    .checklist-item.secure { border-left-color: #00aaaa; }
    
    .item-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
    .item-id { font-weight: bold; color: #fff; background: #333; padding: 2px 6px; border-radius: 3px; font-size: 0.8em; }
    .item-status { font-size: 0.75em; font-weight: bold; }
    .item-status.vulnerable { color: #ff0055; }
    .item-status.secure { color: #50fa7b; }
    .item-title { font-size: 0.9em; color: #ccc; line-height: 1.4; }
    
    /* Terminal Panel */
    .terminal-panel { flex: 1; display: flex; flex-direction: column; background: #0c0c0c; position: relative; }
    .terminal-header { background: #151a1e; padding: 12px 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; font-size: 0.9em; color: #888; }
    .terminal-output { flex: 1; padding: 20px; overflow-y: auto; font-size: 0.95em; line-height: 1.6; font-family: 'JetBrains Mono', monospace; }
    .terminal-line { margin-bottom: 4px; word-break: break-all; }
    
    .prompt { color: #00ffff; font-weight: bold; }
    .command { color: #fff; font-weight: bold; }
    .keyword { color: #ff79c6; }
    .string { color: #f1fa8c; }
    .error { color: #ff5555; }
    .success { color: #50fa7b; }
    .info { color: #8be9fd; }
    .comment { color: #6272a4; font-style: italic; }
    
    .terminal-input-container { background: #151a1e; padding: 15px 20px; border-top: 1px solid #333; display: flex; align-items: center; }
    .terminal-prompt { color: #00ffff; margin-right: 12px; font-weight: bold; }
    #terminal-input { flex: 1; background: transparent; border: none; color: #fff; font-family: 'JetBrains Mono', monospace; font-size: 1.1em; outline: none; }
    
    /* Guide Panel */
    .guide-panel { width: 440px; background: #101518; border-left: 1px solid #333; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 25px; }
    .guide-card { background: #1a2024; border-radius: 8px; padding: 20px; border: 1px solid #333; }
    .guide-card h3 { color: #00ffff; margin-bottom: 15px; font-size: 1em; display: flex; align-items: center; gap: 8px; border-bottom: 1px solid #333; padding-bottom: 10px; }
    .guide-desc { color: #ccc; font-size: 0.9em; line-height: 1.6; margin-bottom: 15px; }
    
    .cmd-box { background: #000; padding: 12px; border-radius: 5px; border-left: 3px solid #50fa7b; font-size: 0.85em; margin-bottom: 15px; }
    .cmd-box.fix { border-left-color: #ffbd2e; }
    .cmd-label { color: #888; font-size: 0.8em; margin-bottom: 5px; display: block; }
    .cmd-text { color: #fff; font-family: 'JetBrains Mono', monospace; }
    
    .fix-btn { background: linear-gradient(135deg, #00aaaa, #008888); color: white; border: none; padding: 12px; border-radius: 6px; width: 100%; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: auto; }
    .fix-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 170, 170, 0.3); }
    .fix-btn:disabled { background: #333; color: #666; cursor: not-allowed; transform: none; box-shadow: none; }

    /* SQL Table Style */
    .sql-table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 0.9em; border: 1px solid #444; }
    .sql-table th { text-align: left; padding: 8px; background: #222; color: #00ffff; border-bottom: 1px solid #444; }
    .sql-table td { padding: 8px; border-bottom: 1px solid #333; color: #ddd; }
    .sql-table tr:last-child td { border-bottom: none; }
    .val-bad { color: #ff5555; font-weight: bold; }
    .val-good { color: #50fa7b; font-weight: bold; }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1>ğŸ—„ï¸ Database Security Simulator (Oracle 19c)</h1>
    <div class="status-group">
        <button class="reset-btn" onclick="resetSimulation()">
            <span>ğŸ”„</span> ì´ˆê¸°í™”
        </button>
        <span class="status-badge" id="overall-status">Initializing...</span>
    </div>
  </div>
  
  <div class="main-container">
    <!-- Checklist -->
    <div class="checklist-panel">
      <div class="checklist-header">
        <h2>ë³´ì•ˆ ì ê²€ í•­ëª© (D-Code)</h2>
      </div>
      <div id="checklist"></div>
    </div>
    
    <!-- Terminal -->
    <div class="terminal-panel">
      <div class="terminal-header">
        <span>Session: SYS AS SYSDBA</span>
        <span style="color: #50fa7b;">â— Connected</span>
      </div>
      <div class="terminal-output" id="terminal-output">
        <div class="terminal-line"><span class="success">SQL*Plus: Release 19.0.0.0.0 - Production</span></div>
        <div class="terminal-line"><span class="output">Copyright (c) 1982, 2025, Oracle. All rights reserved.</span></div>
        <div class="terminal-line"><br></div>
        <div class="terminal-line"><span class="output">Connected to:</span></div>
        <div class="terminal-line"><span class="output">Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production</span></div>
        <div class="terminal-line"><br></div>
        <div class="terminal-line"><span class="comment">-- Select a vulnerability item from the left to start.</span></div>
      </div>
      <div class="terminal-input-container">
        <span class="terminal-prompt">SQL&gt;</span>
        <input type="text" id="terminal-input" autofocus autocomplete="off" spellcheck="false" />
      </div>
    </div>
    
    <!-- Guide -->
    <div class="guide-panel" id="guide-panel">
      <div class="guide-card">
        <h3>ğŸ’¡ Security Officer Mode</h3>
        <p class="guide-desc">
          ê¸ˆìœµê¶Œ ë° ì£¼ìš”ì •ë³´í†µì‹ ê¸°ë°˜ì‹œì„¤ ê¸°ìˆ ì  ì·¨ì•½ì  í‰ê°€ê¸°ì¤€(2026)ì— ë”°ë¥¸ Oracle DB ë³´ì•ˆ ì ê²€ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
        </p>
        <p class="guide-desc" style="color: #8be9fd;">
          ì¢Œì¸¡ ë©”ë‰´ì—ì„œ ì ê²€í•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.
        </p>
      </div>
    </div>
  </div>

  <script>
    // 1. Initial State Factory (ì´ˆê¸° ì·¨ì•½ ìƒíƒœ ìƒì„±)
    const getInitialDB = () => ({
        dba_users: [
            { USERNAME: 'SYS', ACCOUNT_STATUS: 'OPEN', DEFAULT_TABLESPACE: 'SYSTEM' },
            { USERNAME: 'SYSTEM', ACCOUNT_STATUS: 'OPEN', DEFAULT_TABLESPACE: 'SYSTEM' },
            { USERNAME: 'SCOTT', ACCOUNT_STATUS: 'OPEN', DEFAULT_TABLESPACE: 'SYSTEM' }, // D-01, D-10
            { USERNAME: 'DBSNMP', ACCOUNT_STATUS: 'OPEN', DEFAULT_TABLESPACE: 'SYSAUX' }
        ],
        dba_profiles: [
            { PROFILE: 'DEFAULT', RESOURCE_NAME: 'FAILED_LOGIN_ATTEMPTS', LIMIT: 'UNLIMITED' }, // D-02
            { PROFILE: 'DEFAULT', RESOURCE_NAME: 'PASSWORD_LIFE_TIME', LIMIT: 'UNLIMITED' },    // D-03
            { PROFILE: 'DEFAULT', RESOURCE_NAME: 'PASSWORD_VERIFY_FUNCTION', LIMIT: 'NULL' },     // D-04
            { PROFILE: 'DEFAULT', RESOURCE_NAME: 'PASSWORD_REUSE_MAX', LIMIT: 'UNLIMITED' },      // D-05
            { PROFILE: 'DEFAULT', RESOURCE_NAME: 'IDLE_TIME', LIMIT: 'UNLIMITED' }                // D-08
        ],
        dba_role_privs: [
            { GRANTEE: 'SYS', GRANTED_ROLE: 'DBA' },
            { GRANTEE: 'SYSTEM', GRANTED_ROLE: 'DBA' },
            { GRANTEE: 'SCOTT', GRANTED_ROLE: 'DBA' }, // D-11
            { GRANTEE: 'SCOTT', GRANTED_ROLE: 'CONNECT' },
            { GRANTEE: 'SCOTT', GRANTED_ROLE: 'RESOURCE' }
        ],
        dba_tab_privs: [
            { GRANTEE: 'PUBLIC', TABLE_NAME: 'UTL_FILE', PRIVILEGE: 'EXECUTE' },  // D-23
            { GRANTEE: 'PUBLIC', TABLE_NAME: 'UTL_TCP', PRIVILEGE: 'EXECUTE' },   // D-24
            { GRANTEE: 'PUBLIC', TABLE_NAME: 'UTL_HTTP', PRIVILEGE: 'EXECUTE' },  // D-24
            { GRANTEE: 'PUBLIC', TABLE_NAME: 'DBMS_RANDOM', PRIVILEGE: 'EXECUTE' }
        ],
        v_parameter: [
            { NAME: 'resource_limit', VALUE: 'FALSE' }, // D-08
            { NAME: 'audit_trail', VALUE: 'NONE' },     // D-25
            { NAME: 'remote_os_authent', VALUE: 'TRUE' },
            { NAME: 'utl_file_dir', VALUE: '*' }        // D-23 (Old style but educational)
        ],
        // OS Files Simulation
        listener_ora: { use_password: false }, // D-19
        sqlnet_ora: { validnode_checking: 'no', invited_nodes: [] } // D-26
    });

    // Global State
    let virtualDB = getInitialDB();

    // 2. Check Items (D-Code Mappings)
    const checkItems = [
        {
            id: 'D-01',
            title: 'ê¸°ë³¸ ê³„ì • ë° ë¶ˆí•„ìš”í•œ ê³„ì • ì œê±°',
            desc: 'SCOTT, TIGER ë“± ê¸°ë³¸ ê³„ì •ì˜ í™œì„±í™” ì—¬ë¶€ë¥¼ ì ê²€í•©ë‹ˆë‹¤.',
            checkQuery: "SELECT USERNAME, ACCOUNT_STATUS FROM DBA_USERS WHERE USERNAME = 'SCOTT';",
            fixQuery: "ALTER USER SCOTT ACCOUNT LOCK;",
            check: () => {
                const u = virtualDB.dba_users.find(x => x.USERNAME === 'SCOTT');
                return u && u.ACCOUNT_STATUS.includes('LOCKED');
            },
            risk: 'ê¸°ë³¸ ê³„ì •ì€ ë„ë¦¬ ì•Œë ¤ì ¸ ìˆì–´ ê³µê²©ì˜ ì‹œë°œì ì´ ë©ë‹ˆë‹¤.'
        },
        {
            id: 'D-02',
            title: 'ë¡œê·¸ì¸ ì‹¤íŒ¨ íšŸìˆ˜ ì œí•œ',
            desc: 'ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²© ë°©ì§€ë¥¼ ìœ„í•´ ë¡œê·¸ì¸ ì‹¤íŒ¨ í—ˆìš© íšŸìˆ˜ë¥¼ 5íšŒ ì´í•˜ë¡œ ì œí•œí•©ë‹ˆë‹¤.',
            checkQuery: "SELECT LIMIT FROM DBA_PROFILES WHERE RESOURCE_NAME = 'FAILED_LOGIN_ATTEMPTS';",
            fixQuery: "ALTER PROFILE DEFAULT LIMIT FAILED_LOGIN_ATTEMPTS 5;",
            check: () => {
                const p = virtualDB.dba_profiles.find(x => x.RESOURCE_NAME === 'FAILED_LOGIN_ATTEMPTS');
                return parseInt(p.LIMIT) <= 5;
            },
            risk: 'ì œí•œì´ ì—†ìœ¼ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ì„ ë•Œê¹Œì§€ ë¬´í•œì • ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        },
        {
            id: 'D-03',
            title: 'íŒ¨ìŠ¤ì›Œë“œ ë§Œë£Œ ê¸°ê°„ ì„¤ì •',
            desc: 'ë¹„ë°€ë²ˆí˜¸ì˜ ì˜êµ¬ ì‚¬ìš©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ìµœëŒ€ ì‚¬ìš© ê¸°ê°„ì„ 90ì¼ ì´í•˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.',
            checkQuery: "SELECT LIMIT FROM DBA_PROFILES WHERE RESOURCE_NAME = 'PASSWORD_LIFE_TIME';",
            fixQuery: "ALTER PROFILE DEFAULT LIMIT PASSWORD_LIFE_TIME 90;",
            check: () => {
                const p = virtualDB.dba_profiles.find(x => x.RESOURCE_NAME === 'PASSWORD_LIFE_TIME');
                return parseInt(p.LIMIT) <= 90;
            },
            risk: 'ìœ ì¶œëœ ë¹„ë°€ë²ˆí˜¸ê°€ ì¥ê¸°ê°„ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        },
        {
            id: 'D-04',
            title: 'íŒ¨ìŠ¤ì›Œë“œ ë³µì¡ì„± ì„¤ì •',
            desc: 'ë¹„ë°€ë²ˆí˜¸ ìƒì„± ì‹œ ë³µì¡ë„ ê²€ì¦ í•¨ìˆ˜ë¥¼ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.',
            checkQuery: "SELECT LIMIT FROM DBA_PROFILES WHERE RESOURCE_NAME = 'PASSWORD_VERIFY_FUNCTION';",
            fixQuery: "ALTER PROFILE DEFAULT LIMIT PASSWORD_VERIFY_FUNCTION VERIFY_FUNCTION_11G;",
            check: () => {
                const p = virtualDB.dba_profiles.find(x => x.RESOURCE_NAME === 'PASSWORD_VERIFY_FUNCTION');
                return p.LIMIT !== 'NULL';
            },
            risk: 'ë‹¨ìˆœí•œ ë¹„ë°€ë²ˆí˜¸ ì‚¬ìš©ìœ¼ë¡œ ê³„ì • íƒˆì·¨ ìœ„í—˜ì´ ì¦ê°€í•©ë‹ˆë‹¤.'
        },
        {
            id: 'D-05',
            title: 'íŒ¨ìŠ¤ì›Œë“œ ì¬ì‚¬ìš© ë°©ì§€',
            desc: 'ì´ì „ ë¹„ë°€ë²ˆí˜¸ ì¬ì‚¬ìš©ì„ 3íšŒ ì´ìƒ ì œí•œí•©ë‹ˆë‹¤.',
            checkQuery: "SELECT LIMIT FROM DBA_PROFILES WHERE RESOURCE_NAME = 'PASSWORD_REUSE_MAX';",
            fixQuery: "ALTER PROFILE DEFAULT LIMIT PASSWORD_REUSE_MAX 3;",
            check: () => {
                const p = virtualDB.dba_profiles.find(x => x.RESOURCE_NAME === 'PASSWORD_REUSE_MAX');
                return parseInt(p.LIMIT) >= 3;
            },
            risk: 'ì¬ì‚¬ìš© í—ˆìš© ì‹œ ì£¼ê¸°ì  ë³€ê²½ì˜ íš¨ê³¼ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.'
        },
        {
            id: 'D-08',
            title: 'ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì„¤ì •',
            desc: 'ìœ íœ´ ì„¸ì…˜ì„ 60ë¶„ ì´ë‚´ì— ìë™ ë¡œê·¸ì•„ì›ƒ ì‹œí‚¤ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.',
            checkQuery: "SELECT LIMIT FROM DBA_PROFILES WHERE RESOURCE_NAME = 'IDLE_TIME';",
            fixQuery: "ALTER PROFILE DEFAULT LIMIT IDLE_TIME 60;\nALTER SYSTEM SET RESOURCE_LIMIT = TRUE;",
            check: () => {
                const p = virtualDB.dba_profiles.find(x => x.RESOURCE_NAME === 'IDLE_TIME');
                const param = virtualDB.v_parameter.find(x => x.NAME === 'resource_limit');
                return parseInt(p.LIMIT) <= 60 && param.VALUE === 'TRUE';
            },
            risk: 'ê´€ë¦¬ì ë¶€ì¬ ì‹œ ì—´ë¦° ì„¸ì…˜ì„ í†µí•œ ë¹„ì¸ê°€ ì¡°ì‘ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.'
        },
        {
            id: 'D-10',
            title: 'ì‚¬ìš©ìë³„ Default Tablespace',
            desc: 'ì¼ë°˜ ì‚¬ìš©ìì˜ ê¸°ë³¸ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ë¥¼ SYSTEMìœ¼ë¡œ ì„¤ì •í•˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.',
            checkQuery: "SELECT USERNAME, DEFAULT_TABLESPACE FROM DBA_USERS WHERE USERNAME = 'SCOTT';",
            fixQuery: "ALTER USER SCOTT DEFAULT TABLESPACE USERS;",
            check: () => {
                const u = virtualDB.dba_users.find(x => x.USERNAME === 'SCOTT');
                return u.DEFAULT_TABLESPACE !== 'SYSTEM';
            },
            risk: 'SYSTEM í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ì— ë°ì´í„° ì €ì¥ ì‹œ DB ì„±ëŠ¥ ì €í•˜ ë° ê´€ë¦¬ ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.'
        },
        {
            id: 'D-11',
            title: 'ë¶ˆí•„ìš”í•œ ê¶Œí•œ ë¶€ì—¬ ê¸ˆì§€',
            desc: 'ì¼ë°˜ ì‚¬ìš©ìì—ê²Œ DBA ë“± ê³¼ë„í•œ ê¶Œí•œì´ ë¶€ì—¬ë˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.',
            checkQuery: "SELECT * FROM DBA_ROLE_PRIVS WHERE GRANTED_ROLE='DBA' AND GRANTEE='SCOTT';",
            fixQuery: "REVOKE DBA FROM SCOTT;",
            check: () => {
                return !virtualDB.dba_role_privs.some(p => p.GRANTEE === 'SCOTT' && p.GRANTED_ROLE === 'DBA');
            },
            risk: 'ê³¼ë„í•œ ê¶Œí•œ ë¶€ì—¬ëŠ” ë‚´ë¶€ ë³´ì•ˆ ìœ„í˜‘ì„ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.'
        },
        {
            id: 'D-19',
            title: 'ë¦¬ìŠ¤ë„ˆ íŒ¨ìŠ¤ì›Œë“œ ì„¤ì •',
            desc: 'Oracle Listenerì— íŒ¨ìŠ¤ì›Œë“œë¥¼ ì„¤ì •í•˜ì—¬ ì›ê²© ì œì–´ë¥¼ ì°¨ë‹¨í•´ì•¼ í•©ë‹ˆë‹¤.',
            checkQuery: "HOST lsnrctl status",
            fixQuery: "HOST lsnrctl change_password",
            check: () => virtualDB.listener_ora.use_password === true,
            risk: 'ì›ê²©ì—ì„œ ë¦¬ìŠ¤ë„ˆë¥¼ ì¤‘ì§€ì‹œí‚¤ê±°ë‚˜ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        },
        {
            id: 'D-23',
            title: 'ì£¼ìš” íŒŒì¼ ì ‘ê·¼ í†µì œ (UTL_FILE)',
            desc: 'UTL_FILE íŒ¨í‚¤ì§€ì— ëŒ€í•œ ì‹¤í–‰ ê¶Œí•œì„ PUBLICì—ì„œ íšŒìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤.',
            checkQuery: "SELECT * FROM DBA_TAB_PRIVS WHERE TABLE_NAME='UTL_FILE' AND GRANTEE='PUBLIC';",
            fixQuery: "REVOKE EXECUTE ON UTL_FILE FROM PUBLIC;",
            check: () => {
                return !virtualDB.dba_tab_privs.some(p => p.TABLE_NAME === 'UTL_FILE' && p.GRANTEE === 'PUBLIC');
            },
            risk: 'OS íŒŒì¼ ì‹œìŠ¤í…œì— ì„ì˜ë¡œ ì ‘ê·¼í•˜ê±°ë‚˜ íŒŒì¼ì„ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        },
        {
            id: 'D-24',
            title: 'ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ íŒ¨í‚¤ì§€ ê¶Œí•œ',
            desc: 'UTL_TCP, UTL_HTTP ë“± ë„¤íŠ¸ì›Œí¬ í†µì‹  íŒ¨í‚¤ì§€ì˜ PUBLIC ì‹¤í–‰ ê¶Œí•œì„ íšŒìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤.',
            checkQuery: "SELECT * FROM DBA_TAB_PRIVS WHERE TABLE_NAME IN ('UTL_TCP','UTL_HTTP') AND GRANTEE='PUBLIC';",
            fixQuery: "REVOKE EXECUTE ON UTL_TCP FROM PUBLIC;\nREVOKE EXECUTE ON UTL_HTTP FROM PUBLIC;",
            check: () => {
                return !virtualDB.dba_tab_privs.some(p => ['UTL_TCP', 'UTL_HTTP'].includes(p.TABLE_NAME) && p.GRANTEE === 'PUBLIC');
            },
            risk: 'DBë¥¼ ê²½ìœ í•˜ì—¬ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ ê³µê²©ì„ ìˆ˜í–‰í•˜ê±°ë‚˜ ë‚´ë¶€ë§ì„ ìŠ¤ìº”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
        },
        {
            id: 'D-25',
            title: 'ê°ì‚¬ ë¡œê·¸(Audit Trail) í™œì„±í™”',
            desc: 'DB ê°ì‚¬ ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ì—¬ ì£¼ìš” ì‘ì—… ì´ë ¥ì„ ê¸°ë¡í•´ì•¼ í•©ë‹ˆë‹¤.',
            checkQuery: "SHOW PARAMETER AUDIT_TRAIL",
            fixQuery: "ALTER SYSTEM SET AUDIT_TRAIL=DB SCOPE=SPFILE;",
            check: () => {
                const p = virtualDB.v_parameter.find(x => x.NAME === 'audit_trail');
                return p.VALUE !== 'NONE';
            },
            risk: 'ì¹¨í•´ì‚¬ê³  ë°œìƒ ì‹œ ì›ì¸ ê·œëª… ë° ì¶”ì ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.'
        },
        {
            id: 'D-26',
            title: 'IP ì ‘ê·¼ í†µì œ (validnode_checking)',
            desc: 'sqlnet.ora íŒŒì¼ì— ì ‘ì† í—ˆìš© IPë¥¼ ëª…ì‹œí•˜ì—¬ ì ‘ê·¼ì„ í†µì œí•´ì•¼ í•©ë‹ˆë‹¤.',
            checkQuery: "HOST cat $ORACLE_HOME/network/admin/sqlnet.ora",
            fixQuery: "HOST echo 'tcp.validnode_checking = yes' >> sqlnet.ora",
            check: () => virtualDB.sqlnet_ora.validnode_checking === 'yes',
            risk: 'ì¸ê°€ë˜ì§€ ì•Šì€ IPì—ì„œì˜ ë¬´ë‹¨ ì ‘ì† ì‹œë„ë¥¼ ì°¨ë‹¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
        }
    ];

    let currentItem = null;

    function init() {
        renderChecklist();
        updateStatus();
    }

    function resetSimulation() {
        virtualDB = getInitialDB();
        currentItem = null;
        document.getElementById('terminal-output').innerHTML = `
            <div class="terminal-line"><span class="success">System Reset Complete.</span></div>
            <div class="terminal-line"><span class="output">All settings restored to vulnerable state.</span></div>
            <div class="terminal-line"><br></div>
        `;
        renderChecklist();
        renderGuide();
        updateStatus();
    }

    function renderChecklist() {
        const list = document.getElementById('checklist');
        list.innerHTML = checkItems.map(item => {
            const isSecure = item.check();
            const statusClass = isSecure ? 'secure' : 'vulnerable';
            const statusText = isSecure ? 'SECURE' : 'VULNERABLE';
            return `
                <div class="checklist-item ${statusClass} ${currentItem?.id === item.id ? 'active' : ''}" onclick="selectItem('${item.id}')">
                    <div class="item-top">
                        <span class="item-id">${item.id}</span>
                        <span class="item-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="item-title">${item.title}</div>
                </div>
            `;
        }).join('');
    }

    function selectItem(id) {
        currentItem = checkItems.find(i => i.id === id);
        renderChecklist();
        renderGuide();
        printTerminal(`\nSQL> -- Selected: ${currentItem.id} (${currentItem.title})`, 'comment');
    }

    function renderGuide() {
        const panel = document.getElementById('guide-panel');
        if (!currentItem) {
            panel.innerHTML = `<div class="guide-card"><h3>ğŸ’¡ Security Officer Mode</h3><p class="guide-desc">ì¢Œì¸¡ ë©”ë‰´ì—ì„œ ì ê²€í•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.</p></div>`;
            return;
        }
        const isSecure = currentItem.check();
        panel.innerHTML = `
            <div class="guide-card">
                <h3>ğŸ” ${currentItem.id} ì ê²€</h3>
                <p class="guide-desc">${currentItem.desc}</p>
                <div class="cmd-box"><span class="cmd-label">Check Query:</span><span class="cmd-text">${currentItem.checkQuery}</span></div>
            </div>
            <div class="guide-card">
                <h3>âš ï¸ ìœ„í˜‘ (Risk)</h3>
                <p class="guide-desc" style="color:#ff79c6">${currentItem.risk}</p>
            </div>
            <div class="guide-card">
                <h3>ğŸ”§ ì¡°ì¹˜ (Fix)</h3>
                <div class="cmd-box fix"><span class="cmd-label">Fix Query:</span><span class="cmd-text" style="white-space:pre-wrap;">${currentItem.fixQuery}</span></div>
                <button class="fix-btn" onclick="runAutoFix()" ${isSecure ? 'disabled' : ''}>
                    ${isSecure ? 'âœ“ ì¡°ì¹˜ ì™„ë£Œ' : 'âš¡ ìë™ ì¡°ì¹˜ (Auto Fix)'}
                </button>
            </div>
        `;
    }

    function printTerminal(text, type = 'output') {
        const output = document.getElementById('terminal-output');
        const line = document.createElement('div');
        line.className = 'terminal-line';
        if (type === 'command') text = text.replace(/(SELECT|FROM|WHERE|ALTER|USER|PROFILE|LIMIT|SYSTEM|SET|AND|OR|SHOW|PARAMETER|REVOKE|GRANT|TABLESPACE|HOST)/gi, '<span class="keyword">$1</span>');
        line.innerHTML = `<span class="${type}">${text}</span>`;
        output.appendChild(line);
        output.scrollTop = output.scrollHeight;
    }

    function printTable(data, cols) {
        if (!data || data.length === 0) { printTerminal('no rows selected', 'output'); return; }
        let html = '<table class="sql-table"><thead><tr>';
        cols.forEach(c => html += `<th>${c}</th>`);
        html += '</tr></thead><tbody>';
        data.forEach(row => {
            html += '<tr>';
            cols.forEach(c => {
                let val = row[c] || '';
                let style = (val === 'UNLIMITED' || val === 'NULL' || val === 'FALSE' || val === 'OPEN' || val === 'SYSTEM' || val === 'DBA' || val === 'PUBLIC' || val === 'NONE') ? 'class="val-bad"' : 'class="val-good"';
                if(['USERNAME','GRANTEE','TABLE_NAME','PROFILE','RESOURCE_NAME','NAME'].includes(c)) style = '';
                html += `<td ${style}>${val}</td>`;
            });
            html += '</tr>';
        });
        html += '</tbody></table>';
        const div = document.createElement('div');
        div.innerHTML = html;
        document.getElementById('terminal-output').appendChild(div);
        document.getElementById('terminal-output').scrollTop = document.getElementById('terminal-output').scrollHeight;
    }

    function executeSQL(rawCmd) {
        const cmd = rawCmd.trim().toUpperCase();
        if (!cmd) return;
        printTerminal(rawCmd, 'command');

        if (cmd === 'CLEAR') { document.getElementById('terminal-output').innerHTML = ''; return; }
        if (cmd === 'CHECK' && currentItem) { executeSQL(currentItem.checkQuery); return; }

        // SQL Parser Logic
        let handled = false;

        // SELECT
        if (cmd.startsWith('SELECT')) {
            if (cmd.includes('DBA_USERS')) {
                let d = virtualDB.dba_users;
                if (cmd.includes("'SCOTT'")) d = d.filter(u => u.USERNAME === 'SCOTT');
                printTable(d, ['USERNAME', 'ACCOUNT_STATUS', 'DEFAULT_TABLESPACE']);
            } 
            else if (cmd.includes('DBA_PROFILES')) {
                let d = virtualDB.dba_profiles;
                const m = cmd.match(/RESOURCE_NAME\s*=\s*'([^']+)'/);
                if (m) d = d.filter(p => p.RESOURCE_NAME === m[1]);
                printTable(d, ['PROFILE', 'RESOURCE_NAME', 'LIMIT']);
            }
            else if (cmd.includes('DBA_ROLE_PRIVS')) {
                let d = virtualDB.dba_role_privs;
                if (cmd.includes("'DBA'") && cmd.includes("'SCOTT'")) d = d.filter(p => p.GRANTED_ROLE === 'DBA' && p.GRANTEE === 'SCOTT');
                printTable(d, ['GRANTEE', 'GRANTED_ROLE']);
            }
            else if (cmd.includes('DBA_TAB_PRIVS')) {
                let d = virtualDB.dba_tab_privs;
                if (cmd.includes("'PUBLIC'")) d = d.filter(p => p.GRANTEE === 'PUBLIC');
                if (cmd.includes("'UTL_FILE'")) d = d.filter(p => p.TABLE_NAME === 'UTL_FILE');
                if (cmd.includes("IN ('UTL_TCP','UTL_HTTP')")) d = d.filter(p => ['UTL_TCP','UTL_HTTP'].includes(p.TABLE_NAME));
                printTable(d, ['GRANTEE', 'TABLE_NAME', 'PRIVILEGE']);
            }
            handled = true;
        }
        // SHOW PARAMETER
        else if (cmd.startsWith('SHOW PARAMETER')) {
            if(cmd.includes('AUDIT_TRAIL')) printTable(virtualDB.v_parameter.filter(p=>p.NAME==='audit_trail'), ['NAME','VALUE']);
            else printTable(virtualDB.v_parameter, ['NAME', 'VALUE']);
            handled = true;
        }
        // ALTER / REVOKE
        else if (cmd.startsWith('ALTER') || cmd.startsWith('REVOKE')) {
            let changed = false;
            // D-01, D-10: User
            if (cmd.includes('USER SCOTT')) {
                const u = virtualDB.dba_users.find(x => x.USERNAME === 'SCOTT');
                if (u) {
                    if (cmd.includes('LOCK')) { u.ACCOUNT_STATUS = 'EXPIRED & LOCKED'; changed = true; }
                    if (cmd.includes('DEFAULT TABLESPACE')) { u.DEFAULT_TABLESPACE = 'USERS'; changed = true; }
                }
            }
            // D-11: Revoke Role
            else if (cmd.includes('REVOKE DBA')) {
                virtualDB.dba_role_privs = virtualDB.dba_role_privs.filter(p => !(p.GRANTEE === 'SCOTT' && p.GRANTED_ROLE === 'DBA'));
                changed = true;
            }
            // D-23, D-24: Revoke Obj Priv
            else if (cmd.includes('REVOKE EXECUTE ON')) {
                const target = cmd.match(/ON\s+([^\s]+)/)[1];
                virtualDB.dba_tab_privs = virtualDB.dba_tab_privs.filter(p => !(p.TABLE_NAME === target && p.GRANTEE === 'PUBLIC'));
                changed = true;
            }
            // D-08, D-25: System Param
            else if (cmd.includes('SYSTEM SET')) {
                if (cmd.includes('RESOURCE_LIMIT')) { virtualDB.v_parameter.find(p=>p.NAME==='resource_limit').VALUE = 'TRUE'; changed = true; }
                if (cmd.includes('AUDIT_TRAIL')) { virtualDB.v_parameter.find(p=>p.NAME==='audit_trail').VALUE = 'DB'; changed = true; }
            }
            // Profiles
            else if (cmd.includes('PROFILE')) {
                const limits = {
                    'FAILED_LOGIN_ATTEMPTS': '5', 'PASSWORD_LIFE_TIME': '90',
                    'PASSWORD_VERIFY_FUNCTION': 'VERIFY_FUNCTION_11G', 'PASSWORD_REUSE_MAX': '3', 'IDLE_TIME': '60'
                };
                for (let k in limits) {
                    if (cmd.includes(k)) {
                        virtualDB.dba_profiles.find(p => p.RESOURCE_NAME === k).LIMIT = limits[k];
                        changed = true;
                    }
                }
            }
            
            if (changed) { printTerminal('Command processed successfully.', 'success'); updateUI(); }
            else printTerminal('No changes made or invalid command.', 'error');
            handled = true;
        }
        // HOST (OS Cmds)
        else if (cmd.startsWith('HOST')) {
            const os = cmd.replace('HOST', '').trim();
            if (os.includes('lsnrctl status')) {
                const s = virtualDB.listener_ora.use_password ? 'ON' : 'OFF';
                printTerminal(`LSNRCTL Status... Security ${s}`, 'output');
            }
            else if (os.includes('lsnrctl change_password')) {
                virtualDB.listener_ora.use_password = true;
                printTerminal('Listener password set.', 'success'); updateUI();
            }
            else if (os.includes('cat') && os.includes('sqlnet.ora')) {
                printTerminal(`tcp.validnode_checking = ${virtualDB.sqlnet_ora.validnode_checking}`, 'output');
            }
            else if (os.includes('echo') && os.includes('sqlnet.ora')) {
                virtualDB.sqlnet_ora.validnode_checking = 'yes';
                printTerminal('Configuration appended to sqlnet.ora', 'success'); updateUI();
            }
            handled = true;
        }

        if (!handled) printTerminal('ORA-00900: invalid SQL statement', 'error');
    }

    function runAutoFix() {
        if (!currentItem) return;
        const qs = currentItem.fixQuery.split('\n');
        qs.forEach(q => executeSQL(q));
    }

    function updateStatus() {
        const secure = checkItems.filter(i => i.check()).length;
        const total = checkItems.length;
        const b = document.getElementById('overall-status');
        b.innerText = secure === total ? "âœ“ ALL SECURE" : `âš  VULNERABLE (${secure}/${total})`;
        b.className = secure === total ? "status-badge status-secure" : "status-badge status-vulnerable";
    }

    function updateUI() {
        renderChecklist();
        renderGuide();
        updateStatus();
    }

    document.getElementById('terminal-input').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') { executeSQL(e.target.value); e.target.value = ''; }
    });

    init();
  </script>
</body>
</html>