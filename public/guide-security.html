<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2-2. 보안 기능</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        code, pre { font-family: 'Fira Code', monospace; }
        
        /* Syntax Highlighting Simulators */
        .code-keyword { color: #c678dd; } /* purple */
        .code-function { color: #61afef; } /* blue */
        .code-string { color: #98c379; } /* green */
        .code-comment { color: #5c6370; font-style: italic; } /* gray */
        .code-class { color: #e5c07b; } /* yellow */
        .code-number { color: #d19a66; } /* orange */
        
        .nav-active {
            border-left-color: #ef4444; /* red-500 (Theme color for Security Features) */
            color: #ef4444;
            font-weight: 700;
            background-color: #fef2f2;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="flex min-h-screen">
        
        <!-- Table of Contents -->
        <nav class="hidden xl:block w-64 bg-white border-r border-slate-200 fixed h-full overflow-y-auto z-10">
            <div class="p-6">
                <h3 class="font-bold text-slate-900 mb-4 flex items-center gap-2">
                    <i class="fas fa-list-ul text-red-500"></i> 목차
                </h3>
                <ul class="space-y-1 text-sm text-slate-600">
                    <li><a href="#intro" class="block py-2 px-3 border-l-4 border-transparent hover:bg-slate-50 hover:text-red-600 transition">개요</a></li>
                    <li><a href="#broken-auth" class="block py-2 px-3 border-l-4 border-transparent hover:bg-slate-50 hover:text-red-600 transition">1. 적절한 인증 없는 중요기능 허용</a></li>
                    <li><a href="#broken-access" class="block py-2 px-3 border-l-4 border-transparent hover:bg-slate-50 hover:text-red-600 transition">2. 부적절한 인가</a></li>
                    <li><a href="#weak-crypto" class="block py-2 px-3 border-l-4 border-transparent hover:bg-slate-50 hover:text-red-600 transition">3. 취약한 암호화 알고리즘 사용</a></li>
                    <li><a href="#hardcoded" class="block py-2 px-3 border-l-4 border-transparent hover:bg-slate-50 hover:text-red-600 transition">4. 하드코딩된 비밀번호</a></li>
                    <li><a href="#plain-text" class="block py-2 px-3 border-l-4 border-transparent hover:bg-slate-50 hover:text-red-600 transition">5. 중요정보 평문 저장</a></li>
                    <li><a href="#random" class="block py-2 px-3 border-l-4 border-transparent hover:bg-slate-50 hover:text-red-600 transition">6. 취약한 난수 발생기</a></li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 xl:ml-64 p-8 max-w-5xl mx-auto">
            
            <!-- Header -->
            <header id="intro" class="mb-12 border-b border-slate-200 pb-8">
                <div class="flex items-center gap-3 mb-2">
                    <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-bold">Category 2-2</span>
                    <span class="text-slate-500 text-sm">소프트웨어 보안약점 진단가이드</span>
                </div>
                <h1 class="text-3xl font-bold text-slate-900 mb-4">보안 기능 (Security Features)</h1>
                <p class="text-slate-600 leading-relaxed">
                    인증, 접근 제어, 기밀성, 무결성 등을 보장하기 위한 보안 기능이 적절하게 구현되지 않아 발생하는 약점입니다.
                    <br><strong>암호화</strong>, <strong>인증/인가</strong>, <strong>세션 관리</strong> 등이 이 범주에 포함됩니다.
                </p>
            </header>

            <!-- 1. Broken Authentication -->
            <section id="broken-auth" class="mb-16 scroll-mt-20">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center text-red-600 text-xl font-bold">1</div>
                    <h2 class="text-2xl font-bold text-slate-800">적절한 인증 없는 중요기능 허용</h2>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-6 border-b border-slate-100">
                        <p class="text-slate-600 mb-4">
                            보안상 중요한 기능을 수행하는 페이지나 로직에서 사용자의 신원(세션 등)을 확인하지 않고 수행을 허용할 때 발생하는 취약점입니다.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2">
                        <!-- Vulnerable -->
                        <div class="bg-slate-50 p-6 border-r border-slate-200">
                            <h4 class="text-red-600 font-bold mb-3 flex items-center gap-2">
                                <i class="fas fa-times-circle"></i> 취약한 코드
                            </h4>
                            <pre class="bg-slate-900 text-slate-300 p-4 rounded-lg text-xs leading-relaxed overflow-x-auto">
<span class="code-comment">// 게시글 삭제 요청 처리 (Action)</span>
<span class="code-keyword">public</span> <span class="code-keyword">void</span> deleteBoard(HttpServletRequest req) {
    
    <span class="code-keyword">String</span> boardId = req.getParameter(<span class="code-string">"id"</span>);
    
    <span class="code-comment">// 인증 여부를 확인하지 않고 바로 삭제 수행</span>
    <span class="code-comment">// URL 직접 호출로 타인의 글 삭제 가능</span>
    boardService.delete(boardId);
    
}</pre>
                        </div>

                        <!-- Secure -->
                        <div class="bg-white p-6">
                            <h4 class="text-emerald-600 font-bold mb-3 flex items-center gap-2">
                                <i class="fas fa-check-circle"></i> 안전한 코드
                            </h4>
                            <pre class="bg-slate-900 text-slate-300 p-4 rounded-lg text-xs leading-relaxed overflow-x-auto">
<span class="code-keyword">public</span> <span class="code-keyword">void</span> deleteBoard(HttpServletRequest req) {
    
    HttpSession session = req.getSession(<span class="code-keyword">false</span>);
    
    <span class="code-comment">// 1. 세션 존재 여부 및 로그인 확인</span>
    <span class="code-keyword">if</span> (session == <span class="code-keyword">null</span> || session.getAttribute(<span class="code-string">"user"</span>) == <span class="code-keyword">null</span>) {
        <span class="code-keyword">throw</span> <span class="code-keyword">new</span> AuthenticationException(<span class="code-string">"로그인 필요"</span>);
    }
    
    <span class="code-keyword">String</span> boardId = req.getParameter(<span class="code-string">"id"</span>);
    <span class="code-comment">// 2. 본인 확인 후 삭제 (인가 검증 포함 권장)</span>
    boardService.delete(boardId);
}</pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. Broken Access Control -->
            <section id="broken-access" class="mb-16 scroll-mt-20">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center text-red-600 text-xl font-bold">2</div>
                    <h2 class="text-2xl font-bold text-slate-800">부적절한 인가 (권한 관리)</h2>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-6 border-b border-slate-100">
                        <p class="text-slate-600 mb-4">
                            접근 제어 로직이 없거나 불완전하여, 사용자가 본인의 권한 밖의 데이터나 기능에 접근할 수 있는 취약점입니다. (IDOR와 연관)
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2">
                        <div class="bg-slate-50 p-6 border-r border-slate-200">
                            <h4 class="text-red-600 font-bold mb-3"><i class="fas fa-times-circle"></i> 취약한 코드</h4>
                            <pre class="bg-slate-900 text-slate-300 p-4 rounded-lg text-xs leading-relaxed overflow-x-auto">
<span class="code-keyword">String</span> userId = req.getParameter(<span class="code-string">"userId"</span>);
<span class="code-keyword">String</span> role = req.getParameter(<span class="code-string">"role"</span>);

<span class="code-comment">// 클라이언트가 보낸 파라미터(role)를 신뢰하여</span>
<span class="code-comment">// 관리자 페이지 접근을 허용함</span>
<span class="code-keyword">if</span> (<span class="code-string">"admin"</span>.equals(role)) {
    adminPage.show();
} <span class="code-keyword">else</span> {
    userPage.show();
}</pre>
                        </div>
                        <div class="bg-white p-6">
                            <h4 class="text-emerald-600 font-bold mb-3"><i class="fas fa-check-circle"></i> 안전한 코드</h4>
                            <pre class="bg-slate-900 text-slate-300 p-4 rounded-lg text-xs leading-relaxed overflow-x-auto">
HttpSession session = req.getSession();
User user = (User) session.getAttribute(<span class="code-string">"user"</span>);

<span class="code-comment">// 서버 세션에 저장된 사용자 정보를 기반으로</span>
<span class="code-comment">// 권한을 확인해야 함 (파라미터 조작 방지)</span>
<span class="code-keyword">if</span> (user != <span class="code-keyword">null</span> && user.isAdmin()) {
    adminPage.show();
} <span class="code-keyword">else</span> {
    <span class="code-keyword">throw</span> <span class="code-keyword">new</span> AccessDeniedException(<span class="code-string">"접근 권한 없음"</span>);
}</pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. Weak Encryption Algorithm -->
            <section id="weak-crypto" class="mb-16 scroll-mt-20">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center text-red-600 text-xl font-bold">3</div>
                    <h2 class="text-2xl font-bold text-slate-800">취약한 암호화 알고리즘 사용</h2>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-6 border-b border-slate-100">
                        <p class="text-slate-600 mb-4">
                            이미 해독 방법이 알려진 암호화 알고리즘(DES, RC4, MD5, SHA1 등)을 사용하여 정보를 보호하려 할 때 발생하는 약점입니다.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2">
                        <div class="bg-slate-50 p-6 border-r border-slate-200">
                            <h4 class="text-red-600 font-bold mb-3"><i class="fas fa-times-circle"></i> 취약한 코드</h4>
                            <pre class="bg-slate-900 text-slate-300 p-4 rounded-lg text-xs leading-relaxed overflow-x-auto">
<span class="code-keyword">import</span> java.security.MessageDigest;

<span class="code-keyword">public</span> <span class="code-keyword">byte</span>[] encrypt(<span class="code-keyword">String</span> password) {
    <span class="code-comment">// 취약한 알고리즘(MD5, SHA1) 사용 금지</span>
    MessageDigest md = MessageDigest.getInstance(<span class="code-string">"MD5"</span>);
    md.update(password.getBytes());
    <span class="code-keyword">return</span> md.digest();
}

<span class="code-comment">// DES 등 짧은 키 길이 알고리즘도 사용 금지</span>
Cipher c = Cipher.getInstance(<span class="code-string">"DES/ECB/PKCS5Padding"</span>);</pre>
                        </div>
                        <div class="bg-white p-6">
                            <h4 class="text-emerald-600 font-bold mb-3"><i class="fas fa-check-circle"></i> 안전한 코드</h4>
                            <pre class="bg-slate-900 text-slate-300 p-4 rounded-lg text-xs leading-relaxed overflow-x-auto">
<span class="code-keyword">import</span> java.security.MessageDigest;

<span class="code-keyword">public</span> <span class="code-keyword">byte</span>[] encrypt(<span class="code-keyword">String</span> password, <span class="code-keyword">byte</span>[] salt) {
    <span class="code-comment">// 안전한 알고리즘(SHA-256 이상) 사용</span>
    MessageDigest md = MessageDigest.getInstance(<span class="code-string">"SHA-256"</span>);
    
    <span class="code-comment">// 반드시 Salt를 추가하여 레인보우 테이블 공격 방지</span>
    md.update(salt);
    md.update(password.getBytes());
    <span class="code-keyword">return</span> md.digest();
}

<span class="code-comment">// 대칭키 암호화 시 AES-256 권장</span>
Cipher c = Cipher.getInstance(<span class="code-string">"AES/CBC/PKCS5Padding"</span>);</pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 4. Hardcoded Password -->
            <section id="hardcoded" class="mb-16 scroll-mt-20">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center text-red-600 text-xl font-bold">4</div>
                    <h2 class="text-2xl font-bold text-slate-800">하드코딩된 비밀번호</h2>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-6">
                        <p class="text-slate-600 mb-4">
                            소스코드 내부에 패스워드나 암호화 키를 평문으로 직접 기록할 경우, 코드 유출 시 중요 시스템이 즉시 위험에 노출됩니다.
                        </p>
                        <div class="bg-slate-900 text-slate-300 p-6 rounded-lg overflow-x-auto">
                            <h4 class="text-emerald-400 font-bold mb-3 border-b border-slate-700 pb-2">안전한 관리 방법 (설정 파일 암호화)</h4>
                            <pre class="font-mono text-xs leading-relaxed">
<span class="code-comment">// [Bad] 소스코드에 비밀번호 노출</span>
<span class="code-comment">// String dbPw = "P@ssword1234";</span>

<span class="code-comment">// [Good] 외부 설정 파일 또는 환경 변수에서 로드</span>
Properties props = <span class="code-keyword">new</span> Properties();
props.load(<span class="code-keyword">new</span> FileInputStream(<span class="code-string">"config.properties"</span>));

<span class="code-keyword">String</span> encryptedPw = props.getProperty(<span class="code-string">"db.password"</span>);
<span class="code-keyword">String</span> secretKey = System.getenv(<span class="code-string">"APP_SECRET_KEY"</span>);

<span class="code-comment">// 로드 후 복호화하여 메모리에서만 잠시 사용</span>
<span class="code-keyword">String</span> dbPw = decrypt(encryptedPw, secretKey);
connectDB(dbPw);</pre>
                        </div>
                    </div>
                </div>
            </section>

             <!-- 5. Plain Text Storage -->
             <section id="plain-text" class="mb-16 scroll-mt-20">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center text-red-600 text-xl font-bold">5</div>
                    <h2 class="text-2xl font-bold text-slate-800">중요정보 평문 저장</h2>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-6 border-b border-slate-100">
                        <p class="text-slate-600">
                            패스워드, 주민등록번호, 계좌번호 등 중요 정보를 DB나 파일에 저장할 때 암호화하지 않고 평문으로 저장하면, 유출 사고 시 피해 규모가 커집니다.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2">
                        <div class="bg-slate-50 p-6 border-r border-slate-200">
                            <h4 class="text-red-600 font-bold mb-3"><i class="fas fa-times-circle"></i> 취약한 코드</h4>
                            <pre class="bg-slate-900 text-slate-300 p-4 rounded-lg text-xs leading-relaxed overflow-x-auto">
<span class="code-keyword">String</span> ssn = request.getParameter(<span class="code-string">"ssn"</span>);

<span class="code-comment">// 주민번호를 평문 그대로 DB에 저장</span>
<span class="code-keyword">String</span> sql = <span class="code-string">"INSERT INTO users (ssn) VALUES (?)"</span>;
pstmt.setString(1, ssn);</pre>
                        </div>
                        <div class="bg-white p-6">
                            <h4 class="text-emerald-600 font-bold mb-3"><i class="fas fa-check-circle"></i> 안전한 코드</h4>
                            <pre class="bg-slate-900 text-slate-300 p-4 rounded-lg text-xs leading-relaxed overflow-x-auto">
<span class="code-keyword">String</span> ssn = request.getParameter(<span class="code-string">"ssn"</span>);

<span class="code-comment">// 개인정보는 반드시 암호화하여 저장 (AES-256 등)</span>
<span class="code-keyword">String</span> encryptedSsn = AES256.encrypt(ssn, key);

<span class="code-keyword">String</span> sql = <span class="code-string">"INSERT INTO users (ssn) VALUES (?)"</span>;
pstmt.setString(1, encryptedSsn);</pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 6. Insecure Randomness -->
            <section id="random" class="mb-20 scroll-mt-20">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center text-red-600 text-xl font-bold">6</div>
                    <h2 class="text-2xl font-bold text-slate-800">보안 기능에 취약한 난수 발생기 사용</h2>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                    <p class="text-slate-600 mb-4">
                        예측 가능한 난수(Random)를 사용하여 세션 ID, 토큰, 임시 비밀번호를 생성하면 공격자가 이를 추측하여 인증을 우회할 수 있습니다.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-slate-900 text-slate-300 p-4 rounded-lg text-xs leading-relaxed">
                            <div class="text-red-400 font-bold mb-2">[Bad] 예측 가능</div>
                            <pre><span class="code-keyword">import</span> java.util.Random;

Random r = <span class="code-keyword">new</span> Random();
<span class="code-comment">// 시드값이 시간 기반이면 추측 가능</span>
<span class="code-keyword">int</span> token = r.nextInt();</pre>
                        </div>
                        <div class="bg-slate-900 text-slate-300 p-4 rounded-lg text-xs leading-relaxed">
                            <div class="text-emerald-400 font-bold mb-2">[Good] 암호학적으로 안전</div>
                            <pre><span class="code-keyword">import</span> java.security.SecureRandom;

SecureRandom sr = <span class="code-keyword">new</span> SecureRandom();
<span class="code-keyword">byte</span>[] values = <span class="code-keyword">new</span> <span class="code-keyword">byte</span>[20];
sr.nextBytes(values); <span class="code-comment">// 예측 불가능 난수</span></pre>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        // Scroll spy for navigation
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('nav a');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= sectionTop - 150) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('nav-active');
                if (link.getAttribute('href').includes(current)) {
                    link.classList.add('nav-active');
                }
            });
        });
    </script>
</body>
</html>