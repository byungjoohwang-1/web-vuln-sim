<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HTTP Response Splitting</title>
    <script src="config.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto;}
        .container { display: flex; gap: 20px; }
        .box { flex: 1; border: 1px solid #ddd; padding: 20px; border-radius: 8px; }
        .vuln { background-color: #ffe6e6; }
        .secure { background-color: #e6fffa; }
        input { width: 100%; padding: 8px; margin: 10px 0; }
        button { padding: 8px 16px; cursor: pointer; }
        .code-section { margin-top: 40px; border-top: 2px solid #eee; padding-top: 20px; }
        details { background: #f9f9f9; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ddd; }
        summary { padding: 10px; cursor: pointer; font-weight: bold; list-style: none; }
        summary:hover { background-color: #f0f0f0; }
        pre { background: #333; color: #fff; padding: 15px; overflow-x: auto; margin: 0; border-radius: 0 0 5px 5px; }
        code { font-family: monospace; }
        .comment { color: #999; }
    </style>
</head>
<body>
    <a href="index.html">â† Main Menu</a>
    <h1>HTTP ì‘ë‹µ ë¶„í•  (HTTP Response Splitting)</h1>
    
    <div style="background:#f4f7f9; padding:15px; margin-bottom:20px; border-left:5px solid #007bff;">
        <h3>ğŸ“˜ ì·¨ì•½ì  ê°œìš” (Overview)</h3>
        <p><strong>[KR]</strong> ì™¸ë¶€ ì…ë ¥ê°’ì— ê°œí–‰ë¬¸ì(CR, LF)ê°€ í¬í•¨ë˜ë©´ HTTP ì‘ë‹µì´ 2ê°œ ì´ìƒìœ¼ë¡œ ë¶„ë¦¬ë  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ XSSë‚˜ ìºì‹œ í›¼ì† ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
        <p><strong>[EN]</strong> If external input contains CRLF characters, the HTTP response can be split, enabling XSS or Cache Poisoning attacks.</p>
    </div>
    
    <div class="container">
        <div class="box vuln">
            <h2>ğŸš« ì·¨ì•½í•œ ëª¨ë“œ (Vulnerable)</h2>
            <p>ê³µê²©: <code>%0d%0a</code> (CRLF) ì‚¬ìš©</p>
            <input type="text" id="vulnInput" value="guest%0d%0aSet-Cookie:Hacked=true">
            <button onclick="runTest('vulnerableSplit', 'vulnInput')">Run Attack</button>
        </div>

        <div class="box secure">
            <h2>âœ… ì•ˆì „í•œ ëª¨ë“œ (Secure)</h2>
            <p>ë°©ì–´: ê°œí–‰ë¬¸ì ì œê±° (Remove CRLF)</p>
            <input type="text" id="secureInput" value="guest%0d%0aSet-Cookie:Hacked=true">
            <button onclick="runTest('secureSplit', 'secureInput')">Run Secure</button>
        </div>
    </div>

    <div class="code-section">
        <h2>ğŸ“š ì–¸ì–´ë³„ ì‹œíì–´ ì½”ë”© ê°€ì´ë“œ (Secure Coding Guide)</h2>
        <details open>
            <summary>ğŸ Python (Django/Flask)</summary>
            <pre><code><span class="comment"># [KR] í—¤ë”, ì¿ í‚¤ ë“±ì— ì‚¬ìš©ë˜ëŠ” ì…ë ¥ê°’ì—ì„œ ê°œí–‰ë¬¸ìë¥¼ ì œê±°í•´ì•¼ í•œë‹¤.</span>
<span class="comment"># [EN] Remove CRLF characters from inputs used in headers or cookies.</span>

def secure_view(request):
    user_input = request.GET.get('next')
    
    if user_input:
        <span class="comment"># [KR] CR(\r), LF(\n) ë¬¸ìë¥¼ ê³µë°±ìœ¼ë¡œ ì¹˜í™˜í•˜ê±°ë‚˜ ì œê±°</span>
        <span class="comment"># [EN] Replace CR(\r), LF(\n) with empty string</span>
        safe_input = user_input.replace('\r', '').replace('\n', '')
        
        response['Location'] = safe_input
        return response</code></pre>
        </details>

        <details>
            <summary>â˜• Java (JSP/Servlet)</summary>
            <pre><code><span class="comment">// [KR] ì™¸ë¶€ ì…ë ¥ê°’ì—ì„œ ê°œí–‰ë¬¸ì(\r, \n)ë¥¼ ì œê±°í•œ í›„ ì‚¬ìš©í•œë‹¤.</span>
<span class="comment">// [EN] Use external input after removing newline characters.</span>

String input = request.getParameter("id");
if (input != null) {
    <span class="comment">// replaceAllì„ ì‚¬ìš©í•˜ì—¬ ê°œí–‰ ë¬¸ì ì œê±°</span>
    String safeInput = input.replaceAll("\\r", "").replaceAll("\\n", "");
    response.setHeader("Set-Cookie", "USER=" + safeInput);
}</code></pre>
        </details>
    </div>

    <script>
        function runTest(funcName, inputId) {
            const inputVal = document.getElementById(inputId).value;
            const url = `${BASE_URL}/${funcName}?input=${inputVal}`;
            window.open(url, '_blank');
        }
    </script>
</body>
</html>