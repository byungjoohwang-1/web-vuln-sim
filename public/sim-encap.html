<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2-6. 캡슐화 및 API 오용 가이드</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            background-color: #f8f9fa;
        }
        #wrapper {
            display: flex;
            width: 100%;
            height: 100vh;
        }
        #sidebar-wrapper {
            min-height: 100vh;
            width: 280px;
            background-color: #0f172a;
            color: #94a3b8;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-brand {
            padding: 1.5rem 1.25rem;
            color: #fff;
            font-size: 1.25rem;
            font-weight: bold;
            border-bottom: 1px solid #1e293b;
        }
        
        .sidebar-brand small {
            display: block;
            font-size: 0.65rem;
            color: #64748b;
            margin-top: 5px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* 메뉴 아이템 스타일 */
        .list-group-item {
            background-color: transparent;
            color: #94a3b8;
            border: none;
            padding: 0.7rem 1.5rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .list-group-item:hover, .list-group-item:focus, .list-group-item.active {
            background-color: #1e293b;
            color: #fff;
        }
        
        .list-group-item i {
            width: 20px;
            margin-right: 8px;
            text-align: center;
        }

        /* 카테고리 헤더 */
        .menu-category {
            padding: 12px 20px;
            color: #fff;
            font-weight: 600;
            background-color: #1e293b;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-size: 0.95rem;
        }
        
        /* 메인 콘텐츠 영역 */
        #page-content-wrapper {
            width: 100%;
            overflow-y: auto;
            background-color: #fff;
        }
        .code-block-header {
            background-color: #1e293b;
            color: #fff;
            padding: 0.5rem 1rem;
            font-weight: bold;
            border-radius: 0.25rem 0.25rem 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        pre[class*="language-"] {
            margin: 0;
            border-radius: 0 0 0.25rem 0.25rem;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>
<body>

<div id="wrapper">
    <div id="sidebar-wrapper">
        <div class="sidebar-brand">
            <i class="fa-solid fa-cube me-2"></i> Web Security Simulator
            <small>V0.2 BETA | MADE BY JACK</small>
        </div>

        <div class="list-group list-group-flush mt-2">
            
            <div class="menu-category" data-bs-toggle="collapse" data-bs-target="#menu1">
                <span><i class="fa-solid fa-bug text-danger me-2"></i> 1. Simulator (10 Attacks)</span>
                <i class="fa-solid fa-chevron-down fa-xs"></i>
            </div>
            
            <div class="collapse show" id="menu1">
                <a href="sim-sql.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-database"></i> SQL Injection</a>
                <a href="sim-cmd.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-terminal"></i> Command Injection</a>
                <a href="sim-xxe.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-file-code"></i> XXE Injection</a>
                <a href="sim-xss.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-code"></i> Reflected XSS</a>
                <a href="sim-csrf.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-globe"></i> CSRF Attack</a>
                <a href="sim-ssrf.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-server"></i> SSRF</a>
                <a href="sim-upload.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-file-arrow-up"></i> File Upload</a>
                <a href="sim-path.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-folder-open"></i> Path Traversal</a>
                <a href="sim-split.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-arrows-split-up-and-left"></i> HTTP Splitting</a>
                <a href="sim-brute.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-lock"></i> Brute Force</a>
                <a href="sim-idor.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-id-card"></i> IDOR</a>
                <a href="sim-code.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-code-branch"></i> Code Injection</a>
            </div>

            <div class="menu-category mt-1" data-bs-toggle="collapse" data-bs-target="#menu2">
                <span><i class="fa-solid fa-book me-2"></i> 2. Secure Coding Guidelines</span>
                <i class="fa-solid fa-chevron-down fa-xs"></i>
            </div>
            
            <div class="collapse show" id="menu2">
                <a href="guide-input.html" class="list-group-item list-group-item-action"><i class="fa-regular fa-file-lines"></i> 2-1. 입력 데이터 검증 및 표현</a>
                <a href="guide-security.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-shield-halved"></i> 2-2. 보안 기능</a>
                <a href="sim-time-state.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-hourglass-half"></i> 2-3. 시간 및 상태</a>
                <a href="sim-error-handling.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-bug"></i> 2-4. 에러 처리</a>
                <a href="sim-quality.html" class="list-group-item list-group-item-action"><i class="fa-solid fa-check-double"></i> 2-5. 코드 품질</a>
                
                <a href="sim-encap.html" class="list-group-item list-group-item-action active">
                    <i class="fa-solid fa-box-open"></i> 2-6. 캡슐화 및 API 오용
                </a>
            </div>
        </div>
    </div>
    
    <div id="page-content-wrapper">
        <div class="container-fluid p-5">
            <h1 class="mb-4 text-primary"><i class="fa-solid fa-box-open me-2"></i> 2-6. 캡슐화 및 API 오용 가이드</h1>
            <p class="lead">데이터의 은닉(캡슐화) 문제와 부적절한 API 사용으로 인한 취약점 가이드를 **Java**와 **Python** 코드를 통해 학습합니다.</p>
            <hr>
            
            <h2 class="mt-5 mb-4 text-primary"><i class="fa-solid fa-lock me-2"></i> 제6절: 캡슐화</h2>

            <h3 class="mt-4 mb-3 text-danger"><i class="fa-solid fa-user-secret me-2"></i> 1. 잘못된 세션에 의한 데이터 정보노출</h3>
            <p class="text-secondary">세션에 민감한 정보(비밀번호, 중요 권한 등)를 저장하거나, 세션 만료 시간을 부적절하게 설정하여 정보가 노출됩니다.</p>
            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-danger"><span>Java - 취약한 코드</span><span class="badge bg-light text-dark">세션 정보 노출</span></div>
                        <pre><code class="language-java">/* 취약한 코드 (Java Servlet) */
HttpSession session = request.getSession();
// 세션에 민감 정보를 저장 (예: 비밀번호)
session.setAttribute("userPassword", password); 
// 세션 만료 시간을 너무 길게 설정 (예: 1시간)
session.setMaxInactiveInterval(60 * 60); 
</code></pre>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-success"><span>Java - 안전한 코드</span><span class="badge bg-light text-dark">Fix: 세션 관리</span></div>
                        <pre><code class="language-java">/* 안전한 코드 (Java Servlet) */
HttpSession session = request.getSession(false); // 기존 세션 사용
if (session != null) {
    // 세션에 식별자나 권한 정보만 저장
    session.setAttribute("userId", userId); 
    // 세션 만료 시간은 짧게 설정 (예: 5분)
    session.setMaxInactiveInterval(5 * 60);
}
// 로그아웃 시 session.invalidate()를 반드시 호출해야 합니다.
</code></pre>
                    </div>
                </div>
            </div>
            
            <h3 class="mt-5 mb-3 text-danger"><i class="fa-solid fa-laptop-code me-2"></i> 2. 제거되지 않고 남은 디버그 코드</h3>
            <p class="text-secondary">개발 단계에서 사용한 테스트 계정, 하드코딩된 비밀번호, 상세 디버그 출력 코드가 프로덕션 환경에 남아 정보가 노출됩니다.</p>
            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-danger"><span>Python - 취약한 코드</span><span class="badge bg-light text-dark">하드코딩된 인증정보</span></div>
                        <pre><code class="language-python"># 취약한 코드 (Python)
import logging
# ... (생략)

# 디버깅 목적으로 하드코딩된 비밀번호 (배포 후 제거 누락)
DEFAULT_ADMIN_PASS = "dev_1234!" 

def check_login(user, password):
    if user == "dev_admin":
        print(f"DEBUG: Attempting login with password: {password}")
        return True
    # ...
</code></pre>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-success"><span>Python - 안전한 코드</span><span class="badge bg-light text-dark">Fix: 환경 변수/조건부 로깅</span></div>
                        <pre><code class="language-python"># 안전한 코드 (Python)
import os 
import logging

# 1. 민감 정보는 환경 변수에서 로드
ADMIN_PASS = os.environ.get("ADMIN_SECRET")

def check_login_secure(user, password):
    # 2. 디버그 로그는 환경 설정에 따라 조건부로 출력
    if os.environ.get("ENV") == "DEBUG":
        logging.debug(f"Attempting login for user: {user}") 
    # ...
    return authenticate(user, password, ADMIN_PASS)
</code></pre>
                    </div>
                </div>
            </div>

            <h3 class="mt-5 mb-3 text-danger"><i class="fa-solid fa-clone me-2"></i> 3. Public 메서드로부터 반환된 Private 배열</h3>
            <p class="text-secondary">클래스의 Private 배열을 Public Getter 메서드가 참조 형태로 반환하면, 외부에서 배열 값을 직접 수정할 수 있어 객체의 불변성이 깨집니다.</p>
            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-danger"><span>Java - 취약한 코드</span><span class="badge bg-light text-dark">참조 반환</span></div>
                        <pre><code class="language-java">/* 취약한 코드 (Java) */
public class UserInfo {
    private String[] privileges = {"VIEW", "EDIT"};

    public String[] getPrivileges() {
        // 내부 배열의 참조(주소)를 직접 반환
        return privileges; 
    }
}
// 외부에서 UserInfo.getPrivileges()[0] = "DELETE"; 로 수정 가능
</code></pre>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-success"><span>Java - 안전한 코드</span><span class="badge bg-light text-dark">Fix: 방어적 복사/불변객체</span></div>
                        <pre><code class="language-java">/* 안전한 코드 (Java) */
public class UserInfoSecure {
    private String[] privileges = {"VIEW", "EDIT"};

    public String[] getPrivileges() {
        // 1. 방어적 복사 (Defensive Copy)를 통해 새로운 배열 반환
        return privileges.clone(); 
    }

    public List<String> getPrivilegesImmutable() {
        // 2. 불변 List로 반환 (권장)
        return Collections.unmodifiableList(Arrays.asList(privileges));
    }
}
</code></pre>
                    </div>
                </div>
            </div>

            <h3 class="mt-5 mb-3 text-danger"><i class="fa-solid fa-handshake-simple-slash me-2"></i> 4. Private 배열에 Public 데이터 할당</h3>
            <p class="text-secondary">생성자나 Setter를 통해 외부에서 받은 배열(Public)을 Private 배열에 직접 할당하면, 외부에서 원본 배열을 수정하여 Private 배열의 값을 변경할 수 있습니다. (방어적 복사가 누락된 경우)</p>
            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-danger"><span>Java - 취약한 코드</span><span class="badge bg-light text-dark">참조 할당</span></div>
                        <pre><code class="language-java">/* 취약한 코드 (Java) */
public class Settings {
    private String[] internalSettings;

    public Settings(String[] externalSettings) {
        // 외부 배열의 참조를 내부 변수에 직접 할당 (방어적 복사 누락)
        this.internalSettings = externalSettings; 
    }
}
// 외부에서 externalSettings의 내용을 수정하면 internalSettings도 같이 수정됨
</code></pre>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-success"><span>Java - 안전한 코드</span><span class="badge bg-light text-dark">Fix: 방어적 복사</span></div>
                        <pre><code class="language-java">/* 안전한 코드 (Java) */
public class SettingsSecure {
    private String[] internalSettings;

    public SettingsSecure(String[] externalSettings) {
        // 방어적 복사 (Defensive Copy)를 통해 새로운 배열 생성 후 할당
        this.internalSettings = externalSettings.clone(); 
    }
    // 이제 외부 배열 수정 시 내부 배열에 영향을 미치지 않음
}
</code></pre>
                    </div>
                </div>
            </div>


            <hr class="my-5">

            <h2 class="mt-5 mb-4 text-primary"><i class="fa-solid fa-wrench me-2"></i> 제7절: API 오용</h2>

            <h3 class="mt-4 mb-3 text-danger"><i class="fa-solid fa-server me-2"></i> 1. DNS lookup에 의존한 보안결정</h3>
            <p class="text-secondary">IP 주소 대신 도메인 이름(DNS)을 사용하여 보안 결정(예: 방화벽/접근 제어)을 내리면, 공격자가 DNS 스푸핑 등을 통해 우회할 수 있습니다.</p>
            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-danger"><span>Python - 취약한 코드</span><span class="badge bg-light text-dark">DNS 기반 인증</span></div>
                        <pre><code class="language-python"># 취약한 코드 (Python)
import socket

def check_access(ip_address):
    # IP 주소로 도메인 이름을 역조회하여 접근 결정 (위험!)
    try:
        hostname = socket.gethostbyaddr(ip_address)[0]
    except socket.error:
        hostname = None
        
    # DNS 룩업 결과에 보안 결정 의존 (공격자는 DNS 스푸핑 가능)
    if hostname and hostname.endswith(".internal-corp.com"):
        return True 
    return False
</code></pre>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-success"><span>Python - 안전한 코드</span><span class="badge bg-light text-dark">Fix: IP 기반 인증</span></div>
                        <pre><code class="language-python"># 안전한 코드 (Python)
import ipaddress

TRUSTED_NETWORKS = ['192.168.1.0/24', '10.0.0.0/8']

def check_access_secure(ip_address):
    try:
        target_ip = ipaddress.ip_address(ip_address)
    except ValueError:
        return False

    # 1. 도메인 대신 IP 주소 또는 IP 대역을 사용하여 보안 결정
    for network in TRUSTED_NETWORKS:
        if target_ip in ipaddress.ip_network(network):
            return True
    return False
</code></pre>
                    </div>
                </div>
            </div>

            <h3 class="mt-5 mb-3 text-danger"><i class="fa-solid fa-times-circle me-2"></i> 2. 취약한 API 사용</h3>
            <p class="text-secondary">보안상 안전하지 않다고 알려진 레거시 함수(예: 난수 생성기, 비활성화된 암호화 함수)나, 부적절한 인증 함수를 사용하여 취약점이 발생합니다.</p>
            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-danger"><span>Java - 취약한 코드</span><span class="badge bg-light text-dark">약한 난수/암호</span></div>
                        <pre><code class="language-java">/* 취약한 코드 (Java) */
// 1. 예측 가능한 난수 생성기 사용 (암호학적으로 부적합)
Random r = new Random();
int token = r.nextInt(); 

// 2. MD5, SHA-1 등 취약한 해시 알고리즘 사용
MessageDigest md = MessageDigest.getInstance("MD5");
byte[] hash = md.digest(password.getBytes());
</code></pre>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm h-100">
                        <div class="code-block-header bg-success"><span>Java - 안전한 코드</span><span class="badge bg-light text-dark">Fix: 안전한 API 사용</span></div>
                        <pre><code class="language-java">/* 안전한 코드 (Java) */
// 1. 보안적으로 강력한 난수 생성기 사용 (SecureRandom)
SecureRandom sr = new SecureRandom();
byte[] tokenBytes = new byte[32];
sr.nextBytes(tokenBytes);

// 2. 강력한 해시 알고리즘 사용 (SHA-256 이상)
MessageDigest md = MessageDigest.getInstance("SHA-256");
// 또는 비밀번호 해싱을 위해 Bcrypt, Scrypt 등의 라이브러리 사용
</code></pre>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script>
    // 코드 하이라이팅 활성화
    document.addEventListener('DOMContentLoaded', (event) => {
        Prism.highlightAll();
    });
</script>

</body>
</html>