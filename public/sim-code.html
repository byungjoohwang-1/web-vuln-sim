<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸ˆìœµê¶Œ Code Injection ì‹¤ì „ ì‹œë®¬ë ˆì´í„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .code-font { font-family: 'Courier New', monospace; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        .animate-blink { animation: blink 1s infinite; }
        @keyframes matrix { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
        .matrix-effect { animation: matrix 3s linear infinite; }
    </style>
</head>
<body class="bg-gray-900 p-4">

    <!-- íƒ€ì´í‹€ -->
    <div class="max-w-7xl mx-auto mb-4">
        <div class="bg-gradient-to-r from-orange-600 to-red-600 text-white p-4 rounded-lg shadow-lg">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fas fa-code text-3xl"></i>
                    <div>
                        <h1 class="font-bold text-xl">ê¸ˆìœµê¶Œ Code Injection ê³µê²© ì‹¤ì „ ì‹œë‚˜ë¦¬ì˜¤</h1>
                        <p class="text-sm">WEB-SER-018: SSI Injection | ìœ„í—˜ë„: 5 (ë§¤ìš° ë†’ìŒ) | eval/exec í•¨ìˆ˜ ì‚¬ìš© ê¸ˆì§€</p>
                    </div>
                </div>
                <button onclick="resetAll()" class="bg-white text-orange-600 px-4 py-2 rounded font-bold hover:bg-gray-100">
                    <i class="fas fa-redo"></i> ì²˜ìŒë¶€í„°
                </button>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-4">
        
        <!-- ì¢Œì¸¡: ê³µê²©ì & í”¼í•´ì í™”ë©´ -->
        <div class="space-y-4">
            
            <!-- ê³µê²©ì í™”ë©´ -->
            <div class="bg-gray-800 text-white p-4 rounded-lg shadow-lg border-2 border-red-500">
                <div class="flex items-center gap-3 mb-3">
                    <i class="fas fa-user-secret text-red-400 text-2xl"></i>
                    <div>
                        <h2 class="font-bold text-lg">ğŸ”´ ê³µê²©ì (í•´ì»¤)</h2>
                        <p class="text-sm text-gray-400" id="attackerStatus">ì½”ë“œ ì‚½ì… ê³µê²© ì¤€ë¹„ ì¤‘...</p>
                    </div>
                </div>
                
                <!-- ê³µê²©ì ë¸Œë¼ìš°ì € -->
                <div class="bg-gray-900 rounded-lg overflow-hidden">
                    <div class="bg-gray-700 px-3 py-2 flex items-center gap-2">
                        <div class="flex gap-1">
                            <div class="w-2 h-2 rounded-full bg-red-500"></div>
                            <div class="w-2 h-2 rounded-full bg-yellow-500"></div>
                            <div class="w-2 h-2 rounded-full bg-green-500"></div>
                        </div>
                        <input type="text" id="attackerUrl" 
                               class="flex-1 bg-gray-800 text-white px-3 py-1 rounded text-xs code-font" 
                               value="https://xxbank.com/calculator"
                               readonly>
                    </div>
                    
                    <div id="attackerScreen" class="p-6 bg-white text-black min-h-[280px]">
                        <div class="text-center py-8">
                            <i class="fas fa-play-circle text-6xl text-orange-600 mb-4"></i>
                            <p class="text-gray-600">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í”¼í•´ì/ì€í–‰ í™”ë©´ -->
            <div class="bg-gray-800 text-white p-4 rounded-lg shadow-lg border-2 border-blue-500">
                <div class="flex items-center gap-3 mb-3">
                    <i class="fas fa-building-columns text-blue-400 text-2xl"></i>
                    <div>
                        <h2 class="font-bold text-lg">ğŸ”µ XXì€í–‰ ì„œë¹„ìŠ¤</h2>
                        <p class="text-sm text-gray-400" id="bankStatus">ì´ìê³„ì‚°ê¸° ì„œë¹„ìŠ¤ ìš´ì˜ ì¤‘...</p>
                    </div>
                </div>
                
                <!-- ì€í–‰ ì„œë¹„ìŠ¤ í™”ë©´ -->
                <div class="bg-gray-900 rounded-lg overflow-hidden">
                    <div class="bg-gray-700 px-3 py-2 flex items-center gap-2">
                        <div class="flex gap-1">
                            <div class="w-2 h-2 rounded-full bg-red-500"></div>
                            <div class="w-2 h-2 rounded-full bg-yellow-500"></div>
                            <div class="w-2 h-2 rounded-full bg-green-500"></div>
                        </div>
                        <input type="text" id="bankUrl" 
                               class="flex-1 bg-gray-800 text-white px-3 py-1 rounded text-xs code-font" 
                               value="https://xxbank.com/calculator"
                               readonly>
                    </div>
                    
                    <div id="bankScreen" class="p-6 bg-white text-black min-h-[280px]">
                        <div class="text-center py-8 text-gray-400">
                            <i class="fas fa-calculator text-4xl mb-3"></i>
                            <p>ì´ìê³„ì‚°ê¸° ëŒ€ê¸° ì¤‘...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê³µê²© ë‹¨ê³„ -->
            <div class="bg-gray-800 text-white p-4 rounded-lg shadow-lg">
                <h3 class="font-bold mb-3 flex items-center gap-2">
                    <i class="fas fa-list-ol text-orange-400"></i>
                    ê³µê²© ì§„í–‰ ë‹¨ê³„
                </h3>
                <div id="attackSteps" class="space-y-2 text-sm max-h-[250px] overflow-auto">
                    <div class="text-gray-500">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹œì‘í•˜ì„¸ìš”...</div>
                </div>
            </div>

            <!-- ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ -->
            <div class="bg-gray-800 text-white p-4 rounded-lg shadow-lg">
                <h3 class="font-bold mb-3 flex items-center gap-2">
                    <i class="fas fa-flask text-red-400"></i>
                    ì‹¤ì „ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤
                </h3>
                <div class="space-y-2">
                    <button onclick="startScenario(1)" 
                            class="w-full text-left bg-red-900 hover:bg-red-800 px-3 py-2 rounded text-sm transition">
                        <i class="fas fa-calculator"></i> <strong>ì‹œë‚˜ë¦¬ì˜¤ 1:</strong> ì´ìê³„ì‚°ê¸° eval() ê³µê²©
                    </button>
                    <button onclick="startScenario(2)" 
                            class="w-full text-left bg-orange-900 hover:bg-orange-800 px-3 py-2 rounded text-sm transition">
                        <i class="fas fa-dollar-sign"></i> <strong>ì‹œë‚˜ë¦¬ì˜¤ 2:</strong> í™˜ìœ¨ ê³„ì‚°ê¸° ì½”ë“œ ì‹¤í–‰
                    </button>
                    <button onclick="startScenario(3)" 
                            class="w-full text-left bg-purple-900 hover:bg-purple-800 px-3 py-2 rounded text-sm transition">
                        <i class="fas fa-database"></i> <strong>ì‹œë‚˜ë¦¬ì˜¤ 3:</strong> í…œí”Œë¦¿ ì¸ì ì…˜ â†’ DB íƒˆì·¨
                    </button>
                </div>
            </div>

            <!-- ì·¨ì•½í•œ ì½”ë“œ -->
            <div class="bg-gray-900 text-white p-4 rounded-lg shadow-lg border border-red-500">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-red-400">
                        <i class="fas fa-bug"></i> ì·¨ì•½í•œ ì„œë²„ ì½”ë“œ
                    </h3>
                    <span class="text-xs bg-red-600 px-2 py-1 rounded">ë¬¸ì œ ì›ì¸</span>
                </div>
                <pre class="code-font text-xs overflow-x-auto"><code><span class="text-gray-500"># Python Flask</span>
@app.route('/calculate', methods=['POST'])
def calculate():
    formula = request.form['formula']
    
    <span class="text-red-400"># âŒ ë¬¸ì œì : ì‚¬ìš©ì ì…ë ¥ì„ ì§ì ‘ ì‹¤í–‰!</span>
    <span class="text-red-400"># eval()ì€ ëª¨ë“  Python ì½”ë“œ ì‹¤í–‰ ê°€ëŠ¥</span>
    result = eval(formula)
    
    return jsonify({'result': result})

<span class="text-gray-500"># Java JSP</span>
&lt;%
String formula = request.getParameter("formula");

<span class="text-red-400">// âŒ ScriptEngineìœ¼ë¡œ ì½”ë“œ ì‹¤í–‰</span>
ScriptEngineManager manager = 
    new ScriptEngineManager();
ScriptEngine engine = 
    manager.getEngineByName("JavaScript");

<span class="text-red-400">// ì‚¬ìš©ì ì…ë ¥ì„ ê·¸ëŒ€ë¡œ ì‹¤í–‰!</span>
Object result = engine.eval(formula);
%&gt;</code></pre>
            </div>

        </div>

        <!-- ìš°ì¸¡: ì„œë²„ í™”ë©´ -->
        <div class="space-y-4">
            
            <!-- ì„œë²„ ê´€ì  -->
            <div class="bg-gray-800 text-white p-4 rounded-lg shadow-lg border-2 border-green-500">
                <div class="flex items-center gap-3 mb-3">
                    <i class="fas fa-server text-green-400 text-2xl"></i>
                    <div>
                        <h2 class="font-bold text-lg">ğŸŸ¢ ì„œë²„ ë‚´ë¶€</h2>
                        <p class="text-sm text-gray-400">XXì€í–‰ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„</p>
                    </div>
                </div>
                
                <!-- ì„œë²„ ì²˜ë¦¬ ê³¼ì • -->
                <div class="bg-gray-900 rounded-lg p-4 min-h-[400px] max-h-[500px] overflow-auto">
                    <div id="serverLog" class="code-font text-xs space-y-1 text-green-400">
                        <div class="text-gray-500">[SERVER] Waiting for request...</div>
                    </div>
                </div>
                
                <!-- ì„œë²„ ìƒíƒœ -->
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs text-gray-400">ì„œë²„ ìƒíƒœ:</span>
                    <span id="serverStatus" class="text-xs bg-blue-600 px-3 py-1 rounded">IDLE</span>
                </div>
            </div>

            <!-- ì‹¤í–‰ëœ ì½”ë“œ -->
            <div id="executedCode" class="hidden bg-gray-800 text-white p-4 rounded-lg shadow-lg">
                <div class="flex items-center gap-2 mb-3">
                    <i class="fas fa-terminal text-yellow-400"></i>
                    <h3 class="font-bold">ì„œë²„ì—ì„œ ì‹¤í–‰ëœ ì½”ë“œ</h3>
                </div>
                <div class="bg-gray-900 p-3 rounded code-font text-xs">
                    <div id="executedCodeContent" class="text-yellow-400"></div>
                </div>
            </div>

            <!-- ë¬¸ì œì  ë¶„ì„ -->
            <div id="problemBox" class="hidden bg-red-900 text-white p-4 rounded-lg shadow-lg">
                <div class="flex items-center gap-2 mb-3">
                    <i class="fas fa-exclamation-triangle text-yellow-400 text-xl animate-blink"></i>
                    <h3 class="font-bold">ğŸš¨ ë¬¸ì œì  ë¶„ì„</h3>
                </div>
                <div id="problemContent" class="text-sm space-y-2"></div>
            </div>

            <!-- ê³µê²© ì„±ê³µ -->
            <div id="successBox" class="hidden bg-green-900 text-white p-4 rounded-lg shadow-lg border-2 border-green-400">
                <div class="flex items-center gap-2 mb-3">
                    <i class="fas fa-skull-crossbones text-red-400 text-xl"></i>
                    <h3 class="font-bold">ğŸ’€ ê³µê²© ì„±ê³µ!</h3>
                </div>
                <div id="successContent" class="text-sm"></div>
            </div>

            <!-- ì•ˆì „í•œ ì½”ë“œ -->
            <div class="bg-gray-900 text-white p-4 rounded-lg shadow-lg border border-green-500">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-green-400">
                        <i class="fas fa-shield-halved"></i> ì•ˆì „í•œ ì„œë²„ ì½”ë“œ
                    </h3>
                    <span class="text-xs bg-green-600 px-2 py-1 rounded">í•´ê²°ì±…</span>
                </div>
                <pre class="code-font text-xs overflow-x-auto max-h-[600px]"><code><span class="text-gray-500"># Python Flask - ì•ˆì „í•œ ê³„ì‚°ê¸°</span>
import ast
import operator

<span class="text-green-400"># âœ… í—ˆìš©ëœ ì—°ì‚°ìë§Œ ì •ì˜</span>
ALLOWED_OPERATORS = {
    ast.Add: operator.add,
    ast.Sub: operator.sub,
    ast.Mult: operator.mul,
    ast.Div: operator.truediv,
    ast.Pow: operator.pow,
    ast.USub: operator.neg,
}

def safe_eval(expression):
    <span class="text-green-400"># âœ… 1ë‹¨ê³„: ë¬¸ìì—´ì„ ASTë¡œ íŒŒì‹±</span>
    try:
        tree = ast.parse(expression, mode='eval')
    except SyntaxError:
        raise ValueError("ì˜ëª»ëœ ìˆ˜ì‹ì…ë‹ˆë‹¤")
    
    <span class="text-green-400"># âœ… 2ë‹¨ê³„: AST ë…¸ë“œ ê²€ì¦</span>
    def eval_node(node):
        if isinstance(node, ast.Expression):
            return eval_node(node.body)
        
        elif isinstance(node, ast.Constant):
            <span class="text-green-400"># ìˆ«ìë§Œ í—ˆìš©</span>
            if isinstance(node.value, (int, float)):
                return node.value
            raise ValueError("ìˆ«ìë§Œ í—ˆìš©ë©ë‹ˆë‹¤")
        
        elif isinstance(node, ast.BinOp):
            <span class="text-green-400"># í—ˆìš©ëœ ì´í•­ ì—°ì‚°ë§Œ</span>
            if type(node.op) not in ALLOWED_OPERATORS:
                raise ValueError("í—ˆìš©ë˜ì§€ ì•Šì€ ì—°ì‚°")
            
            left = eval_node(node.left)
            right = eval_node(node.right)
            op = ALLOWED_OPERATORS[type(node.op)]
            return op(left, right)
        
        elif isinstance(node, ast.UnaryOp):
            <span class="text-green-400"># ë‹¨í•­ ì—°ì‚° (ìŒìˆ˜)</span>
            if type(node.op) not in ALLOWED_OPERATORS:
                raise ValueError("í—ˆìš©ë˜ì§€ ì•Šì€ ì—°ì‚°")
            
            operand = eval_node(node.operand)
            op = ALLOWED_OPERATORS[type(node.op)]
            return op(operand)
        
        else:
            raise ValueError(
                "í—ˆìš©ë˜ì§€ ì•Šì€ í‘œí˜„ì‹: " + 
                type(node).__name__
            )
    
    return eval_node(tree)

@app.route('/calculate', methods=['POST'])
def calculate():
    formula = request.form['formula']
    
    try:
        <span class="text-green-400"># âœ… ì•ˆì „í•œ í‰ê°€ í•¨ìˆ˜ ì‚¬ìš©</span>
        result = safe_eval(formula)
        
        <span class="text-green-400"># âœ… ë¡œê¹…</span>
        logger.info(f"Calculated: {formula} = {result}")
        
        return jsonify({'result': result})
    
    except ValueError as e:
        <span class="text-green-400"># âœ… ê³µê²© ì‹œë„ ê°ì§€ ë° ë¡œê¹…</span>
        logger.warning(
            f"Blocked eval attempt: {formula}, " +
            f"ip: {request.remote_addr}"
        )
        return jsonify({'error': str(e)}), 400

<span class="text-gray-500"># Java Spring - ì•ˆì „í•œ ê³„ì‚°ê¸°</span>
import org.springframework.expression.Expression;
import org.springframework.expression.spel.SpelParserConfiguration;
import org.springframework.expression.spel.standard.SpelExpressionParser;
import org.springframework.expression.spel.support.StandardEvaluationContext;

@PostMapping("/calculate")
public ResponseEntity calculate(
    @RequestParam String formula) {
    
    <span class="text-green-400">// âœ… 1ë‹¨ê³„: ì…ë ¥ê°’ ê²€ì¦</span>
    if (!isValidFormula(formula)) {
        logger.warn("Invalid formula: " + formula);
        return ResponseEntity
            .badRequest()
            .body("ì˜ëª»ëœ ìˆ˜ì‹ì…ë‹ˆë‹¤");
    }
    
    try {
        <span class="text-green-400">// âœ… 2ë‹¨ê³„: ì œí•œëœ íŒŒì„œ ì„¤ì •</span>
        SpelParserConfiguration config = 
            new SpelParserConfiguration(
                false,  <span class="text-green-400">// autoGrowNullReferences</span>
                false   <span class="text-green-400">// autoGrowCollections</span>
            );
        
        SpelExpressionParser parser = 
            new SpelExpressionParser(config);
        
        <span class="text-green-400">// âœ… 3ë‹¨ê³„: ì œí•œëœ ì»¨í…ìŠ¤íŠ¸</span>
        StandardEvaluationContext context = 
            new StandardEvaluationContext();
        
        <span class="text-green-400">// í•¨ìˆ˜/ë©”ì„œë“œ í˜¸ì¶œ ì°¨ë‹¨</span>
        context.setTypeLocator(null);
        
        Expression expression = 
            parser.parseExpression(formula);
        
        <span class="text-green-400">// âœ… 4ë‹¨ê³„: ì•ˆì „í•˜ê²Œ í‰ê°€</span>
        Object result = expression.getValue(
            context, 
            Double.class
        );
        
        <span class="text-green-400">// âœ… 5ë‹¨ê³„: ë¡œê¹…</span>
        auditLogger.info(
            "Calculated: " + formula + 
            " = " + result
        );
        
        return ResponseEntity.ok(result);
        
    } catch (Exception e) {
        <span class="text-green-400">// âœ… ê³µê²© ì‹œë„ ì°¨ë‹¨</span>
        logger.warn(
            "Blocked code injection: " + 
            formula + ", error: " + 
            e.getMessage()
        );
        return ResponseEntity
            .badRequest()
            .body("ìˆ˜ì‹ í‰ê°€ ì‹¤íŒ¨");
    }
}

private boolean isValidFormula(String formula) {
    <span class="text-green-400">// ìˆ«ìì™€ ì—°ì‚°ìë§Œ í—ˆìš©</span>
    return formula.matches(
        "^[0-9+\\-*/().\\s]+$"
    );
}

<span class="text-gray-500">// ì¶”ê°€ ë°©ì–´: ì •ê·œì‹ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸</span>
import java.util.regex.Pattern;

public class FormulaValidator {
    
    <span class="text-green-400">// í—ˆìš©ëœ íŒ¨í„´ë§Œ</span>
    private static final Pattern SAFE_PATTERN = 
        Pattern.compile("^[0-9+\\-*/().\\s]+$");
    
    public static boolean isValid(String input) {
        if (input == null || input.isEmpty()) {
            return false;
        }
        
        <span class="text-green-400">// ìœ„í—˜í•œ í‚¤ì›Œë“œ ì°¨ë‹¨</span>
        String[] dangerousKeywords = {
            "import", "exec", "eval", 
            "system", "Runtime", "Process",
            "__", "class", "method"
        };
        
        String lower = input.toLowerCase();
        for (String keyword : dangerousKeywords) {
            if (lower.contains(keyword)) {
                return false;
            }
        }
        
        return SAFE_PATTERN.matcher(input).matches();
    }
}</code></pre>
            </div>

        </div>
    </div>

    <script>
        let isRunning = false;

        function resetAll() {
            isRunning = false;
            
            document.getElementById('attackerUrl').value = 'https://xxbank.com/calculator';
            document.getElementById('bankUrl').value = 'https://xxbank.com/calculator';
            
            document.getElementById('attackerStatus').textContent = 'ì½”ë“œ ì‚½ì… ê³µê²© ì¤€ë¹„ ì¤‘...';
            document.getElementById('bankStatus').textContent = 'ì´ìê³„ì‚°ê¸° ì„œë¹„ìŠ¤ ìš´ì˜ ì¤‘...';
            
            document.getElementById('attackerScreen').innerHTML = 
                '<div class="text-center py-8">' +
                '<i class="fas fa-play-circle text-6xl text-orange-600 mb-4"></i>' +
                '<p class="text-gray-600">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>' +
                '</div>';
            
            document.getElementById('bankScreen').innerHTML = 
                '<div class="text-center py-8 text-gray-400">' +
                '<i class="fas fa-calculator text-4xl mb-3"></i>' +
                '<p>ì´ìê³„ì‚°ê¸° ëŒ€ê¸° ì¤‘...</p>' +
                '</div>';
            
            document.getElementById('serverLog').innerHTML = 
                '<div class="text-gray-500">[SERVER] Waiting for request...</div>';
            
            document.getElementById('serverStatus').textContent = 'IDLE';
            document.getElementById('serverStatus').className = 'text-xs bg-blue-600 px-3 py-1 rounded';
            
            document.getElementById('attackSteps').innerHTML = 
                '<div class="text-gray-500">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹œì‘í•˜ì„¸ìš”...</div>';
            
            document.getElementById('executedCode').classList.add('hidden');
            document.getElementById('problemBox').classList.add('hidden');
            document.getElementById('successBox').classList.add('hidden');
        }

        async function startScenario(scenario) {
            if (isRunning) return;
            isRunning = true;
            
            resetAll();
            await sleep(300);
            
            if (scenario === 1) {
                await scenario1_InterestCalculator();
            } else if (scenario === 2) {
                await scenario2_ExchangeRate();
            } else if (scenario === 3) {
                await scenario3_TemplateInjection();
            }
            
            isRunning = false;
        }

        // ì‹œë‚˜ë¦¬ì˜¤ 1: ì´ìê³„ì‚°ê¸° eval() ê³µê²©
        async function scenario1_InterestCalculator() {
            updateStep('ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤ 1: ì´ìê³„ì‚°ê¸° Code Injection');
            await sleep(1000);
            
            // 1ë‹¨ê³„: ì€í–‰ ì´ìê³„ì‚°ê¸° í™”ë©´
            updateStep('1ï¸âƒ£ XXì€í–‰ ì´ìê³„ì‚°ê¸° ì„œë¹„ìŠ¤');
            document.getElementById('bankStatus').textContent = 'ì´ìê³„ì‚°ê¸° í™œì„±í™”';
            
            document.getElementById('bankScreen').innerHTML = 
                '<div class="p-6">' +
                '<h2 class="text-xl font-bold mb-4 text-blue-600">ğŸ’° ì˜ˆê¸ˆ ì´ì ê³„ì‚°ê¸°</h2>' +
                '<div class="bg-blue-50 p-4 rounded mb-4">' +
                '<p class="text-sm text-gray-700 mb-2">ì›í•˜ì‹œëŠ” ìˆ˜ì‹ì„ ì…ë ¥í•˜ì„¸ìš”</p>' +
                '<p class="text-xs text-gray-500">ì˜ˆ: 1000000 * 0.035 * 12</p>' +
                '</div>' +
                '<div class="space-y-3">' +
                '<input type="text" value="1000000 * 0.035 * 12" ' +
                'class="w-full p-3 border rounded code-font text-sm" readonly>' +
                '<button class="w-full bg-blue-600 text-white py-2 rounded">ê³„ì‚°í•˜ê¸°</button>' +
                '</div></div>';
            
            await addServerLog('[SERVER] Interest calculator loaded', 'text-green-400');
            await sleep(1000);
            
            // 2ë‹¨ê³„: ê³µê²©ìê°€ ì•…ì„± ì½”ë“œ ì…ë ¥
            updateStep('2ï¸âƒ£ ê³µê²©ìê°€ ì½”ë“œ ì‚½ì… ì‹œë„');
            document.getElementById('attackerStatus').textContent = 'ì•…ì„± ì½”ë“œ ì‘ì„± ì¤‘...';
            
            const maliciousCode = "__import__('os').system('cat /etc/passwd')";
            
            document.getElementById('attackerScreen').innerHTML = 
                '<div class="p-6">' +
                '<h2 class="text-xl font-bold mb-4 text-red-600">ğŸ”´ Code Injection ê³µê²©</h2>' +
                '<div class="bg-gray-900 text-green-400 p-4 rounded code-font text-xs mb-4">' +
                '<div class="text-yellow-400">$ python3 code_injection.py</div>' +
                '<div class="mt-2">[*] Target: https://xxbank.com/calculate</div>' +
                '<div>[*] Injecting malicious code...</div>' +
                '</div>' +
                '<div class="bg-red-50 border-2 border-red-500 p-4 rounded">' +
                '<p class="font-bold text-red-700 mb-2">ì•…ì„± ìˆ˜ì‹:</p>' +
                '<div class="bg-white p-2 rounded code-font text-xs text-red-600 break-all">' +
                maliciousCode +
                '</div>' +
                '<p class="text-xs text-gray-600 mt-2">â†’ ì‹œìŠ¤í…œ íŒŒì¼ ì½ê¸° ì‹œë„</p>' +
                '</div></div>';
            
            await sleep(2000);
            updateStep('3ï¸âƒ£ <span class="text-red-400">ì•…ì„± ì½”ë“œë¥¼ ê³„ì‚°ê¸°ì— ì…ë ¥</span>');
            
            // ì€í–‰ í™”ë©´ì—ë„ ì•…ì„± ì½”ë“œ í‘œì‹œ
            document.getElementById('bankScreen').innerHTML = 
                '<div class="p-6">' +
                '<h2 class="text-xl font-bold mb-4 text-blue-600">ğŸ’° ì˜ˆê¸ˆ ì´ì ê³„ì‚°ê¸°</h2>' +
                '<div class="space-y-3">' +
                '<input type="text" value="' + maliciousCode + '" ' +
                'class="w-full p-3 border-2 border-red-500 rounded code-font text-sm text-red-600 bg-red-50" readonly>' +
                '<button class="w-full bg-red-600 text-white py-2 rounded animate-pulse">ì²˜ë¦¬ ì¤‘...</button>' +
                '</div></div>';
            
            await sleep(1500);
            
            // 4ë‹¨ê³„: ì„œë²„ì—ì„œ ì½”ë“œ ì‹¤í–‰
            updateStep('4ï¸âƒ£ ì„œë²„ê°€ ì…ë ¥ê°’ì„ eval()ë¡œ ì‹¤í–‰');
            
            await addServerLog('[REQUEST] POST /calculate', 'text-blue-400');
            await sleep(300);
            await addServerLog('[FORM] formula=' + maliciousCode, 'text-gray-400');
            await sleep(500);
            await addServerLog('[DANGER] Processing user input...', 'text-yellow-400');
            await sleep(300);
            await addServerLog('[CODE] Executing: eval(formula)', 'text-orange-400');
            await sleep(500);
            
            // ì‹¤í–‰ëœ ì½”ë“œ í‘œì‹œ
            document.getElementById('executedCode').classList.remove('hidden');
            document.getElementById('executedCodeContent').innerHTML = 
                '<div class="text-red-400">>>> eval("' + maliciousCode + '")</div>' +
                '<div class="text-yellow-400 mt-2">ì‹¤ì œë¡œ ì‹¤í–‰ë¨:</div>' +
                '<div class="text-white mt-1">os.system(\'cat /etc/passwd\')</div>';
            
            await sleep(1000);
            
            await addServerLog('[SYSTEM] Executing shell command...', 'text-red-400');
            await sleep(500);
            await addServerLog('[BREACH] /etc/passwd accessed!', 'text-red-500 font-bold');
            await sleep(300);
            
            updateServerStatus('COMPROMISED', 'bg-red-600 animate-pulse');
            
            // 5ë‹¨ê³„: ì‹œìŠ¤í…œ ì •ë³´ ë…¸ì¶œ
            updateStep('5ï¸âƒ£ <span class="text-red-500 font-bold">ì‹œìŠ¤í…œ íŒŒì¼ ë…¸ì¶œ!</span>');
            
            await addServerLog('[OUTPUT] root:x:0:0:root:/root:/bin/bash', 'text-red-300');
            await sleep(200);
            await addServerLog('[OUTPUT] daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin', 'text-red-300');
            await sleep(200);
            await addServerLog('[OUTPUT] www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin', 'text-red-300');
            await sleep(200);
            await addServerLog('[OUTPUT] mysql:x:108:115:MySQL Server,,,:/var/lib/mysql:/bin/false', 'text-red-300');
            await sleep(500);
            
            // ê³µê²©ì í™”ë©´ì— íƒˆì·¨ ë°ì´í„° í‘œì‹œ
            document.getElementById('attackerScreen').innerHTML = 
                '<div class="p-6">' +
                '<div class="bg-green-100 border-2 border-green-500 p-4 rounded mb-4">' +
                '<p class="text-green-700 font-bold text-center text-xl">' +
                '<i class="fas fa-check-circle"></i> ê³µê²© ì„±ê³µ!</p>' +
                '</div>' +
                '<h2 class="text-xl font-bold mb-4 text-red-600">ì‹œìŠ¤í…œ ì •ë³´ íƒˆì·¨</h2>' +
                '<div class="bg-gray-900 text-green-400 p-4 rounded code-font text-xs max-h-[300px] overflow-auto">' +
                '<div>root:x:0:0:root:/root:/bin/bash</div>' +
                '<div>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</div>' +
                '<div>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</div>' +
                '<div>mysql:x:108:115:MySQL Server,,,:/var/lib/mysql:/bin/false</div>' +
                '<div>postgres:x:109:117:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash</div>' +
                '<div class="text-yellow-400 mt-3">â†’ ì‹œìŠ¤í…œ ê³„ì • ì •ë³´ íšë“!</div>' +
                '<div class="text-yellow-400">â†’ ì¶”ê°€ ê³µê²© ê°€ëŠ¥!</div>' +
                '</div></div>';
            
            showResults();
        }

        // ì‹œë‚˜ë¦¬ì˜¤ 2: í™˜ìœ¨ ê³„ì‚°ê¸°
        async function scenario2_ExchangeRate() {
            updateStep('ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤ 2: í™˜ìœ¨ ê³„ì‚°ê¸° ì½”ë“œ ì‹¤í–‰');
            await sleep(1000);
            
            updateStep('1ï¸âƒ£ XXì€í–‰ í™˜ìœ¨ ê³„ì‚°ê¸° ì„œë¹„ìŠ¤');
            
            document.getElementById('bankScreen').innerHTML = 
                '<div class="p-6">' +
                '<h2 class="text-xl font-bold mb-4 text-blue-600">ğŸ’± í™˜ìœ¨ ê³„ì‚°ê¸°</h2>' +
                '<div class="bg-blue-50 p-4 rounded mb-4">' +
                '<p class="text-sm text-gray-700">í™˜ì „ ê¸ˆì•¡ì„ ê³„ì‚°í•©ë‹ˆë‹¤</p>' +
                '</div>' +
                '<div class="space-y-3">' +
                '<input type="text" value="1000 * 1350.5" class="w-full p-3 border rounded code-font text-sm" readonly>' +
                '<button class="w-full bg-blue-600 text-white py-2 rounded">ê³„ì‚°í•˜ê¸°</button>' +
                '</div></div>';
            
            await sleep(1500);
            
            updateStep('2ï¸âƒ£ ê³µê²©ìê°€ DB ì¡°íšŒ ì½”ë“œ ì‚½ì…');
            
            const dbAttackCode = "__import__('sqlite3').connect('/var/db/bank.db').execute('SELECT * FROM accounts').fetchall()";
            
            document.getElementById('attackerScreen').innerHTML = 
                '<div class="p-6">' +
                '<h2 class="text-xl font-bold mb-4 text-red-600">DB íƒˆì·¨ ê³µê²©</h2>' +
                '<div class="bg-red-50 border-2 border-red-500 p-4 rounded">' +
                '<p class="font-bold text-red-700 mb-2">ì•…ì„± ì½”ë“œ:</p>' +
                '<div class="bg-white p-2 rounded code-font text-xs text-red-600 break-all">' +
                dbAttackCode +
                '</div>' +
                '<p class="text-xs text-gray-600 mt-2">â†’ ì „ì²´ ê³„ì¢Œ DB ì¡°íšŒ</p>' +
                '</div></div>';
            
            await sleep(2000);
            updateStep('3ï¸âƒ£ ì„œë²„ê°€ eval()ë¡œ ì½”ë“œ ì‹¤í–‰');
            
            await addServerLog('[REQUEST] POST /exchange-calculate', 'text-blue-400');
            await sleep(300);
            await addServerLog('[DANGER] Executing: eval(formula)', 'text-red-400');
            await sleep(500);
            await addServerLog('[DATABASE] SQLite connection opened', 'text-yellow-400');
            await sleep(500);
            await addServerLog('[SQL] SELECT * FROM accounts', 'text-cyan-400');
            await sleep(500);
            await addServerLog('[BREACH] Database accessed!', 'text-red-500 font-bold');
            await sleep(500);
            
            document.getElementById('executedCode').classList.remove('hidden');
            document.getElementById('executedCodeContent').innerHTML = 
                '<div class="text-red-400">>>> eval("' + dbAttackCode.substring(0, 50) + '...")</div>' +
                '<div class="text-yellow-400 mt-2">ì‹¤ì œ ì‹¤í–‰:</div>' +
                '<div class="text-white mt-1">DB ì—°ê²° â†’ ì „ì²´ ê³„ì¢Œ ì¡°íšŒ</div>';
            
            updateStep('4ï¸âƒ£ <span class="text-red-500 font-bold">ì „ì²´ ê³ ê° DB íƒˆì·¨!</span>');
            
            await addServerLog('[DATA] Extracting account records...', 'text-red-400');
            await sleep(500);
            await addServerLog('[DATA] 10,000+ accounts extracted!', 'text-red-500 font-bold');
            
            updateServerStatus('BREACHED', 'bg-red-600');
            
            document.getElementById('attackerScreen').innerHTML = 
                '<div class="p-6">' +
                '<div class="bg-green-100 border-2 border-green-500 p-4 rounded mb-4">' +
                '<p class="text-green-700 font-bold text-center">' +
                '<i class="fas fa-check-circle"></i> DB íƒˆì·¨ ì„±ê³µ!</p>' +
                '</div>' +
                '<h2 class="text-xl font-bold mb-4 text-red-600">ê³„ì¢Œ DB</h2>' +
                '<div class="bg-gray-900 text-green-400 p-3 rounded code-font text-xs">' +
                '<div class="text-cyan-400">account_id | name | balance</div>' +
                '<div class="border-b border-gray-700 my-1"></div>' +
                '<div>10001 | ê¹€ì² ìˆ˜ | 15,000,000ì›</div>' +
                '<div>10002 | ì´ì˜í¬ | 28,500,000ì›</div>' +
                '<div>10003 | ë°•ë¯¼ìˆ˜ | 42,300,000ì›</div>' +
                '<div>10004 | ì •ìˆ˜ì§„ | 35,700,000ì›</div>' +
                '<div class="text-yellow-400 mt-3">... 10,000+ records</div>' +
                '<div class="text-red-400 mt-2">ì´ í”¼í•´ì•¡: ì•½ 5,000ì–µì›</div>' +
                '</div></div>';
            
            showResults();
        }

        // ì‹œë‚˜ë¦¬ì˜¤ 3: í…œí”Œë¦¿ ì¸ì ì…˜
        async function scenario3_TemplateInjection() {
            updateStep('ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤ 3: í…œí”Œë¦¿ ì¸ì ì…˜ â†’ DB íƒˆì·¨');
            await sleep(1000);
            
            updateStep('1ï¸âƒ£ ê³ ê° ë¦¬í¬íŠ¸ ìƒì„± ì„œë¹„ìŠ¤');
            
            document.getElementById('bankScreen').innerHTML = 
                '<div class="p-6">' +
                '<h2 class="text-xl font-bold mb-4 text-blue-600">ğŸ“Š ë¦¬í¬íŠ¸ ìƒì„±</h2>' +
                '<div class="bg-blue-50 p-4 rounded mb-4">' +
                '<p class="text-sm text-gray-700">ê³ ê°ëª…ì„ ì…ë ¥í•˜ì„¸ìš”</p>' +
                '</div>' +
                '<div class="space-y-3">' +
                '<input type="text" value="í™ê¸¸ë™" class="w-full p-3 border rounded" readonly>' +
                '<button class="w-full bg-blue-600 text-white py-2 rounded">ë¦¬í¬íŠ¸ ìƒì„±</button>' +
                '</div></div>';
            
            await sleep(1500);
            
            updateStep('2ï¸âƒ£ ê³µê²©ìê°€ í…œí”Œë¦¿ ì¸ì ì…˜ ì½”ë“œ ì‚½ì…');
            
            const templateAttack = "{{config.__class__.__init__.__globals__['os'].popen('cat /var/db/customers.csv').read()}}";
            
            document.getElementById('attackerScreen').innerHTML = 
                '<div class="p-6">' +
                '<h2 class="text-xl font-bold mb-4 text-red-600">Template Injection</h2>' +
                '<div class="bg-red-50 border-2 border-red-500 p-4 rounded">' +
                '<p class="font-bold text-red-700 mb-2">Jinja2 í…œí”Œë¦¿ ê³µê²©:</p>' +
                '<div class="bg-white p-2 rounded code-font text-xs text-red-600 break-all">' +
                templateAttack +
                '</div>' +
                '<p class="text-xs text-gray-600 mt-2">â†’ ì„œë²„ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼</p>' +
                '</div></div>';
            
            await sleep(2000);
            
            updateStep('3ï¸âƒ£ í…œí”Œë¦¿ ì—”ì§„ì´ ì½”ë“œ ì‹¤í–‰');
            
            await addServerLog('[REQUEST] POST /generate-report', 'text-blue-400');
            await sleep(300);
            await addServerLog('[TEMPLATE] Processing Jinja2 template...', 'text-yellow-400');
            await sleep(500);
            await addServerLog('[DANGER] Template contains code!', 'text-red-400');
            await sleep(500);
            await addServerLog('[EXEC] os.popen() executed', 'text-red-500 font-bold');
            await sleep(500);
            await addServerLog('[FILE] Reading /var/db/customers.csv', 'text-red-400');
            await sleep(500);
            
            document.getElementById('executedCode').classList.remove('hidden');
            document.getElementById('executedCodeContent').innerHTML = 
                '<div class="text-red-400">template.render(name=user_input)</div>' +
                '<div class="text-yellow-400 mt-2">í…œí”Œë¦¿ ë‚´ë¶€ì—ì„œ ì‹¤í–‰:</div>' +
                '<div class="text-white mt-1">os.popen(\'cat /var/db/customers.csv\').read()</div>';
            
            updateStep('4ï¸âƒ£ <span class="text-red-500 font-bold">ê³ ê° ë°ì´í„° íŒŒì¼ íƒˆì·¨!</span>');
            
            await addServerLog('[BREACH] Customer data exposed!', 'text-red-500 font-bold');
            await sleep(500);
            
            updateServerStatus('CRITICAL', 'bg-red-600 animate-blink');
            
            document.getElementById('attackerScreen').innerHTML = 
                '<div class="p-6">' +
                '<div class="bg-green-100 border-2 border-green-500 p-4 rounded mb-4">' +
                '<p class="text-green-700 font-bold text-center">' +
                '<i class="fas fa-check-circle"></i> ê³ ê° DB íƒˆì·¨!</p>' +
                '</div>' +
                '<h2 class="text-xl font-bold mb-4 text-red-600">customers.csv</h2>' +
                '<div class="bg-gray-900 text-green-400 p-3 rounded code-font text-xs max-h-[300px] overflow-auto">' +
                '<div class="text-cyan-400">name,account,ssn,phone,balance</div>' +
                '<div>ê¹€ì² ìˆ˜,110-123-456789,801234-1234567,010-1234-5678,15000000</div>' +
                '<div>ì´ì˜í¬,110-234-567890,850512-2345678,010-2345-6789,28500000</div>' +
                '<div>ë°•ë¯¼ìˆ˜,110-345-678901,900123-1234567,010-3456-7890,42300000</div>' +
                '<div>ì •ìˆ˜ì§„,110-456-789012,920304-2345678,010-4567-8901,35700000</div>' +
                '<div class="text-yellow-400 mt-3">... 50,000+ customers</div>' +
                '<div class="text-red-400">ì£¼ë¯¼ë²ˆí˜¸ í¬í•¨!</div>' +
                '</div></div>';
            
            showResults();
        }

        function showResults() {
            document.getElementById('problemBox').classList.remove('hidden');
            document.getElementById('problemContent').innerHTML = 
                '<div class="bg-black bg-opacity-30 p-3 rounded">' +
                '<p class="font-bold mb-2">âŒ Code Injection ì·¨ì•½ì :</p>' +
                '<div class="space-y-1 ml-4">' +
                '<div>1. eval() / exec() í•¨ìˆ˜ ì‚¬ìš©</div>' +
                '<div>2. ì‚¬ìš©ì ì…ë ¥ì„ ì½”ë“œë¡œ ì‹¤í–‰</div>' +
                '<div>3. ì…ë ¥ê°’ ê²€ì¦ ì—†ìŒ</div>' +
                '<div>4. í…œí”Œë¦¿ ì—”ì§„ í•„í„°ë§ ì—†ìŒ</div>' +
                '</div></div>' +
                '<div class="bg-black bg-opacity-30 p-3 rounded mt-2">' +
                '<p class="font-bold mb-2">ğŸ’¥ ì˜ˆìƒ í”¼í•´:</p>' +
                '<div class="space-y-1 ml-4">' +
                '<div>â€¢ ì‹œìŠ¤í…œ ëª…ë ¹ ì‹¤í–‰</div>' +
                '<div>â€¢ DB ì „ì²´ íƒˆì·¨</div>' +
                '<div>â€¢ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼</div>' +
                '<div>â€¢ ì„œë²„ ì™„ì „ ì¥ì•… ê°€ëŠ¥</div>' +
                '</div></div>';
            
            document.getElementById('successBox').classList.remove('hidden');
            document.getElementById('successContent').innerHTML = 
                '<div class="bg-black bg-opacity-30 p-3 rounded">' +
                '<p class="font-bold mb-2">ğŸ¯ ê³µê²© ì„±ê³µ:</p>' +
                '<div class="space-y-1 ml-4">' +
                '<div>â€¢ ì•…ì„± ì½”ë“œ ì‹¤í–‰ ì™„ë£Œ</div>' +
                '<div>â€¢ ì„œë²„ ê¶Œí•œ íšë“</div>' +
                '<div>â€¢ ë°ì´í„° íƒˆì·¨ ì„±ê³µ</div>' +
                '</div></div>' +
                '<div class="bg-black bg-opacity-30 p-3 rounded mt-2">' +
                '<p class="font-bold mb-2">ğŸ›¡ï¸ í•„ìš”í•œ ë°©ì–´:</p>' +
                '<div class="space-y-1 ml-4">' +
                '<div>â€¢ eval/exec ì‚¬ìš© ê¸ˆì§€</div>' +
                '<div>â€¢ AST íŒŒì„œë¡œ ì•ˆì „í•˜ê²Œ í‰ê°€</div>' +
                '<div>â€¢ ì…ë ¥ê°’ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê²€ì¦</div>' +
                '<div>â€¢ í…œí”Œë¦¿ ìë™ ì´ìŠ¤ì¼€ì´í”„</div>' +
                '</div></div>';
        }

        function updateStep(html) {
            const steps = document.getElementById('attackSteps');
            const div = document.createElement('div');
            div.className = 'p-2 bg-gray-700 rounded text-sm';
            div.innerHTML = html;
            steps.appendChild(div);
            steps.scrollTop = steps.scrollHeight;
        }

        async function addServerLog(message, colorClass) {
            const div = document.createElement('div');
            div.className = colorClass || 'text-gray-400';
            div.textContent = '> ' + message;
            const container = document.getElementById('serverLog');
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            await sleep(50);
        }

        function updateServerStatus(text, className) {
            document.getElementById('serverStatus').textContent = text;
            document.getElementById('serverStatus').className = 'text-xs text-white px-3 py-1 rounded ' + className;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>